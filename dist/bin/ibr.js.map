{"version":3,"sources":["../../src/auth.ts","../../src/bin/ibr.ts","../../src/schemas.ts","../../src/capture.ts","../../src/compare.ts","../../src/session.ts","../../src/report.ts","../../src/index.ts"],"sourcesContent":["import { chromium } from 'playwright';\nimport { mkdir, access, readFile, writeFile, unlink, chmod, stat } from 'fs/promises';\nimport { join, dirname, resolve } from 'path';\nimport { existsSync, readFileSync } from 'fs';\nimport { userInfo, homedir } from 'os';\nimport { createHash, randomBytes } from 'crypto';\nimport type { LoginOptions } from './types.js';\n\nconst AUTH_STATE_FILE = 'auth.json';\n\n/**\n * Auth state with metadata for security\n */\ninterface StoredAuthState {\n  state: object; // Playwright storage state\n  metadata: {\n    createdAt: number;\n    expiresAt: number;\n    username: string;\n    projectPath: string;\n  };\n}\n\n/**\n * Check if running in a CI/CD or deployed environment\n * Auth operations should be blocked in these environments\n */\nexport function isDeployedEnvironment(): boolean {\n  return !!(\n    process.env.VERCEL ||\n    process.env.NETLIFY ||\n    process.env.CI ||\n    process.env.GITHUB_ACTIONS ||\n    process.env.GITLAB_CI ||\n    process.env.CIRCLECI ||\n    process.env.JENKINS_URL ||\n    process.env.TRAVIS ||\n    process.env.HEROKU ||\n    process.env.AWS_LAMBDA_FUNCTION_NAME ||\n    process.env.AZURE_FUNCTIONS_ENVIRONMENT\n  );\n}\n\n/**\n * Get the path to the auth state file\n * Uses per-user isolation to prevent credential sharing\n */\nexport function getAuthStatePath(outputDir: string): string {\n  const username = userInfo().username;\n  // Include username in filename for user isolation\n  return join(outputDir, `auth.${username}.json`);\n}\n\n/**\n * Get a secure auth path in user's home directory (alternative)\n * This keeps auth completely outside the project directory\n */\nexport function getSecureAuthPath(projectPath: string): string {\n  const username = userInfo().username;\n  // Hash project path to create unique identifier\n  const projectHash = createHash('sha256')\n    .update(resolve(projectPath))\n    .digest('hex')\n    .substring(0, 16);\n\n  return join(\n    homedir(),\n    '.config',\n    'ibr',\n    'auth',\n    `${projectHash}.${username}.json`\n  );\n}\n\n/**\n * Check if .gitignore properly excludes .ibr directory\n */\nfunction validateGitignore(projectDir: string): void {\n  const gitignorePath = join(projectDir, '.gitignore');\n\n  if (existsSync(gitignorePath)) {\n    const gitignore = readFileSync(gitignorePath, 'utf-8');\n    const lines = gitignore.split('\\n').map(l => l.trim());\n\n    const hasIbrIgnore = lines.some(line =>\n      line === '.ibr/' ||\n      line === '.ibr' ||\n      line === '**/.ibr/' ||\n      line === '**/.ibr'\n    );\n\n    if (!hasIbrIgnore) {\n      console.warn('\\n‚ö†Ô∏è  WARNING: .ibr/ is not in .gitignore!');\n      console.warn('   Add \".ibr/\" to .gitignore to prevent credential leaks.\\n');\n    }\n  } else {\n    console.warn('\\n‚ö†Ô∏è  No .gitignore found. Create one with \".ibr/\" entry.\\n');\n  }\n}\n\n/**\n * Check if auth state exists\n */\nexport async function hasAuthState(outputDir: string): Promise<boolean> {\n  try {\n    await access(getAuthStatePath(outputDir));\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Load auth state if it exists and is valid\n */\nexport async function loadAuthState(outputDir: string): Promise<object | null> {\n  // Block in deployed environments\n  if (isDeployedEnvironment()) {\n    console.warn('‚ö†Ô∏è  Deployed environment detected. Auth state not available.');\n    return null;\n  }\n\n  try {\n    const authPath = getAuthStatePath(outputDir);\n    const content = await readFile(authPath, 'utf-8');\n    const stored: StoredAuthState = JSON.parse(content);\n\n    // Validate metadata exists\n    if (!stored.metadata) {\n      console.warn('‚ö†Ô∏è  Legacy auth format detected. Please re-authenticate with `ibr login`.');\n      return null;\n    }\n\n    // Check user matches\n    const currentUser = userInfo().username;\n    if (stored.metadata.username !== currentUser) {\n      console.warn(`‚ö†Ô∏è  Auth state belongs to different user (${stored.metadata.username}).`);\n      return null;\n    }\n\n    // Check expiration\n    if (Date.now() > stored.metadata.expiresAt) {\n      console.warn('‚ö†Ô∏è  Auth state expired. Please re-authenticate with `ibr login`.');\n      await clearAuthState(outputDir);\n      return null;\n    }\n\n    // Warn if auth is getting old (> 24 hours)\n    const ageHours = (Date.now() - stored.metadata.createdAt) / (1000 * 60 * 60);\n    if (ageHours > 24) {\n      console.warn(`‚ö†Ô∏è  Auth state is ${Math.floor(ageHours)} hours old. Consider re-authenticating.`);\n    }\n\n    return stored.state;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Open a browser for manual login and save the state\n *\n * This opens a visible browser window where the user can:\n * 1. Navigate to login page\n * 2. Enter credentials\n * 3. Complete any 2FA or other auth steps\n *\n * When done, close the browser or press Ctrl+C to save the state.\n */\nexport async function performLogin(options: LoginOptions): Promise<string> {\n  const { url, outputDir, timeout = 300000 } = options; // 5 min default timeout\n\n  // Block in deployed environments\n  if (isDeployedEnvironment()) {\n    throw new Error(\n      'Authentication cannot be performed in deployed environments.\\n' +\n      'Run `ibr login` locally on your development machine.'\n    );\n  }\n\n  // Validate .gitignore before storing credentials\n  validateGitignore(process.cwd());\n\n  // Ensure output directory exists with restricted permissions\n  await mkdir(outputDir, { recursive: true, mode: 0o700 }); // rwx------\n\n  // Fix permissions on existing directory\n  try {\n    await chmod(outputDir, 0o700);\n  } catch {\n    // Ignore if chmod fails (e.g., on Windows)\n  }\n\n  const authStatePath = getAuthStatePath(outputDir);\n  const currentUser = userInfo().username;\n\n  console.log('\\nüîê Opening browser for login...');\n  console.log(`   User: ${currentUser}`);\n  console.log('   Navigate to your login page and complete authentication.');\n  console.log('   When finished, close the browser window to save your session.\\n');\n\n  const browser = await chromium.launch({\n    headless: false, // Visible browser for manual login\n  });\n\n  const context = await browser.newContext({\n    viewport: { width: 1280, height: 800 },\n  });\n\n  const page = await context.newPage();\n\n  try {\n    // Navigate to the provided URL\n    await page.goto(url, {\n      waitUntil: 'domcontentloaded',\n      timeout: 30000,\n    });\n\n    // Wait for browser to close (user manually closes it after login)\n    // or timeout after the specified duration\n    await Promise.race([\n      new Promise<void>((resolve) => {\n        browser.on('disconnected', () => resolve());\n      }),\n      new Promise<void>((_, reject) => {\n        setTimeout(() => reject(new Error('Login timeout exceeded')), timeout);\n      }),\n    ]);\n\n  } catch (error) {\n    // If browser is still open, save the state before closing\n    if (browser.isConnected()) {\n      await saveAuthState(context, authStatePath, outputDir);\n      await browser.close();\n    }\n\n    // Check if it was a timeout or browser close\n    if (error instanceof Error && error.message.includes('timeout')) {\n      throw error;\n    }\n  }\n\n  // If we get here without the browser being disconnected, save state\n  if (browser.isConnected()) {\n    await saveAuthState(context, authStatePath, outputDir);\n    await browser.close();\n  } else {\n    // Browser was closed by user - try to reconnect to save state\n    console.log('\\n‚ö†Ô∏è  Browser was closed. Attempting to save any captured state...');\n\n    // Create a new context just to save an empty state as fallback\n    const newBrowser = await chromium.launch({ headless: true });\n    const newContext = await newBrowser.newContext();\n\n    // Try to use any cookies from the page\n    try {\n      await newContext.addCookies(await context.cookies());\n    } catch {\n      // Context might be closed\n    }\n\n    await saveAuthState(newContext, authStatePath, outputDir);\n    await newBrowser.close();\n  }\n\n  console.log(`\\n‚úÖ Auth state saved for user: ${currentUser}`);\n  console.log(`   Location: ${authStatePath}`);\n  console.log('   Expires: 7 days from now');\n  console.log('   Future captures will use this authentication.\\n');\n\n  return authStatePath;\n}\n\n/**\n * Save auth state with metadata and secure permissions\n */\nasync function saveAuthState(\n  context: Awaited<ReturnType<typeof chromium.launch>>['contexts'][0],\n  authStatePath: string,\n  outputDir: string\n): Promise<void> {\n  const state = await context.storageState();\n  const currentUser = userInfo().username;\n\n  const storedState: StoredAuthState = {\n    state,\n    metadata: {\n      createdAt: Date.now(),\n      expiresAt: Date.now() + (7 * 24 * 60 * 60 * 1000), // 7 days\n      username: currentUser,\n      projectPath: resolve(process.cwd()),\n    }\n  };\n\n  // Write with restricted permissions (owner read/write only)\n  await writeFile(\n    authStatePath,\n    JSON.stringify(storedState, null, 2),\n    { mode: 0o600 } // rw-------\n  );\n\n  // Ensure permissions are correct (in case file existed)\n  try {\n    await chmod(authStatePath, 0o600);\n  } catch {\n    // Ignore if chmod fails (e.g., on Windows)\n  }\n}\n\n/**\n * Clear saved auth state with secure deletion\n */\nexport async function clearAuthState(outputDir: string): Promise<void> {\n  const authPath = getAuthStatePath(outputDir);\n\n  try {\n    // Get file stats for size\n    const stats = await stat(authPath);\n\n    // Overwrite with random data before deletion (secure delete)\n    const randomData = randomBytes(stats.size);\n    await writeFile(authPath, randomData, { mode: 0o600 });\n\n    // Now delete the file\n    await unlink(authPath);\n\n    console.log('‚úÖ Auth state securely cleared');\n  } catch {\n    console.log('‚ÑπÔ∏è  No auth state to clear');\n  }\n}\n\n/**\n * Get auth state info without loading the full state\n */\nexport async function getAuthStateInfo(outputDir: string): Promise<{\n  exists: boolean;\n  username?: string;\n  createdAt?: Date;\n  expiresAt?: Date;\n  expired?: boolean;\n} | null> {\n  try {\n    const authPath = getAuthStatePath(outputDir);\n    const content = await readFile(authPath, 'utf-8');\n    const stored: StoredAuthState = JSON.parse(content);\n\n    if (!stored.metadata) {\n      return { exists: true };\n    }\n\n    return {\n      exists: true,\n      username: stored.metadata.username,\n      createdAt: new Date(stored.metadata.createdAt),\n      expiresAt: new Date(stored.metadata.expiresAt),\n      expired: Date.now() > stored.metadata.expiresAt,\n    };\n  } catch {\n    return null;\n  }\n}\n","import { Command } from 'commander';\nimport { readFile } from 'fs/promises';\nimport { join } from 'path';\nimport { existsSync } from 'fs';\nimport {\n  InterfaceBuiltRight,\n  formatReportText,\n  formatReportJson,\n  formatReportMinimal,\n  formatSessionSummary,\n  VIEWPORTS,\n  type Config,\n} from '../index.js';\n\nconst program = new Command();\n\n// Load config from .ibrrc.json if it exists\nasync function loadConfig(): Promise<Partial<Config>> {\n  const configPath = join(process.cwd(), '.ibrrc.json');\n  if (existsSync(configPath)) {\n    try {\n      const content = await readFile(configPath, 'utf-8');\n      return JSON.parse(content);\n    } catch {\n      // Ignore config errors\n    }\n  }\n  return {};\n}\n\n// Create IBR instance with config\nasync function createIBR(options: Record<string, unknown> = {}): Promise<InterfaceBuiltRight> {\n  const config = await loadConfig();\n\n  // Merge CLI options with config\n  const merged: Partial<Config> = {\n    ...config,\n    ...(options.baseUrl ? { baseUrl: String(options.baseUrl) } : {}),\n    ...(options.output ? { outputDir: String(options.output) } : {}),\n    ...(options.viewport ? { viewport: VIEWPORTS[options.viewport as keyof typeof VIEWPORTS] } : {}),\n    ...(options.threshold ? { threshold: Number(options.threshold) } : {}),\n    ...(options.fullPage !== undefined ? { fullPage: Boolean(options.fullPage) } : {}),\n  };\n\n  return new InterfaceBuiltRight(merged);\n}\n\nprogram\n  .name('ibr')\n  .description('Visual regression testing for Claude Code')\n  .version('0.1.0');\n\n// Global options\nprogram\n  .option('-b, --base-url <url>', 'Base URL for the application')\n  .option('-o, --output <dir>', 'Output directory', './.ibr')\n  .option('-v, --viewport <name>', 'Viewport: desktop, mobile, tablet', 'desktop')\n  .option('-t, --threshold <percent>', 'Diff threshold percentage', '1.0');\n\n// Start command\nprogram\n  .command('start <url>')\n  .description('Start a visual session by capturing a baseline screenshot')\n  .option('-n, --name <name>', 'Session name')\n  .option('--no-full-page', 'Capture only the viewport, not full page')\n  .action(async (url: string, options: { name?: string; fullPage?: boolean }) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const result = await ibr.startSession(url, {\n        name: options.name,\n        fullPage: options.fullPage,\n      });\n\n      console.log(`Session started: ${result.sessionId}`);\n      console.log(`Baseline: ${result.baseline}`);\n      console.log(`URL: ${result.session.url}`);\n\n      await ibr.close();\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Check command\nprogram\n  .command('check [sessionId]')\n  .description('Compare current state against baseline')\n  .option('-f, --format <format>', 'Output format: json, text, minimal', 'text')\n  .action(async (sessionId: string | undefined, options: { format: string }) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const report = await ibr.check(sessionId);\n\n      switch (options.format) {\n        case 'json':\n          console.log(formatReportJson(report));\n          break;\n        case 'minimal':\n          console.log(formatReportMinimal(report));\n          break;\n        default:\n          console.log(formatReportText(report));\n      }\n\n      await ibr.close();\n\n      // Exit with error code if not matching and not expected\n      if (!report.comparison.match &&\n          (report.analysis.verdict === 'UNEXPECTED_CHANGE' ||\n           report.analysis.verdict === 'LAYOUT_BROKEN')) {\n        process.exit(1);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// List command\nprogram\n  .command('list')\n  .description('List all sessions')\n  .option('-f, --format <format>', 'Output format: json, text', 'text')\n  .action(async (options: { format: string }) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const sessions = await ibr.listSessions();\n\n      if (sessions.length === 0) {\n        console.log('No sessions found.');\n        return;\n      }\n\n      if (options.format === 'json') {\n        console.log(JSON.stringify(sessions, null, 2));\n      } else {\n        console.log('Sessions:');\n        console.log('');\n        console.log('ID              STATUS    VIEWPORT  DATE        NAME');\n        console.log('-'.repeat(70));\n        for (const session of sessions) {\n          console.log(formatSessionSummary(session));\n        }\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Update command\nprogram\n  .command('update [sessionId]')\n  .description('Update baseline with current screenshot')\n  .action(async (sessionId: string | undefined) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const session = await ibr.updateBaseline(sessionId);\n\n      console.log(`Baseline updated for session: ${session.id}`);\n      console.log(`URL: ${session.url}`);\n\n      await ibr.close();\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Clean command\nprogram\n  .command('clean')\n  .description('Clean old sessions')\n  .option('--older-than <duration>', 'Delete sessions older than duration (e.g., 7d, 24h)')\n  .option('--keep-last <count>', 'Keep the last N sessions', '0')\n  .option('--dry-run', 'Show what would be deleted without deleting')\n  .action(async (options: { olderThan?: string; keepLast: string; dryRun?: boolean }) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const result = await ibr.clean({\n        olderThan: options.olderThan,\n        keepLast: parseInt(options.keepLast, 10),\n        dryRun: options.dryRun,\n      });\n\n      if (options.dryRun) {\n        console.log('Dry run - would delete:');\n      } else {\n        console.log('Cleaned:');\n      }\n\n      if (result.deleted.length === 0) {\n        console.log('  No sessions to delete.');\n      } else {\n        for (const id of result.deleted) {\n          console.log(`  - ${id}`);\n        }\n      }\n\n      console.log(`\\nKept: ${result.kept.length} sessions`);\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Delete command\nprogram\n  .command('delete <sessionId>')\n  .description('Delete a specific session')\n  .action(async (sessionId: string) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const deleted = await ibr.deleteSession(sessionId);\n\n      if (deleted) {\n        console.log(`Deleted session: ${sessionId}`);\n      } else {\n        console.log(`Session not found: ${sessionId}`);\n        process.exit(1);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Serve command (placeholder - will be implemented with web-ui)\nprogram\n  .command('serve')\n  .description('Start the comparison viewer web UI')\n  .option('-p, --port <port>', 'Port number', '4242')\n  .option('--no-open', 'Do not open browser automatically')\n  .action(async (options: { port: string; open?: boolean }) => {\n    const { spawn } = await import('child_process');\n    const { resolve } = await import('path');\n\n    // Find web-ui directory relative to package root\n    // In CJS build, use process.cwd() or resolve from known location\n    const packageRoot = resolve(process.cwd());\n    let webUiDir = join(packageRoot, 'web-ui');\n\n    // If not found in cwd, try relative to node_modules install\n    if (!existsSync(webUiDir)) {\n      // Try finding it relative to this package when installed as dependency\n      const possiblePaths = [\n        join(packageRoot, 'node_modules', 'interface-built-right', 'web-ui'),\n        join(packageRoot, '..', 'interface-built-right', 'web-ui'),\n      ];\n      for (const p of possiblePaths) {\n        if (existsSync(p)) {\n          webUiDir = p;\n          break;\n        }\n      }\n    }\n\n    // Check if web-ui exists\n    if (!existsSync(webUiDir)) {\n      console.log('Web UI not found. Please ensure web-ui directory exists.');\n      console.log('');\n      console.log('For now, you can view the comparison images directly:');\n\n      try {\n        const ibr = await createIBR(program.opts());\n        const session = await ibr.getMostRecentSession();\n\n        if (session) {\n          const config = ibr.getConfig();\n          console.log(`  Baseline: ${config.outputDir}/sessions/${session.id}/baseline.png`);\n          console.log(`  Current:  ${config.outputDir}/sessions/${session.id}/current.png`);\n          console.log(`  Diff:     ${config.outputDir}/sessions/${session.id}/diff.png`);\n        }\n      } catch {\n        // Ignore errors\n      }\n      return;\n    }\n\n    console.log(`Starting web UI on http://localhost:${options.port}`);\n    console.log('Press Ctrl+C to stop the server.');\n    console.log('');\n\n    // Start Next.js dev server\n    const server = spawn('npm', ['run', 'dev', '--', '-p', options.port], {\n      cwd: webUiDir,\n      stdio: 'inherit',\n      shell: true,\n    });\n\n    // Open browser after a short delay (if --no-open not specified)\n    if (options.open !== false) {\n      setTimeout(async () => {\n        const open = (await import('child_process')).exec;\n        const url = `http://localhost:${options.port}`;\n        // Cross-platform open command\n        const cmd = process.platform === 'darwin' ? 'open' :\n                    process.platform === 'win32' ? 'start' : 'xdg-open';\n        open(`${cmd} ${url}`);\n      }, 3000);\n    }\n\n    // Handle server exit\n    server.on('close', (code) => {\n      if (code !== 0) {\n        console.log(`Web UI server exited with code ${code}`);\n      }\n    });\n  });\n\n// Login command - save auth state for authenticated captures\nprogram\n  .command('login <url>')\n  .description('Open browser for manual login, then save auth state for future captures')\n  .option('--timeout <ms>', 'Timeout in milliseconds (default: 5 minutes)', '300000')\n  .action(async (url: string, options: { timeout: string }) => {\n    try {\n      const { performLogin } = await import('../auth.js');\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n\n      await performLogin({\n        url,\n        outputDir,\n        timeout: parseInt(options.timeout, 10),\n      });\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Logout command - clear saved auth state\nprogram\n  .command('logout')\n  .description('Clear saved authentication state')\n  .action(async () => {\n    try {\n      const { clearAuthState } = await import('../auth.js');\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n\n      await clearAuthState(outputDir);\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Init command\nprogram\n  .command('init')\n  .description('Initialize .ibrrc.json configuration file')\n  .action(async () => {\n    const configPath = join(process.cwd(), '.ibrrc.json');\n\n    if (existsSync(configPath)) {\n      console.log('.ibrrc.json already exists.');\n      return;\n    }\n\n    const config = {\n      baseUrl: 'http://localhost:3000',\n      outputDir: './.ibr',\n      viewport: 'desktop',\n      threshold: 1.0,\n      fullPage: true,\n    };\n\n    const { writeFile } = await import('fs/promises');\n    await writeFile(configPath, JSON.stringify(config, null, 2));\n\n    console.log('Created .ibrrc.json');\n    console.log('');\n    console.log('Configuration:');\n    console.log(JSON.stringify(config, null, 2));\n  });\n\nprogram.parse();\n","import { z } from 'zod';\n\n/**\n * Viewport configuration for screenshot capture\n * Supports predefined names or custom dimensions\n */\nexport const ViewportSchema = z.object({\n  name: z.string().min(1).max(50),\n  width: z.number().min(320).max(3840),\n  height: z.number().min(480).max(2160),\n});\n\n/**\n * Predefined viewport configurations\n */\nexport const VIEWPORTS = {\n  desktop: { name: 'desktop', width: 1920, height: 1080 },\n  'desktop-lg': { name: 'desktop-lg', width: 2560, height: 1440 },\n  'desktop-sm': { name: 'desktop-sm', width: 1440, height: 900 },\n  laptop: { name: 'laptop', width: 1366, height: 768 },\n  tablet: { name: 'tablet', width: 768, height: 1024 },\n  'tablet-landscape': { name: 'tablet-landscape', width: 1024, height: 768 },\n  mobile: { name: 'mobile', width: 375, height: 667 },\n  'mobile-lg': { name: 'mobile-lg', width: 414, height: 896 },\n  'iphone-14': { name: 'iphone-14', width: 390, height: 844 },\n  'iphone-14-pro-max': { name: 'iphone-14-pro-max', width: 430, height: 932 },\n} as const;\n\n/**\n * Main configuration for InterfaceBuiltRight\n */\nexport const ConfigSchema = z.object({\n  baseUrl: z.string().url('Must be a valid URL'),\n  outputDir: z.string().default('./.ibr'),\n  viewport: ViewportSchema.default(VIEWPORTS.desktop),\n  viewports: z.array(ViewportSchema).optional(), // Multi-viewport support\n  threshold: z.number().min(0).max(100).default(1.0),\n  fullPage: z.boolean().default(true),\n  waitForNetworkIdle: z.boolean().default(true),\n  timeout: z.number().min(1000).max(120000).default(30000),\n});\n\n/**\n * Session query options\n */\nexport const SessionQuerySchema = z.object({\n  route: z.string().optional(),\n  url: z.string().optional(),\n  status: z.enum(['baseline', 'compared', 'pending']).optional(),\n  name: z.string().optional(),\n  createdAfter: z.date().optional(),\n  createdBefore: z.date().optional(),\n  viewport: z.string().optional(),\n  limit: z.number().min(1).max(100).default(50),\n});\n\n/**\n * Comparison result from pixelmatch\n */\nexport const ComparisonResultSchema = z.object({\n  match: z.boolean(),\n  diffPercent: z.number(),\n  diffPixels: z.number(),\n  totalPixels: z.number(),\n  threshold: z.number(),\n});\n\n/**\n * Changed region detected in comparison\n */\nexport const ChangedRegionSchema = z.object({\n  location: z.enum(['top', 'bottom', 'left', 'right', 'center', 'full']),\n  bounds: z.object({\n    x: z.number(),\n    y: z.number(),\n    width: z.number(),\n    height: z.number(),\n  }),\n  description: z.string(),\n  severity: z.enum(['expected', 'unexpected', 'critical']),\n});\n\n/**\n * Analysis verdict types\n */\nexport const VerdictSchema = z.enum([\n  'MATCH',\n  'EXPECTED_CHANGE',\n  'UNEXPECTED_CHANGE',\n  'LAYOUT_BROKEN',\n]);\n\n/**\n * Analysis result\n */\nexport const AnalysisSchema = z.object({\n  verdict: VerdictSchema,\n  summary: z.string(),\n  changedRegions: z.array(ChangedRegionSchema),\n  unexpectedChanges: z.array(ChangedRegionSchema),\n  recommendation: z.string().nullable(),\n});\n\n/**\n * Session status\n */\nexport const SessionStatusSchema = z.enum(['baseline', 'compared', 'pending']);\n\n/**\n * Visual session\n */\nexport const SessionSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  url: z.string().url(),\n  viewport: ViewportSchema,\n  status: SessionStatusSchema,\n  createdAt: z.string().datetime(),\n  updatedAt: z.string().datetime(),\n  comparison: ComparisonResultSchema.optional(),\n  analysis: AnalysisSchema.optional(),\n});\n\n/**\n * Full comparison report\n */\nexport const ComparisonReportSchema = z.object({\n  sessionId: z.string(),\n  sessionName: z.string(),\n  url: z.string(),\n  timestamp: z.string().datetime(),\n  viewport: ViewportSchema,\n  comparison: ComparisonResultSchema,\n  analysis: AnalysisSchema,\n  files: z.object({\n    baseline: z.string(),\n    current: z.string(),\n    diff: z.string(),\n  }),\n  webViewUrl: z.string().optional(),\n});\n\n// Type exports - auto-generated from schemas\nexport type Viewport = z.infer<typeof ViewportSchema>;\nexport type Config = z.infer<typeof ConfigSchema>;\nexport type SessionQuery = z.infer<typeof SessionQuerySchema>;\nexport type ComparisonResult = z.infer<typeof ComparisonResultSchema>;\nexport type ChangedRegion = z.infer<typeof ChangedRegionSchema>;\nexport type Verdict = z.infer<typeof VerdictSchema>;\nexport type Analysis = z.infer<typeof AnalysisSchema>;\nexport type SessionStatus = z.infer<typeof SessionStatusSchema>;\nexport type Session = z.infer<typeof SessionSchema>;\nexport type ComparisonReport = z.infer<typeof ComparisonReportSchema>;\n","import { chromium, type Browser } from 'playwright';\nimport { mkdir } from 'fs/promises';\nimport { dirname } from 'path';\nimport { VIEWPORTS, type Viewport } from './schemas.js';\nimport type { CaptureOptions } from './types.js';\nimport { loadAuthState, isDeployedEnvironment } from './auth.js';\n\n// Playwright's storage state type\ntype StorageState = {\n  cookies: Array<{\n    name: string;\n    value: string;\n    domain: string;\n    path: string;\n    expires: number;\n    httpOnly: boolean;\n    secure: boolean;\n    sameSite: 'Strict' | 'Lax' | 'None';\n  }>;\n  origins: Array<{\n    origin: string;\n    localStorage: Array<{ name: string; value: string }>;\n  }>;\n};\n\nlet browser: Browser | null = null;\n\n/**\n * Get or create a browser instance\n */\nasync function getBrowser(): Promise<Browser> {\n  if (!browser) {\n    browser = await chromium.launch({\n      headless: true,\n    });\n  }\n  return browser;\n}\n\n/**\n * Close the browser instance\n */\nexport async function closeBrowser(): Promise<void> {\n  if (browser) {\n    await browser.close();\n    browser = null;\n  }\n}\n\n/**\n * Capture a screenshot of a URL\n */\nexport async function captureScreenshot(\n  options: CaptureOptions & { outputDir?: string }\n): Promise<string> {\n  const {\n    url,\n    outputPath,\n    viewport = VIEWPORTS.desktop,\n    fullPage = true,\n    waitForNetworkIdle = true,\n    timeout = 30000,\n    outputDir,\n  } = options;\n\n  // Ensure output directory exists\n  await mkdir(dirname(outputPath), { recursive: true });\n\n  // Load auth state if available (handles validation, expiration, user isolation)\n  let storageState: StorageState | undefined;\n  if (outputDir && !isDeployedEnvironment()) {\n    const authState = await loadAuthState(outputDir);\n    if (authState) {\n      storageState = authState as StorageState;\n      console.log('üîê Using saved authentication state');\n    }\n  }\n\n  const browserInstance = await getBrowser();\n  const context = await browserInstance.newContext({\n    viewport: {\n      width: viewport.width,\n      height: viewport.height,\n    },\n    // Disable animations for consistent screenshots\n    reducedMotion: 'reduce',\n    // Load auth state if available (Playwright accepts object or file path)\n    ...(storageState ? { storageState } : {}),\n  });\n\n  const page = await context.newPage();\n\n  try {\n    // Navigate to URL\n    await page.goto(url, {\n      waitUntil: waitForNetworkIdle ? 'networkidle' : 'load',\n      timeout,\n    });\n\n    // Wait for any remaining animations to settle\n    await page.waitForTimeout(500);\n\n    // Disable CSS animations and transitions\n    await page.addStyleTag({\n      content: `\n        *, *::before, *::after {\n          animation-duration: 0s !important;\n          animation-delay: 0s !important;\n          transition-duration: 0s !important;\n          transition-delay: 0s !important;\n        }\n      `,\n    });\n\n    // Take screenshot\n    await page.screenshot({\n      path: outputPath,\n      fullPage,\n      type: 'png',\n    });\n\n    return outputPath;\n  } finally {\n    await context.close();\n  }\n}\n\n/**\n * Get viewport dimensions by name\n */\nexport function getViewport(name: 'desktop' | 'mobile' | 'tablet'): Viewport {\n  return VIEWPORTS[name];\n}\n\n/**\n * Capture multiple viewports\n */\nexport async function captureMultipleViewports(\n  url: string,\n  outputDir: string,\n  viewports: Array<'desktop' | 'mobile' | 'tablet'> = ['desktop'],\n  options: Omit<CaptureOptions, 'url' | 'outputPath' | 'viewport'> = {}\n): Promise<Record<string, string>> {\n  const results: Record<string, string> = {};\n\n  for (const viewportName of viewports) {\n    const viewport = getViewport(viewportName);\n    const outputPath = `${outputDir}/${viewportName}.png`;\n\n    await captureScreenshot({\n      url,\n      outputPath,\n      viewport,\n      ...options,\n    });\n\n    results[viewportName] = outputPath;\n  }\n\n  return results;\n}\n","import pixelmatch from 'pixelmatch';\nimport { PNG } from 'pngjs';\nimport { readFile, writeFile, mkdir } from 'fs/promises';\nimport { dirname } from 'path';\nimport type { CompareOptions } from './types.js';\nimport type { ComparisonResult, Analysis, ChangedRegion, Verdict } from './schemas.js';\n\n/**\n * Compare two images using pixelmatch\n */\nexport async function compareImages(options: CompareOptions): Promise<ComparisonResult> {\n  const {\n    baselinePath,\n    currentPath,\n    diffPath,\n    threshold = 0.1, // pixelmatch threshold (0-1), lower = stricter\n  } = options;\n\n  // Read images\n  const [baselineBuffer, currentBuffer] = await Promise.all([\n    readFile(baselinePath),\n    readFile(currentPath),\n  ]);\n\n  const baseline = PNG.sync.read(baselineBuffer);\n  const current = PNG.sync.read(currentBuffer);\n\n  // Ensure images have same dimensions\n  if (baseline.width !== current.width || baseline.height !== current.height) {\n    throw new Error(\n      `Image dimensions mismatch: baseline (${baseline.width}x${baseline.height}) vs current (${current.width}x${current.height})`\n    );\n  }\n\n  const { width, height } = baseline;\n  const diff = new PNG({ width, height });\n  const totalPixels = width * height;\n\n  // Run pixelmatch\n  const diffPixels = pixelmatch(\n    baseline.data,\n    current.data,\n    diff.data,\n    width,\n    height,\n    {\n      threshold,\n      includeAA: false, // Ignore anti-aliasing differences\n      alpha: 0.1,\n      diffColor: [255, 0, 0], // Red for differences\n      diffColorAlt: [0, 255, 0], // Green for anti-aliased differences\n    }\n  );\n\n  // Ensure output directory exists\n  await mkdir(dirname(diffPath), { recursive: true });\n\n  // Write diff image\n  await writeFile(diffPath, PNG.sync.write(diff));\n\n  const diffPercent = (diffPixels / totalPixels) * 100;\n\n  return {\n    match: diffPixels === 0,\n    diffPercent: Math.round(diffPercent * 100) / 100, // Round to 2 decimal places\n    diffPixels,\n    totalPixels,\n    threshold,\n  };\n}\n\n/**\n * Analyze comparison result and generate verdict\n */\nexport function analyzeComparison(\n  result: ComparisonResult,\n  thresholdPercent: number = 1.0\n): Analysis {\n  const { match, diffPercent, diffPixels } = result;\n\n  // Determine verdict\n  let verdict: Verdict;\n  let summary: string;\n  let recommendation: string | null = null;\n\n  if (match || diffPercent === 0) {\n    verdict = 'MATCH';\n    summary = 'No visual changes detected. Screenshots are identical.';\n  } else if (diffPercent <= thresholdPercent) {\n    verdict = 'EXPECTED_CHANGE';\n    summary = `Minor changes detected (${diffPercent}% difference). Changes appear intentional.`;\n  } else if (diffPercent <= 20) {\n    verdict = 'EXPECTED_CHANGE';\n    summary = `Moderate changes detected (${diffPercent}% difference, ${diffPixels.toLocaleString()} pixels). Review the diff image to verify changes are as expected.`;\n  } else if (diffPercent <= 50) {\n    verdict = 'UNEXPECTED_CHANGE';\n    summary = `Significant changes detected (${diffPercent}% difference). Some changes may be unintentional.`;\n    recommendation = 'Review the diff image carefully. Large portions of the page have changed.';\n  } else {\n    verdict = 'LAYOUT_BROKEN';\n    summary = `Major changes detected (${diffPercent}% difference). Layout may be broken or page failed to load correctly.`;\n    recommendation = 'Check for JavaScript errors, missing assets, or layout issues. The page appears significantly different from the baseline.';\n  }\n\n  // Generate changed regions (simplified - just one region for now)\n  const changedRegions: ChangedRegion[] = [];\n  const unexpectedChanges: ChangedRegion[] = [];\n\n  if (!match) {\n    const region: ChangedRegion = {\n      location: diffPercent > 50 ? 'full' : 'center',\n      bounds: { x: 0, y: 0, width: 0, height: 0 }, // Would need pixel analysis for accurate bounds\n      description: `${diffPercent}% of pixels changed`,\n      severity: verdict === 'LAYOUT_BROKEN' ? 'critical' :\n                verdict === 'UNEXPECTED_CHANGE' ? 'unexpected' : 'expected',\n    };\n\n    if (verdict === 'UNEXPECTED_CHANGE' || verdict === 'LAYOUT_BROKEN') {\n      unexpectedChanges.push(region);\n    } else {\n      changedRegions.push(region);\n    }\n  }\n\n  return {\n    verdict,\n    summary,\n    changedRegions,\n    unexpectedChanges,\n    recommendation,\n  };\n}\n\n/**\n * Get a human-readable verdict description\n */\nexport function getVerdictDescription(verdict: Verdict): string {\n  switch (verdict) {\n    case 'MATCH':\n      return 'No changes - screenshots match';\n    case 'EXPECTED_CHANGE':\n      return 'Changes detected - appear intentional';\n    case 'UNEXPECTED_CHANGE':\n      return 'Unexpected changes - review required';\n    case 'LAYOUT_BROKEN':\n      return 'Layout broken - significant issues detected';\n    default:\n      return 'Unknown verdict';\n  }\n}\n","import { nanoid } from 'nanoid';\nimport { mkdir, readFile, writeFile, readdir, rm } from 'fs/promises';\nimport { join } from 'path';\nimport { SessionSchema, SessionQuerySchema, type Session, type SessionQuery, type Viewport, type ComparisonResult, type Analysis } from './schemas.js';\nimport type { SessionPaths, CleanOptions } from './types.js';\n\nconst SESSION_PREFIX = 'sess_';\n\n/**\n * Generate a unique session ID\n */\nexport function generateSessionId(): string {\n  return `${SESSION_PREFIX}${nanoid(10)}`;\n}\n\n/**\n * Get paths for a session\n */\nexport function getSessionPaths(outputDir: string, sessionId: string): SessionPaths {\n  const root = join(outputDir, 'sessions', sessionId);\n  return {\n    root,\n    sessionJson: join(root, 'session.json'),\n    baseline: join(root, 'baseline.png'),\n    current: join(root, 'current.png'),\n    diff: join(root, 'diff.png'),\n  };\n}\n\n/**\n * Create a new session\n */\nexport async function createSession(\n  outputDir: string,\n  url: string,\n  name: string,\n  viewport: Viewport\n): Promise<Session> {\n  const sessionId = generateSessionId();\n  const paths = getSessionPaths(outputDir, sessionId);\n  const now = new Date().toISOString();\n\n  const session: Session = {\n    id: sessionId,\n    name,\n    url,\n    viewport,\n    status: 'baseline',\n    createdAt: now,\n    updatedAt: now,\n  };\n\n  // Create session directory\n  await mkdir(paths.root, { recursive: true });\n\n  // Write session file\n  await writeFile(paths.sessionJson, JSON.stringify(session, null, 2));\n\n  return session;\n}\n\n/**\n * Get a session by ID\n */\nexport async function getSession(outputDir: string, sessionId: string): Promise<Session | null> {\n  const paths = getSessionPaths(outputDir, sessionId);\n\n  try {\n    const content = await readFile(paths.sessionJson, 'utf-8');\n    const data = JSON.parse(content);\n    return SessionSchema.parse(data);\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Update a session\n */\nexport async function updateSession(\n  outputDir: string,\n  sessionId: string,\n  updates: Partial<Omit<Session, 'id' | 'createdAt'>>\n): Promise<Session> {\n  const session = await getSession(outputDir, sessionId);\n  if (!session) {\n    throw new Error(`Session not found: ${sessionId}`);\n  }\n\n  const updated: Session = {\n    ...session,\n    ...updates,\n    updatedAt: new Date().toISOString(),\n  };\n\n  const paths = getSessionPaths(outputDir, sessionId);\n  await writeFile(paths.sessionJson, JSON.stringify(updated, null, 2));\n\n  return updated;\n}\n\n/**\n * Mark session as compared with results\n */\nexport async function markSessionCompared(\n  outputDir: string,\n  sessionId: string,\n  comparison: ComparisonResult,\n  analysis: Analysis\n): Promise<Session> {\n  return updateSession(outputDir, sessionId, {\n    status: 'compared',\n    comparison,\n    analysis,\n  });\n}\n\n/**\n * List all sessions\n */\nexport async function listSessions(outputDir: string): Promise<Session[]> {\n  const sessionsDir = join(outputDir, 'sessions');\n\n  try {\n    const entries = await readdir(sessionsDir, { withFileTypes: true });\n    const sessions: Session[] = [];\n\n    for (const entry of entries) {\n      if (entry.isDirectory() && entry.name.startsWith(SESSION_PREFIX)) {\n        const session = await getSession(outputDir, entry.name);\n        if (session) {\n          sessions.push(session);\n        }\n      }\n    }\n\n    // Sort by creation date, newest first\n    return sessions.sort((a, b) =>\n      new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n    );\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get the most recent session\n */\nexport async function getMostRecentSession(outputDir: string): Promise<Session | null> {\n  const sessions = await listSessions(outputDir);\n  return sessions[0] || null;\n}\n\n/**\n * Delete a session\n */\nexport async function deleteSession(outputDir: string, sessionId: string): Promise<boolean> {\n  const paths = getSessionPaths(outputDir, sessionId);\n\n  try {\n    await rm(paths.root, { recursive: true, force: true });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Parse duration string to milliseconds\n */\nfunction parseDuration(duration: string): number {\n  const match = duration.match(/^(\\d+)(d|h|m|s)$/);\n  if (!match) {\n    throw new Error(`Invalid duration format: ${duration}. Use format like '7d', '24h', '30m', '60s'`);\n  }\n\n  const value = parseInt(match[1], 10);\n  const unit = match[2];\n\n  switch (unit) {\n    case 'd': return value * 24 * 60 * 60 * 1000;\n    case 'h': return value * 60 * 60 * 1000;\n    case 'm': return value * 60 * 1000;\n    case 's': return value * 1000;\n    default: return value * 1000;\n  }\n}\n\n/**\n * Clean old sessions\n */\nexport async function cleanSessions(\n  outputDir: string,\n  options: CleanOptions = {}\n): Promise<{ deleted: string[]; kept: string[] }> {\n  const { olderThan, keepLast = 0, dryRun = false } = options;\n  const sessions = await listSessions(outputDir);\n\n  const deleted: string[] = [];\n  const kept: string[] = [];\n\n  // Sessions to keep based on keepLast\n  const keepIds = new Set(sessions.slice(0, keepLast).map(s => s.id));\n\n  // Calculate cutoff time if olderThan is specified\n  const cutoffTime = olderThan\n    ? Date.now() - parseDuration(olderThan)\n    : 0;\n\n  for (const session of sessions) {\n    const sessionTime = new Date(session.createdAt).getTime();\n    const shouldDelete = !keepIds.has(session.id) &&\n      (olderThan ? sessionTime < cutoffTime : true);\n\n    if (shouldDelete && !keepIds.has(session.id)) {\n      if (!dryRun) {\n        await deleteSession(outputDir, session.id);\n      }\n      deleted.push(session.id);\n    } else {\n      kept.push(session.id);\n    }\n  }\n\n  return { deleted, kept };\n}\n\n/**\n * Find sessions matching query criteria\n */\nexport async function findSessions(\n  outputDir: string,\n  query: Partial<SessionQuery> = {}\n): Promise<Session[]> {\n  // Validate query with defaults\n  const validatedQuery = SessionQuerySchema.parse({\n    limit: 50,\n    ...query,\n  });\n\n  const allSessions = await listSessions(outputDir);\n  let filtered = allSessions;\n\n  // Filter by route (extract path from URL)\n  if (validatedQuery.route) {\n    const routePattern = validatedQuery.route.toLowerCase();\n    filtered = filtered.filter(s => {\n      try {\n        const urlPath = new URL(s.url).pathname.toLowerCase();\n        return urlPath.includes(routePattern) || urlPath === routePattern;\n      } catch {\n        return s.url.toLowerCase().includes(routePattern);\n      }\n    });\n  }\n\n  // Filter by URL (exact or partial match)\n  if (validatedQuery.url) {\n    const urlPattern = validatedQuery.url.toLowerCase();\n    filtered = filtered.filter(s => s.url.toLowerCase().includes(urlPattern));\n  }\n\n  // Filter by status\n  if (validatedQuery.status) {\n    filtered = filtered.filter(s => s.status === validatedQuery.status);\n  }\n\n  // Filter by name\n  if (validatedQuery.name) {\n    const namePattern = validatedQuery.name.toLowerCase();\n    filtered = filtered.filter(s => s.name.toLowerCase().includes(namePattern));\n  }\n\n  // Filter by viewport\n  if (validatedQuery.viewport) {\n    const viewportPattern = validatedQuery.viewport.toLowerCase();\n    filtered = filtered.filter(s => s.viewport.name.toLowerCase() === viewportPattern);\n  }\n\n  // Filter by date range\n  if (validatedQuery.createdAfter) {\n    const afterTime = validatedQuery.createdAfter.getTime();\n    filtered = filtered.filter(s => new Date(s.createdAt).getTime() >= afterTime);\n  }\n\n  if (validatedQuery.createdBefore) {\n    const beforeTime = validatedQuery.createdBefore.getTime();\n    filtered = filtered.filter(s => new Date(s.createdAt).getTime() <= beforeTime);\n  }\n\n  // Apply limit\n  return filtered.slice(0, validatedQuery.limit);\n}\n\n/**\n * Get timeline of sessions for a specific route/URL\n * Returns sessions in chronological order (oldest first) for tracking changes over time\n */\nexport async function getTimeline(\n  outputDir: string,\n  route: string,\n  limit: number = 10\n): Promise<Session[]> {\n  const sessions = await findSessions(outputDir, { route, limit });\n  // Reverse to get chronological order (oldest first)\n  return sessions.reverse();\n}\n\n/**\n * Get sessions grouped by route\n */\nexport async function getSessionsByRoute(\n  outputDir: string\n): Promise<Record<string, Session[]>> {\n  const allSessions = await listSessions(outputDir);\n  const byRoute: Record<string, Session[]> = {};\n\n  for (const session of allSessions) {\n    let route: string;\n    try {\n      route = new URL(session.url).pathname;\n    } catch {\n      route = session.url;\n    }\n\n    if (!byRoute[route]) {\n      byRoute[route] = [];\n    }\n    byRoute[route].push(session);\n  }\n\n  return byRoute;\n}\n\n/**\n * Get session statistics\n */\nexport async function getSessionStats(outputDir: string): Promise<{\n  total: number;\n  byStatus: Record<string, number>;\n  byViewport: Record<string, number>;\n  byVerdict: Record<string, number>;\n}> {\n  const sessions = await listSessions(outputDir);\n\n  const byStatus: Record<string, number> = {};\n  const byViewport: Record<string, number> = {};\n  const byVerdict: Record<string, number> = {};\n\n  for (const session of sessions) {\n    // Count by status\n    byStatus[session.status] = (byStatus[session.status] || 0) + 1;\n\n    // Count by viewport\n    const viewportName = session.viewport.name;\n    byViewport[viewportName] = (byViewport[viewportName] || 0) + 1;\n\n    // Count by verdict\n    if (session.analysis?.verdict) {\n      byVerdict[session.analysis.verdict] = (byVerdict[session.analysis.verdict] || 0) + 1;\n    }\n  }\n\n  return {\n    total: sessions.length,\n    byStatus,\n    byViewport,\n    byVerdict,\n  };\n}\n","import type { Session, ComparisonResult, Analysis, ComparisonReport } from './schemas.js';\nimport { getVerdictDescription } from './compare.js';\nimport { getSessionPaths } from './session.js';\n\n/**\n * Generate a full comparison report\n */\nexport function generateReport(\n  session: Session,\n  comparison: ComparisonResult,\n  analysis: Analysis,\n  outputDir: string,\n  webViewPort?: number\n): ComparisonReport {\n  const paths = getSessionPaths(outputDir, session.id);\n\n  const report: ComparisonReport = {\n    sessionId: session.id,\n    sessionName: session.name,\n    url: session.url,\n    timestamp: new Date().toISOString(),\n    viewport: session.viewport,\n    comparison,\n    analysis,\n    files: {\n      baseline: paths.baseline,\n      current: paths.current,\n      diff: paths.diff,\n    },\n  };\n\n  if (webViewPort) {\n    report.webViewUrl = `http://localhost:${webViewPort}/sessions/${session.id}`;\n  }\n\n  return report;\n}\n\n/**\n * Format report as human-readable text\n */\nexport function formatReportText(report: ComparisonReport): string {\n  const lines: string[] = [];\n\n  lines.push(`Session: ${report.sessionName} (${report.sessionId})`);\n  lines.push(`URL: ${report.url}`);\n  lines.push(`Viewport: ${report.viewport.name} (${report.viewport.width}x${report.viewport.height})`);\n  lines.push('');\n  lines.push('Comparison Results:');\n  lines.push(`  Match: ${report.comparison.match ? 'Yes' : 'No'}`);\n  lines.push(`  Diff: ${report.comparison.diffPercent}% (${report.comparison.diffPixels.toLocaleString()} pixels)`);\n  lines.push(`  Threshold: ${report.comparison.threshold}%`);\n  lines.push('');\n  lines.push(`Verdict: ${report.analysis.verdict}`);\n  lines.push(`  ${getVerdictDescription(report.analysis.verdict)}`);\n  lines.push('');\n  lines.push(`Summary: ${report.analysis.summary}`);\n\n  if (report.analysis.recommendation) {\n    lines.push('');\n    lines.push(`Recommendation: ${report.analysis.recommendation}`);\n  }\n\n  if (report.analysis.unexpectedChanges.length > 0) {\n    lines.push('');\n    lines.push('Unexpected Changes:');\n    for (const change of report.analysis.unexpectedChanges) {\n      lines.push(`  - ${change.location}: ${change.description}`);\n    }\n  }\n\n  lines.push('');\n  lines.push('Files:');\n  lines.push(`  Baseline: ${report.files.baseline}`);\n  lines.push(`  Current: ${report.files.current}`);\n  lines.push(`  Diff: ${report.files.diff}`);\n\n  if (report.webViewUrl) {\n    lines.push('');\n    lines.push(`View in browser: ${report.webViewUrl}`);\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * Format report as minimal output (for scripts)\n */\nexport function formatReportMinimal(report: ComparisonReport): string {\n  const status = report.comparison.match ? 'PASS' : 'FAIL';\n  return `${status} ${report.sessionId} ${report.analysis.verdict} ${report.comparison.diffPercent}%`;\n}\n\n/**\n * Format report as JSON\n */\nexport function formatReportJson(report: ComparisonReport): string {\n  return JSON.stringify(report, null, 2);\n}\n\n/**\n * Generate a summary line for session listing\n */\nexport function formatSessionSummary(session: Session): string {\n  const status = session.status.padEnd(8);\n  const viewport = `${session.viewport.name}`.padEnd(8);\n  const date = new Date(session.createdAt).toLocaleDateString();\n\n  let diffInfo = '';\n  if (session.comparison) {\n    diffInfo = session.comparison.match\n      ? ' (no diff)'\n      : ` (${session.comparison.diffPercent}% diff)`;\n  }\n\n  return `${session.id}  ${status}  ${viewport}  ${date}  ${session.name}${diffInfo}`;\n}\n","import { ConfigSchema, VIEWPORTS, type Config, type Session, type SessionQuery, type ComparisonReport } from './schemas.js';\nimport { captureScreenshot, closeBrowser } from './capture.js';\nimport { compareImages, analyzeComparison } from './compare.js';\nimport {\n  createSession,\n  getSession,\n  updateSession,\n  markSessionCompared,\n  listSessions,\n  getMostRecentSession,\n  deleteSession,\n  cleanSessions,\n  getSessionPaths,\n  findSessions,\n  getTimeline,\n  getSessionsByRoute,\n  getSessionStats,\n} from './session.js';\nimport { generateReport } from './report.js';\nimport type { StartSessionOptions, StartSessionResult, CleanOptions } from './types.js';\n\nexport class InterfaceBuiltRight {\n  private config: Config;\n\n  constructor(options: Partial<Config> = {}) {\n    // Validate and merge with defaults\n    this.config = ConfigSchema.parse(options);\n  }\n\n  /**\n   * Start a visual session by capturing a baseline screenshot\n   */\n  async startSession(path: string, options: StartSessionOptions = {}): Promise<StartSessionResult> {\n    const {\n      name = this.generateSessionName(path),\n      viewport = this.config.viewport,\n      fullPage = this.config.fullPage,\n    } = options;\n\n    const url = this.resolveUrl(path);\n\n    // Create session\n    const session = await createSession(this.config.outputDir, url, name, viewport);\n    const paths = getSessionPaths(this.config.outputDir, session.id);\n\n    // Capture baseline (outputDir enables auth state loading)\n    await captureScreenshot({\n      url,\n      outputPath: paths.baseline,\n      viewport,\n      fullPage,\n      waitForNetworkIdle: this.config.waitForNetworkIdle,\n      timeout: this.config.timeout,\n      outputDir: this.config.outputDir,\n    });\n\n    return {\n      sessionId: session.id,\n      baseline: paths.baseline,\n      session,\n    };\n  }\n\n  /**\n   * Check current state against baseline\n   */\n  async check(sessionId?: string): Promise<ComparisonReport> {\n    // Get session\n    const session = sessionId\n      ? await getSession(this.config.outputDir, sessionId)\n      : await getMostRecentSession(this.config.outputDir);\n\n    if (!session) {\n      throw new Error(sessionId\n        ? `Session not found: ${sessionId}`\n        : 'No sessions found. Run startSession first.');\n    }\n\n    const paths = getSessionPaths(this.config.outputDir, session.id);\n\n    // Capture current screenshot (outputDir enables auth state loading)\n    await captureScreenshot({\n      url: session.url,\n      outputPath: paths.current,\n      viewport: session.viewport,\n      fullPage: this.config.fullPage,\n      waitForNetworkIdle: this.config.waitForNetworkIdle,\n      timeout: this.config.timeout,\n      outputDir: this.config.outputDir,\n    });\n\n    // Compare images\n    const comparison = await compareImages({\n      baselinePath: paths.baseline,\n      currentPath: paths.current,\n      diffPath: paths.diff,\n      threshold: this.config.threshold / 100, // Convert percentage to 0-1 range for pixelmatch\n    });\n\n    // Analyze results\n    const analysis = analyzeComparison(comparison, this.config.threshold);\n\n    // Update session\n    await markSessionCompared(this.config.outputDir, session.id, comparison, analysis);\n\n    // Generate report\n    return generateReport(session, comparison, analysis, this.config.outputDir);\n  }\n\n  /**\n   * Get a session by ID\n   */\n  async getSession(sessionId: string): Promise<Session | null> {\n    return getSession(this.config.outputDir, sessionId);\n  }\n\n  /**\n   * Get the most recent session\n   */\n  async getMostRecentSession(): Promise<Session | null> {\n    return getMostRecentSession(this.config.outputDir);\n  }\n\n  /**\n   * List all sessions\n   */\n  async listSessions(): Promise<Session[]> {\n    return listSessions(this.config.outputDir);\n  }\n\n  /**\n   * Delete a session\n   */\n  async deleteSession(sessionId: string): Promise<boolean> {\n    return deleteSession(this.config.outputDir, sessionId);\n  }\n\n  /**\n   * Clean old sessions\n   */\n  async clean(options: CleanOptions = {}): Promise<{ deleted: string[]; kept: string[] }> {\n    return cleanSessions(this.config.outputDir, options);\n  }\n\n  /**\n   * Find sessions matching query criteria\n   */\n  async find(query: Partial<SessionQuery> = {}): Promise<Session[]> {\n    return findSessions(this.config.outputDir, query);\n  }\n\n  /**\n   * Get timeline of sessions for a specific route\n   * Returns sessions in chronological order (oldest first)\n   */\n  async getTimeline(route: string, limit: number = 10): Promise<Session[]> {\n    return getTimeline(this.config.outputDir, route, limit);\n  }\n\n  /**\n   * Get sessions grouped by route\n   */\n  async getSessionsByRoute(): Promise<Record<string, Session[]>> {\n    return getSessionsByRoute(this.config.outputDir);\n  }\n\n  /**\n   * Get session statistics\n   */\n  async getStats(): Promise<{\n    total: number;\n    byStatus: Record<string, number>;\n    byViewport: Record<string, number>;\n    byVerdict: Record<string, number>;\n  }> {\n    return getSessionStats(this.config.outputDir);\n  }\n\n  /**\n   * Update baseline with current screenshot\n   */\n  async updateBaseline(sessionId?: string): Promise<Session> {\n    const session = sessionId\n      ? await getSession(this.config.outputDir, sessionId)\n      : await getMostRecentSession(this.config.outputDir);\n\n    if (!session) {\n      throw new Error(sessionId\n        ? `Session not found: ${sessionId}`\n        : 'No sessions found.');\n    }\n\n    const paths = getSessionPaths(this.config.outputDir, session.id);\n\n    // Capture new baseline (outputDir enables auth state loading)\n    await captureScreenshot({\n      url: session.url,\n      outputPath: paths.baseline,\n      viewport: session.viewport,\n      fullPage: this.config.fullPage,\n      waitForNetworkIdle: this.config.waitForNetworkIdle,\n      timeout: this.config.timeout,\n      outputDir: this.config.outputDir,\n    });\n\n    // Reset session status\n    return updateSession(this.config.outputDir, session.id, {\n      status: 'baseline',\n      comparison: undefined,\n      analysis: undefined,\n    });\n  }\n\n  /**\n   * Close the browser instance\n   */\n  async close(): Promise<void> {\n    await closeBrowser();\n  }\n\n  /**\n   * Get configuration\n   */\n  getConfig(): Config {\n    return { ...this.config };\n  }\n\n  /**\n   * Resolve a path to full URL\n   */\n  private resolveUrl(path: string): string {\n    if (path.startsWith('http://') || path.startsWith('https://')) {\n      return path;\n    }\n    return `${this.config.baseUrl}${path.startsWith('/') ? path : `/${path}`}`;\n  }\n\n  /**\n   * Generate a session name from path\n   */\n  private generateSessionName(path: string): string {\n    // Remove leading slash and replace remaining slashes with dashes\n    return path\n      .replace(/^\\/+/, '')\n      .replace(/\\//g, '-')\n      .replace(/[^a-zA-Z0-9-_]/g, '')\n      || 'homepage';\n  }\n}\n\n// Export everything for programmatic use\nexport * from './schemas.js';\nexport * from './types.js';\nexport { captureScreenshot, closeBrowser, getViewport } from './capture.js';\nexport { compareImages, analyzeComparison, getVerdictDescription } from './compare.js';\nexport {\n  createSession,\n  getSession,\n  updateSession,\n  markSessionCompared,\n  listSessions,\n  getMostRecentSession,\n  deleteSession,\n  cleanSessions,\n  getSessionPaths,\n  generateSessionId,\n  findSessions,\n  getTimeline,\n  getSessionsByRoute,\n  getSessionStats,\n} from './session.js';\nexport { generateReport, formatReportText, formatReportJson, formatReportMinimal, formatSessionSummary } from './report.js';\nexport { VIEWPORTS };\n"],"mappings":"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","names":["browser","resolve","import_promises","import_path","import_fs","import_playwright","import_promises","import_path","import_promises","import_path","pixelmatch","import_promises","import_path","resolve","performLogin","clearAuthState","writeFile"]}