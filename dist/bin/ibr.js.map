{"version":3,"sources":["../../src/schemas.ts","../../src/auth.ts","../../src/capture.ts","../../src/consistency.ts","../../src/crawl.ts","../../src/rules/presets/minimal.ts","../../src/rules/engine.ts","../../src/extract.ts","../../src/browser-server.ts","../../src/live-session.ts","../../src/bin/ibr.ts","../../src/index.ts","../../src/compare.ts","../../src/session.ts","../../src/report.ts"],"sourcesContent":["import { z } from 'zod';\n\n/**\n * Viewport configuration for screenshot capture\n * Supports predefined names or custom dimensions\n */\nexport const ViewportSchema = z.object({\n  name: z.string().min(1).max(50),\n  width: z.number().min(320).max(3840),\n  height: z.number().min(480).max(2160),\n});\n\n/**\n * Predefined viewport configurations\n */\nexport const VIEWPORTS = {\n  desktop: { name: 'desktop', width: 1920, height: 1080 },\n  'desktop-lg': { name: 'desktop-lg', width: 2560, height: 1440 },\n  'desktop-sm': { name: 'desktop-sm', width: 1440, height: 900 },\n  laptop: { name: 'laptop', width: 1366, height: 768 },\n  tablet: { name: 'tablet', width: 768, height: 1024 },\n  'tablet-landscape': { name: 'tablet-landscape', width: 1024, height: 768 },\n  mobile: { name: 'mobile', width: 375, height: 667 },\n  'mobile-lg': { name: 'mobile-lg', width: 414, height: 896 },\n  'iphone-14': { name: 'iphone-14', width: 390, height: 844 },\n  'iphone-14-pro-max': { name: 'iphone-14-pro-max', width: 430, height: 932 },\n} as const;\n\n/**\n * Main configuration for InterfaceBuiltRight\n */\nexport const ConfigSchema = z.object({\n  baseUrl: z.string().url('Must be a valid URL'),\n  outputDir: z.string().default('./.ibr'),\n  viewport: ViewportSchema.default(VIEWPORTS.desktop),\n  viewports: z.array(ViewportSchema).optional(), // Multi-viewport support\n  threshold: z.number().min(0).max(100).default(1.0),\n  fullPage: z.boolean().default(true),\n  waitForNetworkIdle: z.boolean().default(true),\n  timeout: z.number().min(1000).max(120000).default(30000),\n});\n\n/**\n * Session query options\n */\nexport const SessionQuerySchema = z.object({\n  route: z.string().optional(),\n  url: z.string().optional(),\n  status: z.enum(['baseline', 'compared', 'pending']).optional(),\n  name: z.string().optional(),\n  createdAfter: z.date().optional(),\n  createdBefore: z.date().optional(),\n  viewport: z.string().optional(),\n  limit: z.number().min(1).max(100).default(50),\n});\n\n/**\n * Comparison result from pixelmatch\n */\nexport const ComparisonResultSchema = z.object({\n  match: z.boolean(),\n  diffPercent: z.number(),\n  diffPixels: z.number(),\n  totalPixels: z.number(),\n  threshold: z.number(),\n});\n\n/**\n * Changed region detected in comparison\n */\nexport const ChangedRegionSchema = z.object({\n  location: z.enum(['top', 'bottom', 'left', 'right', 'center', 'full']),\n  bounds: z.object({\n    x: z.number(),\n    y: z.number(),\n    width: z.number(),\n    height: z.number(),\n  }),\n  description: z.string(),\n  severity: z.enum(['expected', 'unexpected', 'critical']),\n});\n\n/**\n * Analysis verdict types\n */\nexport const VerdictSchema = z.enum([\n  'MATCH',\n  'EXPECTED_CHANGE',\n  'UNEXPECTED_CHANGE',\n  'LAYOUT_BROKEN',\n]);\n\n/**\n * Analysis result\n */\nexport const AnalysisSchema = z.object({\n  verdict: VerdictSchema,\n  summary: z.string(),\n  changedRegions: z.array(ChangedRegionSchema),\n  unexpectedChanges: z.array(ChangedRegionSchema),\n  recommendation: z.string().nullable(),\n});\n\n/**\n * Session status\n */\nexport const SessionStatusSchema = z.enum(['baseline', 'compared', 'pending']);\n\n/**\n * Visual session\n */\nexport const SessionSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  url: z.string().url(),\n  viewport: ViewportSchema,\n  status: SessionStatusSchema,\n  createdAt: z.string().datetime(),\n  updatedAt: z.string().datetime(),\n  comparison: ComparisonResultSchema.optional(),\n  analysis: AnalysisSchema.optional(),\n});\n\n/**\n * Full comparison report\n */\nexport const ComparisonReportSchema = z.object({\n  sessionId: z.string(),\n  sessionName: z.string(),\n  url: z.string(),\n  timestamp: z.string().datetime(),\n  viewport: ViewportSchema,\n  comparison: ComparisonResultSchema,\n  analysis: AnalysisSchema,\n  files: z.object({\n    baseline: z.string(),\n    current: z.string(),\n    diff: z.string(),\n  }),\n  webViewUrl: z.string().optional(),\n});\n\n/**\n * Element interactivity detection\n */\nexport const InteractiveStateSchema = z.object({\n  hasOnClick: z.boolean(),\n  hasHref: z.boolean(),\n  isDisabled: z.boolean(),\n  tabIndex: z.number(),\n  cursor: z.string(),\n  // Framework-specific detection\n  hasReactHandler: z.boolean().optional(),\n  hasVueHandler: z.boolean().optional(),\n  hasAngularHandler: z.boolean().optional(),\n});\n\n/**\n * Accessibility attributes\n */\nexport const A11yAttributesSchema = z.object({\n  role: z.string().nullable(),\n  ariaLabel: z.string().nullable(),\n  ariaDescribedBy: z.string().nullable(),\n  ariaHidden: z.boolean().optional(),\n});\n\n/**\n * Element bounds\n */\nexport const BoundsSchema = z.object({\n  x: z.number(),\n  y: z.number(),\n  width: z.number(),\n  height: z.number(),\n});\n\n/**\n * Enhanced element with interactivity and accessibility\n */\nexport const EnhancedElementSchema = z.object({\n  // Identity\n  selector: z.string(),\n  tagName: z.string(),\n  id: z.string().optional(),\n  className: z.string().optional(),\n  text: z.string().optional(),\n\n  // Position\n  bounds: BoundsSchema,\n\n  // Styles (subset)\n  computedStyles: z.record(z.string()).optional(),\n\n  // Interactivity\n  interactive: InteractiveStateSchema,\n\n  // Accessibility\n  a11y: A11yAttributesSchema,\n\n  // Source hints for debugging\n  sourceHint: z.object({\n    dataTestId: z.string().nullable(),\n  }).optional(),\n});\n\n/**\n * Element issue detected during audit\n */\nexport const ElementIssueSchema = z.object({\n  type: z.enum([\n    'NO_HANDLER',           // Interactive-looking but no handler\n    'PLACEHOLDER_LINK',     // href=\"#\" without handler\n    'TOUCH_TARGET_SMALL',   // < 44px on mobile\n    'MISSING_ARIA_LABEL',   // Interactive without label\n    'DISABLED_NO_VISUAL',   // Disabled but no visual indication\n  ]),\n  severity: z.enum(['error', 'warning', 'info']),\n  message: z.string(),\n});\n\n/**\n * Audit result for a captured page\n */\nexport const AuditResultSchema = z.object({\n  totalElements: z.number(),\n  interactiveCount: z.number(),\n  withHandlers: z.number(),\n  withoutHandlers: z.number(),\n  issues: z.array(ElementIssueSchema),\n});\n\n// Type exports - auto-generated from schemas\nexport type Viewport = z.infer<typeof ViewportSchema>;\nexport type Config = z.infer<typeof ConfigSchema>;\nexport type SessionQuery = z.infer<typeof SessionQuerySchema>;\nexport type ComparisonResult = z.infer<typeof ComparisonResultSchema>;\nexport type ChangedRegion = z.infer<typeof ChangedRegionSchema>;\nexport type Verdict = z.infer<typeof VerdictSchema>;\nexport type Analysis = z.infer<typeof AnalysisSchema>;\nexport type SessionStatus = z.infer<typeof SessionStatusSchema>;\nexport type Session = z.infer<typeof SessionSchema>;\nexport type ComparisonReport = z.infer<typeof ComparisonReportSchema>;\nexport type InteractiveState = z.infer<typeof InteractiveStateSchema>;\nexport type A11yAttributes = z.infer<typeof A11yAttributesSchema>;\nexport type Bounds = z.infer<typeof BoundsSchema>;\nexport type EnhancedElement = z.infer<typeof EnhancedElementSchema>;\nexport type ElementIssue = z.infer<typeof ElementIssueSchema>;\nexport type AuditResult = z.infer<typeof AuditResultSchema>;\n\n/**\n * Rule severity levels\n */\nexport const RuleSeveritySchema = z.enum(['off', 'warn', 'error']);\n\n/**\n * Individual rule setting\n */\nexport const RuleSettingSchema = z.union([\n  RuleSeveritySchema,\n  z.tuple([RuleSeveritySchema, z.record(z.unknown())]),\n]);\n\n/**\n * Rules configuration (user's .ibr/rules.json)\n */\nexport const RulesConfigSchema = z.object({\n  extends: z.array(z.string()).optional(),\n  rules: z.record(RuleSettingSchema).optional(),\n});\n\n/**\n * Violation detected by a rule\n */\nexport const ViolationSchema = z.object({\n  ruleId: z.string(),\n  ruleName: z.string(),\n  severity: z.enum(['warn', 'error']),\n  message: z.string(),\n  element: z.string().optional(),  // Selector of violating element\n  bounds: BoundsSchema.optional(),\n  fix: z.string().optional(),       // Suggested fix\n});\n\n/**\n * Full audit report with rule violations\n */\nexport const RuleAuditResultSchema = z.object({\n  url: z.string(),\n  timestamp: z.string(),\n  elementsScanned: z.number(),\n  violations: z.array(ViolationSchema),\n  summary: z.object({\n    errors: z.number(),\n    warnings: z.number(),\n    passed: z.number(),\n  }),\n});\n\n// Rule-related type exports\nexport type RuleSeverity = z.infer<typeof RuleSeveritySchema>;\nexport type RuleSetting = z.infer<typeof RuleSettingSchema>;\nexport type RulesConfig = z.infer<typeof RulesConfigSchema>;\nexport type Violation = z.infer<typeof ViolationSchema>;\nexport type RuleAuditResult = z.infer<typeof RuleAuditResultSchema>;\n","import { chromium } from 'playwright';\nimport { mkdir, access, readFile, writeFile, unlink, chmod, stat } from 'fs/promises';\nimport { join, dirname, resolve } from 'path';\nimport { existsSync, readFileSync } from 'fs';\nimport { userInfo, homedir } from 'os';\nimport { createHash, randomBytes } from 'crypto';\nimport type { LoginOptions } from './types.js';\n\nconst AUTH_STATE_FILE = 'auth.json';\n\n/**\n * Auth state with metadata for security\n */\ninterface StoredAuthState {\n  state: object; // Playwright storage state\n  metadata: {\n    createdAt: number;\n    expiresAt: number;\n    username: string;\n    projectPath: string;\n  };\n}\n\n/**\n * Check if running in a CI/CD or deployed environment\n * Auth operations should be blocked in these environments\n */\nexport function isDeployedEnvironment(): boolean {\n  return !!(\n    process.env.VERCEL ||\n    process.env.NETLIFY ||\n    process.env.CI ||\n    process.env.GITHUB_ACTIONS ||\n    process.env.GITLAB_CI ||\n    process.env.CIRCLECI ||\n    process.env.JENKINS_URL ||\n    process.env.TRAVIS ||\n    process.env.HEROKU ||\n    process.env.AWS_LAMBDA_FUNCTION_NAME ||\n    process.env.AZURE_FUNCTIONS_ENVIRONMENT\n  );\n}\n\n/**\n * Get the path to the auth state file\n * Uses per-user isolation to prevent credential sharing\n */\nexport function getAuthStatePath(outputDir: string): string {\n  const username = userInfo().username;\n  // Include username in filename for user isolation\n  return join(outputDir, `auth.${username}.json`);\n}\n\n/**\n * Get a secure auth path in user's home directory (alternative)\n * This keeps auth completely outside the project directory\n */\nexport function getSecureAuthPath(projectPath: string): string {\n  const username = userInfo().username;\n  // Hash project path to create unique identifier\n  const projectHash = createHash('sha256')\n    .update(resolve(projectPath))\n    .digest('hex')\n    .substring(0, 16);\n\n  return join(\n    homedir(),\n    '.config',\n    'ibr',\n    'auth',\n    `${projectHash}.${username}.json`\n  );\n}\n\n/**\n * Check if .gitignore properly excludes .ibr directory\n */\nfunction validateGitignore(projectDir: string): void {\n  const gitignorePath = join(projectDir, '.gitignore');\n\n  if (existsSync(gitignorePath)) {\n    const gitignore = readFileSync(gitignorePath, 'utf-8');\n    const lines = gitignore.split('\\n').map(l => l.trim());\n\n    const hasIbrIgnore = lines.some(line =>\n      line === '.ibr/' ||\n      line === '.ibr' ||\n      line === '**/.ibr/' ||\n      line === '**/.ibr'\n    );\n\n    if (!hasIbrIgnore) {\n      console.warn('\\n‚ö†Ô∏è  WARNING: .ibr/ is not in .gitignore!');\n      console.warn('   Add \".ibr/\" to .gitignore to prevent credential leaks.\\n');\n    }\n  } else {\n    console.warn('\\n‚ö†Ô∏è  No .gitignore found. Create one with \".ibr/\" entry.\\n');\n  }\n}\n\n/**\n * Check if auth state exists\n */\nexport async function hasAuthState(outputDir: string): Promise<boolean> {\n  try {\n    await access(getAuthStatePath(outputDir));\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Load auth state if it exists and is valid\n */\nexport async function loadAuthState(outputDir: string): Promise<object | null> {\n  // Block in deployed environments\n  if (isDeployedEnvironment()) {\n    console.warn('‚ö†Ô∏è  Deployed environment detected. Auth state not available.');\n    return null;\n  }\n\n  try {\n    const authPath = getAuthStatePath(outputDir);\n    const content = await readFile(authPath, 'utf-8');\n    const stored: StoredAuthState = JSON.parse(content);\n\n    // Validate metadata exists\n    if (!stored.metadata) {\n      console.warn('‚ö†Ô∏è  Legacy auth format detected. Please re-authenticate with `ibr login`.');\n      return null;\n    }\n\n    // Check user matches\n    const currentUser = userInfo().username;\n    if (stored.metadata.username !== currentUser) {\n      console.warn(`‚ö†Ô∏è  Auth state belongs to different user (${stored.metadata.username}).`);\n      return null;\n    }\n\n    // Check expiration\n    if (Date.now() > stored.metadata.expiresAt) {\n      console.warn('‚ö†Ô∏è  Auth state expired. Please re-authenticate with `ibr login`.');\n      await clearAuthState(outputDir);\n      return null;\n    }\n\n    // Warn if auth is getting old (> 24 hours)\n    const ageHours = (Date.now() - stored.metadata.createdAt) / (1000 * 60 * 60);\n    if (ageHours > 24) {\n      console.warn(`‚ö†Ô∏è  Auth state is ${Math.floor(ageHours)} hours old. Consider re-authenticating.`);\n    }\n\n    return stored.state;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Open a browser for manual login and save the state\n *\n * This opens a visible browser window where the user can:\n * 1. Navigate to login page\n * 2. Enter credentials\n * 3. Complete any 2FA or other auth steps\n *\n * When done, close the browser or press Ctrl+C to save the state.\n */\nexport async function performLogin(options: LoginOptions): Promise<string> {\n  const { url, outputDir, timeout = 300000 } = options; // 5 min default timeout\n\n  // Block in deployed environments\n  if (isDeployedEnvironment()) {\n    throw new Error(\n      'Authentication cannot be performed in deployed environments.\\n' +\n      'Run `ibr login` locally on your development machine.'\n    );\n  }\n\n  // Validate .gitignore before storing credentials\n  validateGitignore(process.cwd());\n\n  // Ensure output directory exists with restricted permissions\n  await mkdir(outputDir, { recursive: true, mode: 0o700 }); // rwx------\n\n  // Fix permissions on existing directory\n  try {\n    await chmod(outputDir, 0o700);\n  } catch {\n    // Ignore if chmod fails (e.g., on Windows)\n  }\n\n  const authStatePath = getAuthStatePath(outputDir);\n  const currentUser = userInfo().username;\n\n  console.log('\\nüîê Opening browser for login...');\n  console.log(`   User: ${currentUser}`);\n  console.log('   Navigate to your login page and complete authentication.');\n  console.log('   When finished, close the browser window to save your session.\\n');\n\n  const browser = await chromium.launch({\n    headless: false, // Visible browser for manual login\n  });\n\n  const context = await browser.newContext({\n    viewport: { width: 1280, height: 800 },\n  });\n\n  const page = await context.newPage();\n\n  try {\n    // Navigate to the provided URL\n    await page.goto(url, {\n      waitUntil: 'domcontentloaded',\n      timeout: 30000,\n    });\n\n    // Wait for browser to close (user manually closes it after login)\n    // or timeout after the specified duration\n    await Promise.race([\n      new Promise<void>((resolve) => {\n        browser.on('disconnected', () => resolve());\n      }),\n      new Promise<void>((_, reject) => {\n        setTimeout(() => reject(new Error('Login timeout exceeded')), timeout);\n      }),\n    ]);\n\n  } catch (error) {\n    // If browser is still open, save the state before closing\n    if (browser.isConnected()) {\n      await saveAuthState(context, authStatePath, outputDir);\n      await browser.close();\n    }\n\n    // Check if it was a timeout or browser close\n    if (error instanceof Error && error.message.includes('timeout')) {\n      throw error;\n    }\n  }\n\n  // If we get here without the browser being disconnected, save state\n  if (browser.isConnected()) {\n    await saveAuthState(context, authStatePath, outputDir);\n    await browser.close();\n  } else {\n    // Browser was closed by user - try to reconnect to save state\n    console.log('\\n‚ö†Ô∏è  Browser was closed. Attempting to save any captured state...');\n\n    // Create a new context just to save an empty state as fallback\n    const newBrowser = await chromium.launch({ headless: true });\n    const newContext = await newBrowser.newContext();\n\n    // Try to use any cookies from the page\n    try {\n      await newContext.addCookies(await context.cookies());\n    } catch {\n      // Context might be closed\n    }\n\n    await saveAuthState(newContext, authStatePath, outputDir);\n    await newBrowser.close();\n  }\n\n  console.log(`\\n‚úÖ Auth state saved for user: ${currentUser}`);\n  console.log(`   Location: ${authStatePath}`);\n  console.log('   Expires: 7 days from now');\n  console.log('   Future captures will use this authentication.\\n');\n\n  return authStatePath;\n}\n\n/**\n * Save auth state with metadata and secure permissions\n */\nasync function saveAuthState(\n  context: Awaited<ReturnType<typeof chromium.launch>>['contexts'][0],\n  authStatePath: string,\n  outputDir: string\n): Promise<void> {\n  const state = await context.storageState();\n  const currentUser = userInfo().username;\n\n  const storedState: StoredAuthState = {\n    state,\n    metadata: {\n      createdAt: Date.now(),\n      expiresAt: Date.now() + (7 * 24 * 60 * 60 * 1000), // 7 days\n      username: currentUser,\n      projectPath: resolve(process.cwd()),\n    }\n  };\n\n  // Write with restricted permissions (owner read/write only)\n  await writeFile(\n    authStatePath,\n    JSON.stringify(storedState, null, 2),\n    { mode: 0o600 } // rw-------\n  );\n\n  // Ensure permissions are correct (in case file existed)\n  try {\n    await chmod(authStatePath, 0o600);\n  } catch {\n    // Ignore if chmod fails (e.g., on Windows)\n  }\n}\n\n/**\n * Clear saved auth state with secure deletion\n */\nexport async function clearAuthState(outputDir: string): Promise<void> {\n  const authPath = getAuthStatePath(outputDir);\n\n  try {\n    // Get file stats for size\n    const stats = await stat(authPath);\n\n    // Overwrite with random data before deletion (secure delete)\n    const randomData = randomBytes(stats.size);\n    await writeFile(authPath, randomData, { mode: 0o600 });\n\n    // Now delete the file\n    await unlink(authPath);\n\n    console.log('‚úÖ Auth state securely cleared');\n  } catch {\n    console.log('‚ÑπÔ∏è  No auth state to clear');\n  }\n}\n\n/**\n * Get auth state info without loading the full state\n */\nexport async function getAuthStateInfo(outputDir: string): Promise<{\n  exists: boolean;\n  username?: string;\n  createdAt?: Date;\n  expiresAt?: Date;\n  expired?: boolean;\n} | null> {\n  try {\n    const authPath = getAuthStatePath(outputDir);\n    const content = await readFile(authPath, 'utf-8');\n    const stored: StoredAuthState = JSON.parse(content);\n\n    if (!stored.metadata) {\n      return { exists: true };\n    }\n\n    return {\n      exists: true,\n      username: stored.metadata.username,\n      createdAt: new Date(stored.metadata.createdAt),\n      expiresAt: new Date(stored.metadata.expiresAt),\n      expired: Date.now() > stored.metadata.expiresAt,\n    };\n  } catch {\n    return null;\n  }\n}\n","import { chromium, type Browser } from 'playwright';\nimport { mkdir } from 'fs/promises';\nimport { dirname } from 'path';\nimport { VIEWPORTS, type Viewport } from './schemas.js';\nimport type { CaptureOptions } from './types.js';\nimport { loadAuthState, isDeployedEnvironment } from './auth.js';\n\n/**\n * Capture result with timing and diagnostic info\n */\nexport interface CaptureResult {\n  success: boolean;\n  outputPath?: string;\n  timing: {\n    navigationMs: number;\n    renderMs: number;\n    totalMs: number;\n  };\n  diagnostics: {\n    httpStatus?: number;\n    consoleErrors: string[];\n    networkErrors: string[];\n    suggestions: string[];\n  };\n  error?: {\n    type: 'timeout' | 'navigation' | 'screenshot' | 'unknown';\n    message: string;\n    suggestion: string;\n  };\n}\n\n// Playwright's storage state type\ntype StorageState = {\n  cookies: Array<{\n    name: string;\n    value: string;\n    domain: string;\n    path: string;\n    expires: number;\n    httpOnly: boolean;\n    secure: boolean;\n    sameSite: 'Strict' | 'Lax' | 'None';\n  }>;\n  origins: Array<{\n    origin: string;\n    localStorage: Array<{ name: string; value: string }>;\n  }>;\n};\n\nlet browser: Browser | null = null;\n\n/**\n * Get or create a browser instance\n */\nasync function getBrowser(): Promise<Browser> {\n  if (!browser) {\n    browser = await chromium.launch({\n      headless: true,\n    });\n  }\n  return browser;\n}\n\n/**\n * Close the browser instance\n */\nexport async function closeBrowser(): Promise<void> {\n  if (browser) {\n    await browser.close();\n    browser = null;\n  }\n}\n\n/**\n * Capture a screenshot of a URL\n */\nexport async function captureScreenshot(\n  options: CaptureOptions & { outputDir?: string }\n): Promise<string> {\n  const {\n    url,\n    outputPath,\n    viewport = VIEWPORTS.desktop,\n    fullPage = true,\n    waitForNetworkIdle = true,\n    timeout = 30000,\n    outputDir,\n    selector,\n    waitFor,\n  } = options;\n\n  // Ensure output directory exists\n  await mkdir(dirname(outputPath), { recursive: true });\n\n  // Load auth state if available (handles validation, expiration, user isolation)\n  let storageState: StorageState | undefined;\n  if (outputDir && !isDeployedEnvironment()) {\n    const authState = await loadAuthState(outputDir);\n    if (authState) {\n      storageState = authState as StorageState;\n      console.log('üîê Using saved authentication state');\n    }\n  }\n\n  const browserInstance = await getBrowser();\n  const context = await browserInstance.newContext({\n    viewport: {\n      width: viewport.width,\n      height: viewport.height,\n    },\n    // Disable animations for consistent screenshots\n    reducedMotion: 'reduce',\n    // Load auth state if available (Playwright accepts object or file path)\n    ...(storageState ? { storageState } : {}),\n  });\n\n  const page = await context.newPage();\n\n  try {\n    // Navigate to URL\n    await page.goto(url, {\n      waitUntil: waitForNetworkIdle ? 'networkidle' : 'load',\n      timeout,\n    });\n\n    // Wait for specific selector if provided (for dynamic content)\n    if (waitFor) {\n      await page.waitForSelector(waitFor, { timeout });\n    }\n\n    // Wait for any remaining animations to settle\n    await page.waitForTimeout(500);\n\n    // Disable CSS animations and transitions\n    await page.addStyleTag({\n      content: `\n        *, *::before, *::after {\n          animation-duration: 0s !important;\n          animation-delay: 0s !important;\n          transition-duration: 0s !important;\n          transition-delay: 0s !important;\n        }\n      `,\n    });\n\n    // Take screenshot - element or full page\n    if (selector) {\n      // Wait for element and capture just that element\n      const element = await page.waitForSelector(selector, { timeout: 5000 });\n      if (!element) {\n        throw new Error(`Element not found: ${selector}`);\n      }\n      await element.screenshot({\n        path: outputPath,\n        type: 'png',\n      });\n    } else {\n      await page.screenshot({\n        path: outputPath,\n        fullPage,\n        type: 'png',\n      });\n    }\n\n    return outputPath;\n  } finally {\n    await context.close();\n  }\n}\n\n/**\n * Get viewport dimensions by name\n */\nexport function getViewport(name: 'desktop' | 'mobile' | 'tablet'): Viewport {\n  return VIEWPORTS[name];\n}\n\n/**\n * Capture multiple viewports\n */\nexport async function captureMultipleViewports(\n  url: string,\n  outputDir: string,\n  viewports: Array<'desktop' | 'mobile' | 'tablet'> = ['desktop'],\n  options: Omit<CaptureOptions, 'url' | 'outputPath' | 'viewport'> = {}\n): Promise<Record<string, string>> {\n  const results: Record<string, string> = {};\n\n  for (const viewportName of viewports) {\n    const viewport = getViewport(viewportName);\n    const outputPath = `${outputDir}/${viewportName}.png`;\n\n    await captureScreenshot({\n      url,\n      outputPath,\n      viewport,\n      ...options,\n    });\n\n    results[viewportName] = outputPath;\n  }\n\n  return results;\n}\n\n/**\n * Enhanced capture with detailed timing and diagnostics\n * Returns actionable info for debugging slow loads or errors\n */\nexport async function captureWithDiagnostics(\n  options: CaptureOptions & { outputDir?: string }\n): Promise<CaptureResult> {\n  const {\n    url,\n    outputPath,\n    viewport = VIEWPORTS.desktop,\n    fullPage = true,\n    waitForNetworkIdle = true,\n    timeout = 30000,\n    outputDir,\n    selector,\n  } = options;\n\n  const startTime = Date.now();\n  let navigationTime = 0;\n  let renderTime = 0;\n\n  const consoleErrors: string[] = [];\n  const networkErrors: string[] = [];\n  const suggestions: string[] = [];\n  let httpStatus: number | undefined;\n\n  try {\n    // Ensure output directory exists\n    await mkdir(dirname(outputPath), { recursive: true });\n\n    // Load auth state if available\n    let storageState: StorageState | undefined;\n    if (outputDir && !isDeployedEnvironment()) {\n      const authState = await loadAuthState(outputDir);\n      if (authState) {\n        storageState = authState as StorageState;\n      }\n    }\n\n    const browserInstance = await getBrowser();\n    const context = await browserInstance.newContext({\n      viewport: {\n        width: viewport.width,\n        height: viewport.height,\n      },\n      reducedMotion: 'reduce',\n      ...(storageState ? { storageState } : {}),\n    });\n\n    const page = await context.newPage();\n\n    // Collect console errors\n    page.on('console', msg => {\n      if (msg.type() === 'error') {\n        consoleErrors.push(msg.text());\n      }\n    });\n\n    // Collect network errors\n    page.on('requestfailed', request => {\n      const failure = request.failure();\n      networkErrors.push(`${request.url()}: ${failure?.errorText || 'failed'}`);\n    });\n\n    // Track HTTP status\n    page.on('response', response => {\n      if (response.url() === url || response.url() === url + '/') {\n        httpStatus = response.status();\n      }\n    });\n\n    try {\n      const navStart = Date.now();\n      await page.goto(url, {\n        waitUntil: waitForNetworkIdle ? 'networkidle' : 'load',\n        timeout,\n      });\n      navigationTime = Date.now() - navStart;\n    } catch (navError) {\n      await context.close();\n\n      const errorMsg = navError instanceof Error ? navError.message : String(navError);\n      const isTimeout = errorMsg.includes('Timeout');\n\n      // Generate helpful suggestions\n      if (isTimeout) {\n        suggestions.push(`Page took longer than ${timeout}ms to load`);\n        suggestions.push('Try increasing timeout: --timeout 60000');\n        if (waitForNetworkIdle) {\n          suggestions.push('Try disabling network idle wait: use \"load\" instead of \"networkidle\"');\n        }\n      }\n      if (networkErrors.length > 0) {\n        suggestions.push(`${networkErrors.length} network request(s) failed`);\n      }\n      if (httpStatus && httpStatus >= 400) {\n        suggestions.push(`Server returned HTTP ${httpStatus}`);\n      }\n\n      return {\n        success: false,\n        timing: {\n          navigationMs: Date.now() - startTime,\n          renderMs: 0,\n          totalMs: Date.now() - startTime,\n        },\n        diagnostics: {\n          httpStatus,\n          consoleErrors,\n          networkErrors,\n          suggestions,\n        },\n        error: {\n          type: isTimeout ? 'timeout' : 'navigation',\n          message: errorMsg,\n          suggestion: isTimeout\n            ? `Increase timeout or check if ${url} is responding`\n            : `Check if the server is running at ${url}`,\n        },\n      };\n    }\n\n    // Wait for animations to settle\n    await page.waitForTimeout(500);\n\n    // Disable CSS animations\n    await page.addStyleTag({\n      content: `\n        *, *::before, *::after {\n          animation-duration: 0s !important;\n          animation-delay: 0s !important;\n          transition-duration: 0s !important;\n          transition-delay: 0s !important;\n        }\n      `,\n    });\n\n    // Take screenshot - element or full page\n    const renderStart = Date.now();\n    if (selector) {\n      const element = await page.waitForSelector(selector, { timeout: 5000 });\n      if (!element) {\n        throw new Error(`Element not found: ${selector}`);\n      }\n      await element.screenshot({\n        path: outputPath,\n        type: 'png',\n      });\n    } else {\n      await page.screenshot({\n        path: outputPath,\n        fullPage,\n        type: 'png',\n      });\n    }\n    renderTime = Date.now() - renderStart;\n\n    await context.close();\n\n    // Generate performance suggestions\n    if (navigationTime > 5000) {\n      suggestions.push(`Slow page load: ${(navigationTime / 1000).toFixed(1)}s`);\n    }\n    if (consoleErrors.length > 0) {\n      suggestions.push(`${consoleErrors.length} JavaScript error(s) detected`);\n    }\n\n    return {\n      success: true,\n      outputPath,\n      timing: {\n        navigationMs: navigationTime,\n        renderMs: renderTime,\n        totalMs: Date.now() - startTime,\n      },\n      diagnostics: {\n        httpStatus,\n        consoleErrors,\n        networkErrors,\n        suggestions,\n      },\n    };\n  } catch (error) {\n    const errorMsg = error instanceof Error ? error.message : String(error);\n\n    return {\n      success: false,\n      timing: {\n        navigationMs: navigationTime,\n        renderMs: renderTime,\n        totalMs: Date.now() - startTime,\n      },\n      diagnostics: {\n        httpStatus,\n        consoleErrors,\n        networkErrors,\n        suggestions,\n      },\n      error: {\n        type: 'unknown',\n        message: errorMsg,\n        suggestion: 'Check browser installation: npx playwright install chromium',\n      },\n    };\n  }\n}\n","import { chromium, Browser } from 'playwright';\n\n/**\n * UI metrics extracted from a page for consistency checking\n */\nexport interface PageMetrics {\n  url: string;\n  path: string;\n  title: string;\n\n  // Layout metrics\n  layout: {\n    headerHeight: number | null;\n    navWidth: number | null;\n    contentPadding: { top: number; right: number; bottom: number; left: number } | null;\n    footerHeight: number | null;\n  };\n\n  // Typography metrics\n  typography: {\n    bodyFontFamily: string | null;\n    bodyFontSize: string | null;\n    headingFontFamily: string | null;\n    h1FontSize: string | null;\n    h2FontSize: string | null;\n    lineHeight: string | null;\n  };\n\n  // Color metrics\n  colors: {\n    backgroundColor: string | null;\n    textColor: string | null;\n    linkColor: string | null;\n    primaryButtonBg: string | null;\n    primaryButtonText: string | null;\n  };\n\n  // Spacing metrics (common elements)\n  spacing: {\n    buttonPadding: string | null;\n    cardPadding: string | null;\n    sectionGap: string | null;\n  };\n}\n\n/**\n * Inconsistency found between pages\n */\nexport interface Inconsistency {\n  type: 'layout' | 'typography' | 'color' | 'spacing';\n  property: string;\n  severity: 'info' | 'warning' | 'error';\n  description: string;\n  pages: Array<{\n    path: string;\n    value: string | number | null;\n  }>;\n  suggestion?: string;\n}\n\n/**\n * Consistency check result\n */\nexport interface ConsistencyResult {\n  pages: PageMetrics[];\n  inconsistencies: Inconsistency[];\n  score: number; // 0-100, higher is more consistent\n  summary: string;\n}\n\n/**\n * Consistency check options\n */\nexport interface ConsistencyOptions {\n  /** URLs to check */\n  urls: string[];\n  /** Enable verbose output */\n  verbose?: boolean;\n  /** Timeout per page (ms) */\n  timeout?: number;\n  /** Ignore certain property types */\n  ignore?: Array<'layout' | 'typography' | 'color' | 'spacing'>;\n}\n\n/**\n * Extract UI metrics from a page\n */\nasync function extractMetrics(page: import('playwright').Page, url: string): Promise<PageMetrics> {\n  const parsedUrl = new URL(url);\n\n  const metrics = await page.evaluate(() => {\n    const getComputedStyleProp = (selector: string, prop: string): string | null => {\n      const el = document.querySelector(selector);\n      if (!el) return null;\n      return window.getComputedStyle(el).getPropertyValue(prop) || null;\n    };\n\n    const getElementHeight = (selector: string): number | null => {\n      const el = document.querySelector(selector);\n      if (!el) return null;\n      return el.getBoundingClientRect().height;\n    };\n\n    const getElementWidth = (selector: string): number | null => {\n      const el = document.querySelector(selector);\n      if (!el) return null;\n      return el.getBoundingClientRect().width;\n    };\n\n    // Try multiple selectors for common elements\n    const headerSelectors = ['header', '[role=\"banner\"]', '.header', '#header', 'nav'];\n    const navSelectors = ['nav', '[role=\"navigation\"]', '.sidebar', '.nav', '#sidebar'];\n    const mainSelectors = ['main', '[role=\"main\"]', '.content', '#content', '.main'];\n    const footerSelectors = ['footer', '[role=\"contentinfo\"]', '.footer', '#footer'];\n    const buttonSelectors = ['button', '.btn', '[role=\"button\"]', 'a.button'];\n    const cardSelectors = ['.card', '[class*=\"card\"]', '.panel', '.box'];\n\n    const findFirst = (selectors: string[], fn: (s: string) => string | number | null) => {\n      for (const sel of selectors) {\n        const result = fn(sel);\n        if (result !== null) return result;\n      }\n      return null;\n    };\n\n    // Get padding from main content\n    const getContentPadding = (): { top: number; right: number; bottom: number; left: number } | null => {\n      for (const sel of mainSelectors) {\n        const el = document.querySelector(sel);\n        if (el) {\n          const style = window.getComputedStyle(el);\n          return {\n            top: parseFloat(style.paddingTop) || 0,\n            right: parseFloat(style.paddingRight) || 0,\n            bottom: parseFloat(style.paddingBottom) || 0,\n            left: parseFloat(style.paddingLeft) || 0,\n          };\n        }\n      }\n      return null;\n    };\n\n    return {\n      title: document.title,\n      layout: {\n        headerHeight: findFirst(headerSelectors, getElementHeight) as number | null,\n        navWidth: findFirst(navSelectors, getElementWidth) as number | null,\n        contentPadding: getContentPadding(),\n        footerHeight: findFirst(footerSelectors, getElementHeight) as number | null,\n      },\n      typography: {\n        bodyFontFamily: getComputedStyleProp('body', 'font-family'),\n        bodyFontSize: getComputedStyleProp('body', 'font-size'),\n        headingFontFamily: getComputedStyleProp('h1, h2, h3', 'font-family'),\n        h1FontSize: getComputedStyleProp('h1', 'font-size'),\n        h2FontSize: getComputedStyleProp('h2', 'font-size'),\n        lineHeight: getComputedStyleProp('body', 'line-height'),\n      },\n      colors: {\n        backgroundColor: getComputedStyleProp('body', 'background-color'),\n        textColor: getComputedStyleProp('body', 'color'),\n        linkColor: getComputedStyleProp('a', 'color'),\n        primaryButtonBg: findFirst(buttonSelectors, s => getComputedStyleProp(s, 'background-color')) as string | null,\n        primaryButtonText: findFirst(buttonSelectors, s => getComputedStyleProp(s, 'color')) as string | null,\n      },\n      spacing: {\n        buttonPadding: findFirst(buttonSelectors, s => getComputedStyleProp(s, 'padding')) as string | null,\n        cardPadding: findFirst(cardSelectors, s => getComputedStyleProp(s, 'padding')) as string | null,\n        sectionGap: getComputedStyleProp('main > *', 'margin-bottom'),\n      },\n    };\n  });\n\n  return {\n    url,\n    path: parsedUrl.pathname,\n    ...metrics,\n  };\n}\n\n/**\n * Compare metrics across pages and find inconsistencies\n */\nfunction findInconsistencies(pages: PageMetrics[], ignore: string[] = []): Inconsistency[] {\n  const inconsistencies: Inconsistency[] = [];\n\n  // Helper to check if values are consistent\n  const checkProperty = (\n    type: Inconsistency['type'],\n    property: string,\n    getValue: (p: PageMetrics) => string | number | null,\n    description: string,\n    severity: Inconsistency['severity'] = 'warning'\n  ) => {\n    if (ignore.includes(type)) return;\n\n    const values = pages.map(p => ({\n      path: p.path,\n      value: getValue(p),\n    }));\n\n    // Filter out null values\n    const nonNullValues = values.filter(v => v.value !== null);\n    if (nonNullValues.length < 2) return;\n\n    // Check if all values are the same\n    const uniqueValues = new Set(nonNullValues.map(v => String(v.value)));\n    if (uniqueValues.size > 1) {\n      inconsistencies.push({\n        type,\n        property,\n        severity,\n        description,\n        pages: values,\n      });\n    }\n  };\n\n  // Layout checks\n  checkProperty('layout', 'headerHeight', p => p.layout.headerHeight, 'Header height differs across pages');\n  checkProperty('layout', 'navWidth', p => p.layout.navWidth, 'Navigation width differs across pages');\n  checkProperty('layout', 'footerHeight', p => p.layout.footerHeight, 'Footer height differs across pages');\n\n  // Typography checks\n  checkProperty('typography', 'bodyFontFamily', p => p.typography.bodyFontFamily, 'Body font family differs across pages', 'error');\n  checkProperty('typography', 'bodyFontSize', p => p.typography.bodyFontSize, 'Body font size differs across pages');\n  checkProperty('typography', 'headingFontFamily', p => p.typography.headingFontFamily, 'Heading font family differs across pages', 'error');\n  checkProperty('typography', 'h1FontSize', p => p.typography.h1FontSize, 'H1 font size differs across pages');\n  checkProperty('typography', 'lineHeight', p => p.typography.lineHeight, 'Line height differs across pages');\n\n  // Color checks\n  checkProperty('color', 'backgroundColor', p => p.colors.backgroundColor, 'Background color differs across pages');\n  checkProperty('color', 'textColor', p => p.colors.textColor, 'Text color differs across pages', 'error');\n  checkProperty('color', 'linkColor', p => p.colors.linkColor, 'Link color differs across pages');\n  checkProperty('color', 'primaryButtonBg', p => p.colors.primaryButtonBg, 'Primary button background differs across pages');\n\n  // Spacing checks\n  checkProperty('spacing', 'buttonPadding', p => p.spacing.buttonPadding, 'Button padding differs across pages');\n  checkProperty('spacing', 'cardPadding', p => p.spacing.cardPadding, 'Card padding differs across pages');\n\n  return inconsistencies;\n}\n\n/**\n * Calculate consistency score based on inconsistencies\n */\nfunction calculateScore(inconsistencies: Inconsistency[]): number {\n  if (inconsistencies.length === 0) return 100;\n\n  const weights = { error: 10, warning: 5, info: 1 };\n  const totalPenalty = inconsistencies.reduce((sum, i) => sum + weights[i.severity], 0);\n\n  // Score decreases based on penalty, minimum 0\n  return Math.max(0, 100 - totalPenalty);\n}\n\n/**\n * Check UI consistency across multiple pages\n */\nexport async function checkConsistency(options: ConsistencyOptions): Promise<ConsistencyResult> {\n  const { urls, timeout = 15000, ignore = [] } = options;\n\n  let browser: Browser | null = null;\n  const pages: PageMetrics[] = [];\n\n  try {\n    browser = await chromium.launch({ headless: true });\n    const context = await browser.newContext({\n      viewport: { width: 1920, height: 1080 },\n    });\n    const page = await context.newPage();\n\n    for (const url of urls) {\n      try {\n        await page.goto(url, {\n          waitUntil: 'domcontentloaded',\n          timeout,\n        });\n\n        const metrics = await extractMetrics(page, url);\n        pages.push(metrics);\n      } catch (error) {\n        console.error(`Failed to analyze ${url}:`, error instanceof Error ? error.message : error);\n      }\n    }\n\n    await browser.close();\n  } catch (error) {\n    if (browser) await browser.close();\n    throw error;\n  }\n\n  if (pages.length < 2) {\n    return {\n      pages,\n      inconsistencies: [],\n      score: 100,\n      summary: 'Need at least 2 pages to check consistency',\n    };\n  }\n\n  const inconsistencies = findInconsistencies(pages, ignore);\n  const score = calculateScore(inconsistencies);\n\n  const errorCount = inconsistencies.filter(i => i.severity === 'error').length;\n  const warningCount = inconsistencies.filter(i => i.severity === 'warning').length;\n\n  let summary: string;\n  if (score === 100) {\n    summary = `All ${pages.length} pages are consistent.`;\n  } else if (score >= 80) {\n    summary = `Minor inconsistencies found across ${pages.length} pages. ${warningCount} warning(s).`;\n  } else if (score >= 50) {\n    summary = `Notable inconsistencies found. ${errorCount} error(s), ${warningCount} warning(s).`;\n  } else {\n    summary = `Significant style inconsistencies detected. ${errorCount} error(s), ${warningCount} warning(s). Review recommended.`;\n  }\n\n  return {\n    pages,\n    inconsistencies,\n    score,\n    summary,\n  };\n}\n\n/**\n * Format consistency result for display\n */\nexport function formatConsistencyReport(result: ConsistencyResult): string {\n  const lines: string[] = [];\n\n  lines.push('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\n  lines.push('  UI CONSISTENCY REPORT');\n  lines.push('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\n  lines.push('');\n  lines.push(`Score: ${result.score}/100`);\n  lines.push(`Pages analyzed: ${result.pages.length}`);\n  lines.push(`Summary: ${result.summary}`);\n  lines.push('');\n\n  if (result.inconsistencies.length === 0) {\n    lines.push('‚úì No inconsistencies found');\n  } else {\n    lines.push('Inconsistencies:');\n    lines.push('');\n\n    for (const issue of result.inconsistencies) {\n      const icon = issue.severity === 'error' ? '‚úó' : issue.severity === 'warning' ? '!' : '‚Ñπ';\n      lines.push(`  ${icon} [${issue.type}] ${issue.description}`);\n\n      for (const page of issue.pages) {\n        if (page.value !== null) {\n          lines.push(`      ${page.path}: ${page.value}`);\n        }\n      }\n      lines.push('');\n    }\n  }\n\n  lines.push('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');\n  lines.push('Pages analyzed:');\n  for (const page of result.pages) {\n    lines.push(`  ‚Ä¢ ${page.path} (${page.title})`);\n  }\n\n  return lines.join('\\n');\n}\n","import { chromium, Browser } from 'playwright';\nimport { URL } from 'url';\n\nexport interface CrawlOptions {\n  /** Starting URL */\n  url: string;\n  /** Maximum number of pages to discover (default: 5) */\n  maxPages?: number;\n  /** Only crawl pages under this path prefix */\n  pathPrefix?: string;\n  /** Timeout per page in ms (default: 10000) */\n  timeout?: number;\n  /** Include external links (default: false) */\n  includeExternal?: boolean;\n}\n\nexport interface DiscoveredPage {\n  url: string;\n  path: string;\n  title: string;\n  linkText?: string;\n  depth: number;\n}\n\nexport interface CrawlResult {\n  baseUrl: string;\n  pages: DiscoveredPage[];\n  totalLinks: number;\n  crawlTime: number;\n}\n\n/**\n * Discover pages on a website by crawling from the starting URL\n * Returns up to maxPages unique pages within the same origin\n */\nexport async function discoverPages(options: CrawlOptions): Promise<CrawlResult> {\n  const {\n    url,\n    maxPages = 5,\n    pathPrefix,\n    timeout = 10000,\n    includeExternal = false,\n  } = options;\n\n  const startTime = Date.now();\n  const startUrl = new URL(url);\n  const origin = startUrl.origin;\n\n  const discovered: Map<string, DiscoveredPage> = new Map();\n  const visited: Set<string> = new Set();\n  const queue: { url: string; depth: number; linkText?: string }[] = [\n    { url: url, depth: 0 }\n  ];\n\n  let browser: Browser | null = null;\n  let totalLinks = 0;\n\n  try {\n    browser = await chromium.launch({ headless: true });\n    const context = await browser.newContext();\n    const page = await context.newPage();\n\n    while (queue.length > 0 && discovered.size < maxPages) {\n      const current = queue.shift();\n      if (!current) break;\n\n      const currentUrl = normalizeUrl(current.url);\n      if (visited.has(currentUrl)) continue;\n      visited.add(currentUrl);\n\n      try {\n        // Navigate to page\n        await page.goto(current.url, {\n          waitUntil: 'domcontentloaded',\n          timeout,\n        });\n\n        // Get page title\n        const title = await page.title();\n\n        // Add to discovered pages\n        const parsedUrl = new URL(current.url);\n        discovered.set(currentUrl, {\n          url: current.url,\n          path: parsedUrl.pathname,\n          title: title || parsedUrl.pathname,\n          linkText: current.linkText,\n          depth: current.depth,\n        });\n\n        // Only continue crawling if we haven't reached max\n        if (discovered.size >= maxPages) break;\n\n        // Find all links on the page\n        const links = await page.evaluate((): { href: string; text: string }[] => {\n          const anchors = Array.from(document.querySelectorAll('a[href]'));\n          return anchors.map((a: Element) => ({\n            href: (a as HTMLAnchorElement).getAttribute('href') || '',\n            text: a.textContent?.trim() || '',\n          }));\n        });\n\n        totalLinks += links.length;\n\n        // Process links\n        for (const link of links) {\n          if (discovered.size >= maxPages) break;\n\n          try {\n            const absoluteUrl = new URL(link.href, current.url);\n            const normalizedUrl = normalizeUrl(absoluteUrl.href);\n\n            // Skip if already visited or queued\n            if (visited.has(normalizedUrl)) continue;\n\n            // Check if same origin\n            if (!includeExternal && absoluteUrl.origin !== origin) continue;\n\n            // Check path prefix if specified\n            if (pathPrefix && !absoluteUrl.pathname.startsWith(pathPrefix)) continue;\n\n            // Skip common non-page URLs\n            if (shouldSkipUrl(absoluteUrl)) continue;\n\n            // Add to queue\n            queue.push({\n              url: absoluteUrl.href,\n              depth: current.depth + 1,\n              linkText: link.text,\n            });\n          } catch {\n            // Invalid URL, skip\n          }\n        }\n      } catch (error) {\n        // Page failed to load, continue with next\n        console.error(`Failed to load ${current.url}:`, error instanceof Error ? error.message : error);\n      }\n    }\n\n    await browser.close();\n  } catch (error) {\n    if (browser) await browser.close();\n    throw error;\n  }\n\n  const crawlTime = Date.now() - startTime;\n\n  return {\n    baseUrl: origin,\n    pages: Array.from(discovered.values()).sort((a, b) => {\n      // Sort by depth first, then by path\n      if (a.depth !== b.depth) return a.depth - b.depth;\n      return a.path.localeCompare(b.path);\n    }),\n    totalLinks,\n    crawlTime,\n  };\n}\n\n/**\n * Normalize URL for comparison (remove trailing slash, hash, query params)\n */\nfunction normalizeUrl(url: string): string {\n  try {\n    const parsed = new URL(url);\n    // Remove hash and query, normalize trailing slash\n    let normalized = `${parsed.origin}${parsed.pathname}`;\n    if (normalized.endsWith('/') && normalized.length > 1) {\n      normalized = normalized.slice(0, -1);\n    }\n    return normalized;\n  } catch {\n    return url;\n  }\n}\n\n/**\n * Check if URL should be skipped (non-page resources)\n */\nfunction shouldSkipUrl(url: URL): boolean {\n  const path = url.pathname.toLowerCase();\n  const skipExtensions = [\n    '.pdf', '.jpg', '.jpeg', '.png', '.gif', '.svg', '.webp',\n    '.css', '.js', '.json', '.xml', '.ico', '.woff', '.woff2',\n    '.mp3', '.mp4', '.webm', '.zip', '.tar', '.gz',\n  ];\n\n  if (skipExtensions.some(ext => path.endsWith(ext))) return true;\n\n  // Skip common non-content paths\n  const skipPaths = [\n    '/api/', '/static/', '/assets/', '/_next/', '/fonts/',\n    '/images/', '/img/', '/cdn/', '/admin/', '/auth/',\n  ];\n\n  if (skipPaths.some(p => path.includes(p))) return true;\n\n  // Skip hash-only links\n  if (url.hash && url.pathname === '/') return true;\n\n  return false;\n}\n\n/**\n * Quick scan to get navigation links from a page\n * Useful for finding main pages without full crawl\n */\nexport async function getNavigationLinks(url: string): Promise<DiscoveredPage[]> {\n  let browser: Browser | null = null;\n\n  try {\n    browser = await chromium.launch({ headless: true });\n    const page = await browser.newPage();\n\n    await page.goto(url, {\n      waitUntil: 'domcontentloaded',\n      timeout: 15000,\n    });\n\n    const origin = new URL(url).origin;\n\n    // Find links in navigation elements\n    const navLinks = await page.evaluate((): { href: string; text: string }[] => {\n      const selectors = [\n        'nav a[href]',\n        'header a[href]',\n        '[role=\"navigation\"] a[href]',\n        '.nav a[href]',\n        '.navbar a[href]',\n        '.sidebar a[href]',\n        '.menu a[href]',\n      ];\n\n      const links: { href: string; text: string }[] = [];\n      const seen = new Set<string>();\n\n      for (const selector of selectors) {\n        const anchors = Array.from(document.querySelectorAll(selector));\n        for (const a of anchors) {\n          const href = (a as HTMLAnchorElement).getAttribute('href');\n          const text = a.textContent?.trim();\n          if (href && text && !seen.has(href)) {\n            seen.add(href);\n            links.push({ href, text });\n          }\n        }\n      }\n\n      return links;\n    });\n\n    await browser.close();\n\n    // Convert to DiscoveredPage format\n    const pages: DiscoveredPage[] = [];\n\n    for (const link of navLinks) {\n      try {\n        const absoluteUrl = new URL(link.href, url);\n\n        // Only include same-origin links\n        if (absoluteUrl.origin !== origin) continue;\n\n        // Skip resources\n        if (shouldSkipUrl(absoluteUrl)) continue;\n\n        pages.push({\n          url: absoluteUrl.href,\n          path: absoluteUrl.pathname,\n          title: link.text,\n          linkText: link.text,\n          depth: 1,\n        });\n      } catch {\n        // Invalid URL\n      }\n    }\n\n    // Remove duplicates by path\n    const uniquePages = new Map<string, DiscoveredPage>();\n    for (const page of pages) {\n      if (!uniquePages.has(page.path)) {\n        uniquePages.set(page.path, page);\n      }\n    }\n\n    return Array.from(uniquePages.values());\n  } catch (error) {\n    if (browser) await browser.close();\n    throw error;\n  }\n}\n","import { registerPreset, type Rule, type RuleContext, type RulePreset } from '../engine.js';\nimport type { EnhancedElement, Violation } from '../../schemas.js';\n\n/**\n * Rule: Buttons must have click handlers\n */\nconst noHandlerRule: Rule = {\n  id: 'no-handler',\n  name: 'No Click Handler',\n  description: 'Interactive elements like buttons must have click handlers',\n  defaultSeverity: 'error',\n  check: (element: EnhancedElement, _context: RuleContext): Violation | null => {\n    const isButton = element.tagName === 'button' || element.a11y.role === 'button';\n    const isDisabled = element.interactive.isDisabled;\n    const hasHandler = element.interactive.hasOnClick;\n\n    if (isButton && !isDisabled && !hasHandler) {\n      return {\n        ruleId: 'no-handler',\n        ruleName: 'No Click Handler',\n        severity: 'error',\n        message: `Button \"${element.text || element.selector}\" has no click handler`,\n        element: element.selector,\n        bounds: element.bounds,\n        fix: 'Add an onClick handler or make the button disabled',\n      };\n    }\n\n    return null;\n  },\n};\n\n/**\n * Rule: Links must have valid hrefs or handlers\n */\nconst placeholderLinkRule: Rule = {\n  id: 'placeholder-link',\n  name: 'Placeholder Link',\n  description: 'Links must have valid hrefs or click handlers',\n  defaultSeverity: 'error',\n  check: (element: EnhancedElement, _context: RuleContext): Violation | null => {\n    const isLink = element.tagName === 'a';\n    const hasValidHref = element.interactive.hasHref;\n    const hasHandler = element.interactive.hasOnClick;\n\n    if (isLink && !hasValidHref && !hasHandler) {\n      return {\n        ruleId: 'placeholder-link',\n        ruleName: 'Placeholder Link',\n        severity: 'error',\n        message: `Link \"${element.text || element.selector}\" has placeholder href and no handler`,\n        element: element.selector,\n        bounds: element.bounds,\n        fix: 'Add a valid href or onClick handler',\n      };\n    }\n\n    return null;\n  },\n};\n\n/**\n * Rule: Touch targets must be minimum size\n */\nconst touchTargetRule: Rule = {\n  id: 'touch-target-small',\n  name: 'Touch Target Too Small',\n  description: 'Interactive elements must meet minimum touch target size',\n  defaultSeverity: 'warn',\n  check: (element: EnhancedElement, context: RuleContext, options?: Record<string, unknown>): Violation | null => {\n    const isInteractive = element.interactive.hasOnClick || element.interactive.hasHref;\n    if (!isInteractive) return null;\n\n    const minSize = context.isMobile\n      ? (options?.mobileMinSize as number) ?? 44\n      : (options?.desktopMinSize as number) ?? 24;\n\n    const { width, height } = element.bounds;\n\n    if (width < minSize || height < minSize) {\n      return {\n        ruleId: 'touch-target-small',\n        ruleName: 'Touch Target Too Small',\n        severity: 'warn',\n        message: `\"${element.text || element.selector}\" touch target is ${width}x${height}px (min: ${minSize}px)`,\n        element: element.selector,\n        bounds: element.bounds,\n        fix: `Increase element size to at least ${minSize}x${minSize}px`,\n      };\n    }\n\n    return null;\n  },\n};\n\n/**\n * Rule: Interactive elements need accessible labels\n */\nconst missingAriaLabelRule: Rule = {\n  id: 'missing-aria-label',\n  name: 'Missing Accessible Label',\n  description: 'Interactive elements without text need aria-label',\n  defaultSeverity: 'warn',\n  check: (element: EnhancedElement, _context: RuleContext): Violation | null => {\n    const isInteractive = element.interactive.hasOnClick || element.interactive.hasHref;\n    if (!isInteractive) return null;\n\n    const hasText = element.text && element.text.trim().length > 0;\n    const hasAriaLabel = element.a11y.ariaLabel && element.a11y.ariaLabel.trim().length > 0;\n\n    if (!hasText && !hasAriaLabel) {\n      return {\n        ruleId: 'missing-aria-label',\n        ruleName: 'Missing Accessible Label',\n        severity: 'warn',\n        message: `\"${element.selector}\" is interactive but has no text or aria-label`,\n        element: element.selector,\n        bounds: element.bounds,\n        fix: 'Add visible text or aria-label attribute',\n      };\n    }\n\n    return null;\n  },\n};\n\n/**\n * Rule: Disabled elements should look disabled\n */\nconst disabledNoVisualRule: Rule = {\n  id: 'disabled-no-visual',\n  name: 'Disabled Without Visual',\n  description: 'Disabled elements should have visual indication',\n  defaultSeverity: 'warn',\n  check: (element: EnhancedElement, _context: RuleContext): Violation | null => {\n    if (!element.interactive.isDisabled) return null;\n\n    const cursor = element.interactive.cursor;\n    const hasDisabledCursor = cursor === 'not-allowed' || cursor === 'default';\n\n    // Check for visual indication via computed styles\n    const bgColor = element.computedStyles?.backgroundColor;\n    const hasGrayedBg = bgColor?.includes('gray') || bgColor?.includes('rgb(200') || bgColor?.includes('rgb(220');\n\n    if (!hasDisabledCursor && !hasGrayedBg) {\n      return {\n        ruleId: 'disabled-no-visual',\n        ruleName: 'Disabled Without Visual',\n        severity: 'warn',\n        message: `\"${element.text || element.selector}\" is disabled but has no visual indication`,\n        element: element.selector,\n        bounds: element.bounds,\n        fix: 'Add cursor: not-allowed and/or gray background to disabled state',\n      };\n    }\n\n    return null;\n  },\n};\n\n/**\n * Minimal preset - basic interactivity checks\n */\nconst minimalPreset: RulePreset = {\n  name: 'minimal',\n  description: 'Basic interactivity and accessibility checks',\n  rules: [\n    noHandlerRule,\n    placeholderLinkRule,\n    touchTargetRule,\n    missingAriaLabelRule,\n    disabledNoVisualRule,\n  ],\n  defaults: {\n    'no-handler': 'error',\n    'placeholder-link': 'error',\n    'touch-target-small': 'warn',\n    'missing-aria-label': 'warn',\n    'disabled-no-visual': 'warn',\n  },\n};\n\n/**\n * Register the minimal preset\n */\nexport function register(): void {\n  registerPreset(minimalPreset);\n}\n\n// Export rules for testing\nexport const rules = {\n  noHandlerRule,\n  placeholderLinkRule,\n  touchTargetRule,\n  missingAriaLabelRule,\n  disabledNoVisualRule,\n};\n","import { readFile } from 'fs/promises';\nimport { existsSync } from 'fs';\nimport { join } from 'path';\nimport type {\n  EnhancedElement,\n  RulesConfig,\n  RuleSetting,\n  Violation,\n  RuleAuditResult,\n} from '../schemas.js';\n\n/**\n * Rule context passed to each rule check\n */\nexport interface RuleContext {\n  isMobile: boolean;\n  viewportWidth: number;\n  viewportHeight: number;\n  url: string;\n  allElements: EnhancedElement[];\n}\n\n/**\n * Rule definition\n */\nexport interface Rule {\n  id: string;\n  name: string;\n  description: string;\n  defaultSeverity: 'warn' | 'error';\n  check: (element: EnhancedElement, context: RuleContext, options?: Record<string, unknown>) => Violation | null;\n}\n\n/**\n * Rule preset - collection of rules with default settings\n */\nexport interface RulePreset {\n  name: string;\n  description: string;\n  rules: Rule[];\n  defaults: Record<string, RuleSetting>;\n}\n\n// Registered presets\nconst presets: Map<string, RulePreset> = new Map();\n\n/**\n * Register a rule preset\n */\nexport function registerPreset(preset: RulePreset): void {\n  presets.set(preset.name, preset);\n}\n\n/**\n * Get a registered preset by name\n */\nexport function getPreset(name: string): RulePreset | undefined {\n  return presets.get(name);\n}\n\n/**\n * List all registered presets\n */\nexport function listPresets(): string[] {\n  return Array.from(presets.keys());\n}\n\n/**\n * Load rules configuration from .ibr/rules.json\n */\nexport async function loadRulesConfig(projectDir: string): Promise<RulesConfig> {\n  const configPath = join(projectDir, '.ibr', 'rules.json');\n\n  if (!existsSync(configPath)) {\n    // Return default config extending minimal\n    return { extends: ['minimal'] };\n  }\n\n  try {\n    const content = await readFile(configPath, 'utf-8');\n    return JSON.parse(content) as RulesConfig;\n  } catch (error) {\n    console.warn(`Failed to parse rules.json: ${error}`);\n    return { extends: ['minimal'] };\n  }\n}\n\n/**\n * Merge rule settings from presets and user config\n */\nfunction mergeRuleSettings(\n  presetNames: string[],\n  userRules: Record<string, RuleSetting> = {}\n): { rules: Rule[]; settings: Map<string, { severity: 'warn' | 'error' | 'off'; options?: Record<string, unknown> }> } {\n  const allRules: Rule[] = [];\n  const settings = new Map<string, { severity: 'warn' | 'error' | 'off'; options?: Record<string, unknown> }>();\n  const seenRuleIds = new Set<string>();\n\n  // Load rules from presets\n  for (const presetName of presetNames) {\n    const preset = presets.get(presetName);\n    if (!preset) {\n      console.warn(`Unknown preset: ${presetName}`);\n      continue;\n    }\n\n    for (const rule of preset.rules) {\n      if (!seenRuleIds.has(rule.id)) {\n        allRules.push(rule);\n        seenRuleIds.add(rule.id);\n\n        // Apply preset defaults\n        const defaultSetting = preset.defaults[rule.id] ?? rule.defaultSeverity;\n        if (typeof defaultSetting === 'string') {\n          settings.set(rule.id, { severity: defaultSetting as 'warn' | 'error' | 'off' });\n        } else {\n          settings.set(rule.id, { severity: defaultSetting[0] as 'warn' | 'error' | 'off', options: defaultSetting[1] as Record<string, unknown> });\n        }\n      }\n    }\n  }\n\n  // Apply user overrides\n  for (const [ruleId, setting] of Object.entries(userRules)) {\n    if (typeof setting === 'string') {\n      settings.set(ruleId, { severity: setting as 'warn' | 'error' | 'off' });\n    } else {\n      settings.set(ruleId, { severity: setting[0] as 'warn' | 'error' | 'off', options: setting[1] as Record<string, unknown> });\n    }\n  }\n\n  return { rules: allRules, settings };\n}\n\n/**\n * Run rules against elements\n */\nexport function runRules(\n  elements: EnhancedElement[],\n  context: RuleContext,\n  config: RulesConfig\n): Violation[] {\n  const { rules, settings } = mergeRuleSettings(config.extends ?? ['minimal'], config.rules);\n  const violations: Violation[] = [];\n\n  for (const element of elements) {\n    for (const rule of rules) {\n      const setting = settings.get(rule.id);\n\n      // Skip if rule is off\n      if (!setting || setting.severity === 'off') {\n        continue;\n      }\n\n      const violation = rule.check(element, context, setting.options);\n\n      if (violation) {\n        // Override severity from settings\n        violations.push({\n          ...violation,\n          severity: setting.severity as 'warn' | 'error',\n        });\n      }\n    }\n  }\n\n  return violations;\n}\n\n/**\n * Create full audit result\n */\nexport function createAuditResult(\n  url: string,\n  elements: EnhancedElement[],\n  violations: Violation[]\n): RuleAuditResult {\n  const errors = violations.filter(v => v.severity === 'error').length;\n  const warnings = violations.filter(v => v.severity === 'warn').length;\n\n  return {\n    url,\n    timestamp: new Date().toISOString(),\n    elementsScanned: elements.length,\n    violations,\n    summary: {\n      errors,\n      warnings,\n      passed: elements.length - errors - warnings,\n    },\n  };\n}\n\n/**\n * Format audit result for CLI output\n */\nexport function formatAuditResult(result: RuleAuditResult): string {\n  const lines: string[] = [];\n\n  lines.push(`IBR Audit: ${result.url}`);\n  lines.push(`Scanned: ${result.elementsScanned} elements`);\n  lines.push('');\n\n  if (result.violations.length === 0) {\n    lines.push('No violations found.');\n  } else {\n    lines.push(`Found ${result.summary.errors} errors, ${result.summary.warnings} warnings:`);\n    lines.push('');\n\n    for (const v of result.violations) {\n      const icon = v.severity === 'error' ? '‚úó' : '!';\n      lines.push(`  ${icon} [${v.ruleId}] ${v.message}`);\n      if (v.element) {\n        lines.push(`    Element: ${v.element.slice(0, 60)}${v.element.length > 60 ? '...' : ''}`);\n      }\n      if (v.fix) {\n        lines.push(`    Fix: ${v.fix}`);\n      }\n    }\n  }\n\n  lines.push('');\n  lines.push(`Summary: ${result.summary.errors} errors, ${result.summary.warnings} warnings, ${result.summary.passed} passed`);\n\n  return lines.join('\\n');\n}\n\n// Auto-register presets on import\nimport('./presets/minimal.js').then(m => m.register()).catch(() => {});\n","import { chromium, type Browser, type Page } from 'playwright';\nimport { writeFile, readFile, unlink, mkdir } from 'fs/promises';\nimport { existsSync } from 'fs';\nimport { join, dirname } from 'path';\nimport type { Viewport, EnhancedElement, ElementIssue, AuditResult } from './schemas.js';\nimport { VIEWPORTS } from './schemas.js';\n\n/**\n * Lock file to prevent concurrent extractions\n */\nconst LOCK_FILE = '.extracting';\nconst LOCK_TIMEOUT_MS = 180000; // 3 minutes (longer than extraction to prevent stale locks)\nconst EXTRACTION_TIMEOUT_MS = 120000; // 2 minutes - allows complex pages to load\n\n/**\n * Extracted element information\n */\nexport interface ExtractedElement {\n  selector: string;\n  tagName: string;\n  id?: string;\n  className?: string;\n  bounds: {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n  };\n  computedStyles: Record<string, string>;\n}\n\n/**\n * CSS custom properties (variables)\n */\nexport interface CSSVariables {\n  [key: string]: string;\n}\n\n/**\n * Full extraction result\n */\nexport interface ExtractionResult {\n  url: string;\n  timestamp: string;\n  viewport: Viewport;\n  html: string;\n  elements: ExtractedElement[];\n  cssVariables: CSSVariables;\n  screenshotPath: string;\n}\n\n/**\n * Options for HTML extraction\n */\nexport interface ExtractOptions {\n  url: string;\n  outputDir: string;\n  sessionId: string;\n  viewport?: Viewport;\n  timeout?: number;\n  /** CSS selectors to extract (defaults to semantic elements) */\n  selectors?: string[];\n}\n\n/**\n * Default semantic selectors to extract\n */\nconst DEFAULT_SELECTORS = [\n  'header',\n  'nav',\n  'main',\n  'section',\n  'article',\n  'aside',\n  'footer',\n  'h1',\n  'h2',\n  'h3',\n  'button',\n  'a[href]',\n  'form',\n  'input',\n  'img',\n];\n\n/**\n * Key CSS properties to extract\n */\nconst CSS_PROPERTIES_TO_EXTRACT = [\n  'display',\n  'position',\n  'width',\n  'height',\n  'padding',\n  'margin',\n  'backgroundColor',\n  'color',\n  'fontSize',\n  'fontFamily',\n  'fontWeight',\n  'lineHeight',\n  'textAlign',\n  'borderRadius',\n  'border',\n  'boxShadow',\n  'gap',\n  'flexDirection',\n  'alignItems',\n  'justifyContent',\n  'gridTemplateColumns',\n  'gridTemplateRows',\n];\n\n// Singleton browser instance\nlet browser: Browser | null = null;\n\n/**\n * Get or create browser instance\n */\nasync function getBrowser(): Promise<Browser> {\n  if (!browser) {\n    browser = await chromium.launch({\n      headless: true,\n    });\n  }\n  return browser;\n}\n\n/**\n * Close the browser instance\n */\nexport async function closeBrowser(): Promise<void> {\n  if (browser) {\n    await browser.close();\n    browser = null;\n  }\n}\n\n/**\n * Check if extraction is already in progress\n */\nasync function checkLock(outputDir: string): Promise<boolean> {\n  const lockPath = join(outputDir, LOCK_FILE);\n  if (!existsSync(lockPath)) {\n    return false;\n  }\n\n  try {\n    const content = await readFile(lockPath, 'utf-8');\n    const timestamp = parseInt(content, 10);\n    const age = Date.now() - timestamp;\n\n    // Lock is stale if older than timeout\n    if (age > LOCK_TIMEOUT_MS) {\n      await unlink(lockPath);\n      return false;\n    }\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Create extraction lock\n */\nasync function createLock(outputDir: string): Promise<void> {\n  const lockPath = join(outputDir, LOCK_FILE);\n  await writeFile(lockPath, Date.now().toString());\n}\n\n/**\n * Release extraction lock\n */\nasync function releaseLock(outputDir: string): Promise<void> {\n  const lockPath = join(outputDir, LOCK_FILE);\n  try {\n    await unlink(lockPath);\n  } catch {\n    // Ignore errors\n  }\n}\n\n/**\n * Extract computed styles for an element\n */\nasync function extractElementStyles(\n  page: Page,\n  selector: string\n): Promise<ExtractedElement[]> {\n  return page.evaluate(\n    ({ sel, props }) => {\n      const elements = document.querySelectorAll(sel);\n      const results: ExtractedElement[] = [];\n\n      elements.forEach((el, index) => {\n        const htmlEl = el as HTMLElement;\n        const rect = htmlEl.getBoundingClientRect();\n        const computed = window.getComputedStyle(htmlEl);\n\n        const styles: Record<string, string> = {};\n        props.forEach((prop) => {\n          const value = computed.getPropertyValue(\n            prop.replace(/([A-Z])/g, '-$1').toLowerCase()\n          );\n          if (value && value !== 'none' && value !== 'normal' && value !== '0px') {\n            styles[prop] = value;\n          }\n        });\n\n        results.push({\n          selector: `${sel}:nth-of-type(${index + 1})`,\n          tagName: htmlEl.tagName.toLowerCase(),\n          id: htmlEl.id || undefined,\n          className: htmlEl.className || undefined,\n          bounds: {\n            x: Math.round(rect.x),\n            y: Math.round(rect.y),\n            width: Math.round(rect.width),\n            height: Math.round(rect.height),\n          },\n          computedStyles: styles,\n        });\n      });\n\n      return results;\n    },\n    { sel: selector, props: CSS_PROPERTIES_TO_EXTRACT }\n  );\n}\n\n/**\n * Interactive element selectors for audit\n */\nconst INTERACTIVE_SELECTORS = [\n  'button',\n  'a[href]',\n  'a:not([href])',  // Links without href (potential issues)\n  'input[type=\"submit\"]',\n  'input[type=\"button\"]',\n  'input[type=\"text\"]',\n  'input[type=\"email\"]',\n  'input[type=\"password\"]',\n  'select',\n  'textarea',\n  '[role=\"button\"]',\n  '[role=\"link\"]',\n  '[onclick]',\n  '[tabindex]:not([tabindex=\"-1\"])',\n];\n\n/**\n * Extract enhanced interactive elements with handler detection\n */\nexport async function extractInteractiveElements(page: Page): Promise<EnhancedElement[]> {\n  return page.evaluate((selectors) => {\n    const seen = new Set<Element>();\n    const elements: EnhancedElement[] = [];\n\n    // Helper: Generate unique selector\n    function generateSelector(el: HTMLElement): string {\n      if (el.id) return `#${el.id}`;\n\n      const path: string[] = [];\n      let current: HTMLElement | null = el;\n\n      while (current && current !== document.body) {\n        let selector = current.tagName.toLowerCase();\n        if (current.id) {\n          selector = `#${current.id}`;\n          path.unshift(selector);\n          break;\n        } else if (current.className && typeof current.className === 'string') {\n          const classes = current.className.split(' ').filter(c => c.trim() && !c.includes(':'));\n          if (classes.length > 0) {\n            selector += `.${classes[0]}`;\n          }\n        }\n\n        const parent = current.parentElement;\n        if (parent) {\n          const siblings = Array.from(parent.children).filter(\n            c => c.tagName === current!.tagName\n          );\n          if (siblings.length > 1) {\n            const index = siblings.indexOf(current) + 1;\n            selector += `:nth-of-type(${index})`;\n          }\n        }\n\n        path.unshift(selector);\n        current = current.parentElement;\n      }\n\n      return path.join(' > ').slice(0, 200);\n    }\n\n    // Helper: Detect click handlers\n    function detectHandlers(el: HTMLElement) {\n      const keys = Object.keys(el);\n\n      // React 17+ uses __reactProps$\n      const reactPropsKey = keys.find(k => k.startsWith('__reactProps$'));\n      let hasReactHandler = false;\n      if (reactPropsKey) {\n        const props = (el as any)[reactPropsKey];\n        hasReactHandler = !!(props?.onClick || props?.onSubmit || props?.onMouseDown);\n      }\n\n      // Also check React fiber\n      const fiberKey = keys.find(k => k.startsWith('__reactFiber$'));\n      if (!hasReactHandler && fiberKey) {\n        const fiber = (el as any)[fiberKey];\n        hasReactHandler = !!(fiber?.pendingProps?.onClick || fiber?.memoizedProps?.onClick);\n      }\n\n      // Vue uses __vue__ or __vnode\n      const hasVueHandler = !!(\n        (el as any).__vue__?.$listeners?.click ||\n        (el as any).__vnode?.props?.onClick\n      );\n\n      // Angular uses __ngContext__\n      const hasAngularHandler = !!(el as any).__ngContext__ || el.hasAttribute('ng-click');\n\n      // Vanilla DOM\n      const hasVanillaHandler = typeof (el as any).onclick === 'function' ||\n                                 el.hasAttribute('onclick');\n\n      return {\n        hasReactHandler,\n        hasVueHandler,\n        hasAngularHandler,\n        hasVanillaHandler,\n        hasAnyHandler: hasReactHandler || hasVueHandler || hasAngularHandler || hasVanillaHandler,\n      };\n    }\n\n    // Process each selector\n    for (const selector of selectors) {\n      try {\n        document.querySelectorAll(selector).forEach((el) => {\n          if (seen.has(el)) return;\n          seen.add(el);\n\n          const htmlEl = el as HTMLElement;\n          const rect = htmlEl.getBoundingClientRect();\n          const computed = window.getComputedStyle(htmlEl);\n          const handlers = detectHandlers(htmlEl);\n\n          // Check href for links\n          const href = htmlEl.getAttribute('href');\n          const hasValidHref = href !== null && href !== '#' && href !== '' &&\n                               !href.startsWith('javascript:');\n\n          elements.push({\n            selector: generateSelector(htmlEl),\n            tagName: htmlEl.tagName.toLowerCase(),\n            id: htmlEl.id || undefined,\n            className: typeof htmlEl.className === 'string' ? htmlEl.className : undefined,\n            text: (htmlEl.textContent || '').trim().slice(0, 100) || undefined,\n            bounds: {\n              x: Math.round(rect.x),\n              y: Math.round(rect.y),\n              width: Math.round(rect.width),\n              height: Math.round(rect.height),\n            },\n            computedStyles: {\n              cursor: computed.cursor,\n              color: computed.color,\n              backgroundColor: computed.backgroundColor,\n            },\n            interactive: {\n              hasOnClick: handlers.hasAnyHandler,\n              hasHref: hasValidHref,\n              isDisabled: htmlEl.hasAttribute('disabled') ||\n                          htmlEl.getAttribute('aria-disabled') === 'true' ||\n                          computed.pointerEvents === 'none',\n              tabIndex: parseInt(htmlEl.getAttribute('tabindex') || '0', 10),\n              cursor: computed.cursor,\n              hasReactHandler: handlers.hasReactHandler || undefined,\n              hasVueHandler: handlers.hasVueHandler || undefined,\n              hasAngularHandler: handlers.hasAngularHandler || undefined,\n            },\n            a11y: {\n              role: htmlEl.getAttribute('role'),\n              ariaLabel: htmlEl.getAttribute('aria-label'),\n              ariaDescribedBy: htmlEl.getAttribute('aria-describedby'),\n              ariaHidden: htmlEl.getAttribute('aria-hidden') === 'true' || undefined,\n            },\n            sourceHint: {\n              dataTestId: htmlEl.getAttribute('data-testid'),\n            },\n          });\n        });\n      } catch {\n        // Skip invalid selectors\n      }\n    }\n\n    return elements;\n  }, INTERACTIVE_SELECTORS);\n}\n\n/**\n * Analyze elements and detect issues\n */\nexport function analyzeElements(elements: EnhancedElement[], isMobile = false): AuditResult {\n  const issues: ElementIssue[] = [];\n  let withHandlers = 0;\n  let withoutHandlers = 0;\n\n  const interactiveElements = elements.filter(el => {\n    const isButton = el.tagName === 'button' || el.a11y.role === 'button';\n    const isLink = el.tagName === 'a';\n    const isInput = ['input', 'select', 'textarea'].includes(el.tagName);\n    const looksClickable = el.interactive.cursor === 'pointer';\n    return isButton || isLink || isInput || looksClickable;\n  });\n\n  for (const el of interactiveElements) {\n    const isButton = el.tagName === 'button' || el.a11y.role === 'button';\n    const isLink = el.tagName === 'a';\n    const hasHandler = el.interactive.hasOnClick || el.interactive.hasHref;\n\n    if (hasHandler) {\n      withHandlers++;\n    } else {\n      withoutHandlers++;\n    }\n\n    // Check: Button without handler\n    if (isButton && !el.interactive.hasOnClick && !el.interactive.isDisabled) {\n      issues.push({\n        type: 'NO_HANDLER',\n        severity: 'error',\n        message: `Button \"${el.text || el.selector}\" has no click handler`,\n      });\n    }\n\n    // Check: Link with placeholder href\n    if (isLink && !el.interactive.hasHref && !el.interactive.hasOnClick) {\n      issues.push({\n        type: 'PLACEHOLDER_LINK',\n        severity: 'error',\n        message: `Link \"${el.text || el.selector}\" has placeholder href and no handler`,\n      });\n    }\n\n    // Check: Touch target too small (mobile)\n    const minSize = isMobile ? 44 : 24;\n    if (el.bounds.width < minSize || el.bounds.height < minSize) {\n      issues.push({\n        type: 'TOUCH_TARGET_SMALL',\n        severity: isMobile ? 'error' : 'warning',\n        message: `\"${el.text || el.selector}\" touch target is ${el.bounds.width}x${el.bounds.height}px (min: ${minSize}px)`,\n      });\n    }\n\n    // Check: Missing aria-label on interactive element without text\n    if (hasHandler && !el.text && !el.a11y.ariaLabel) {\n      issues.push({\n        type: 'MISSING_ARIA_LABEL',\n        severity: 'warning',\n        message: `\"${el.selector}\" is interactive but has no text or aria-label`,\n      });\n    }\n  }\n\n  return {\n    totalElements: elements.length,\n    interactiveCount: interactiveElements.length,\n    withHandlers,\n    withoutHandlers,\n    issues,\n  };\n}\n\n/**\n * Extract CSS custom properties (variables)\n */\nasync function extractCSSVariables(page: Page): Promise<CSSVariables> {\n  return page.evaluate(() => {\n    const root = document.documentElement;\n    const computed = window.getComputedStyle(root);\n    const variables: CSSVariables = {};\n\n    // Get all CSS rules from stylesheets\n    const sheets = Array.from(document.styleSheets);\n    sheets.forEach((sheet) => {\n      try {\n        const rules = Array.from(sheet.cssRules || []);\n        rules.forEach((rule) => {\n          if (rule instanceof CSSStyleRule && rule.selectorText === ':root') {\n            const style = rule.style;\n            for (let i = 0; i < style.length; i++) {\n              const prop = style[i];\n              if (prop.startsWith('--')) {\n                variables[prop] = style.getPropertyValue(prop).trim();\n              }\n            }\n          }\n        });\n      } catch {\n        // Cross-origin stylesheets will throw\n      }\n    });\n\n    // Also get computed custom properties from :root\n    const rootStyles = getComputedStyle(root);\n    // Check common variable prefixes\n    ['--primary', '--secondary', '--accent', '--background', '--foreground', '--border', '--radius', '--spacing']\n      .forEach(prefix => {\n        for (let i = 0; i < 20; i++) {\n          const variations = [\n            prefix,\n            `${prefix}-${i}`,\n            `${prefix}-color`,\n            `${prefix}-bg`,\n          ];\n          variations.forEach(varName => {\n            const value = rootStyles.getPropertyValue(varName).trim();\n            if (value && !variables[varName]) {\n              variables[varName] = value;\n            }\n          });\n        }\n      });\n\n    return variables;\n  });\n}\n\n/**\n * Extract HTML, CSS, and screenshot from a live URL\n */\nexport async function extractFromURL(\n  options: ExtractOptions\n): Promise<ExtractionResult> {\n  const {\n    url,\n    outputDir,\n    sessionId,\n    viewport = VIEWPORTS.desktop,\n    timeout = EXTRACTION_TIMEOUT_MS,\n    selectors = DEFAULT_SELECTORS,\n  } = options;\n\n  // Check for concurrent extraction\n  if (await checkLock(outputDir)) {\n    throw new Error('Another extraction is in progress. Please wait.');\n  }\n\n  // Create session directory\n  const sessionDir = join(outputDir, 'sessions', sessionId);\n  await mkdir(sessionDir, { recursive: true });\n\n  // Create lock\n  await createLock(outputDir);\n\n  const browserInstance = await getBrowser();\n  let timeoutHandle: NodeJS.Timeout | null = null;\n\n  try {\n    // Set up hard timeout\n    const timeoutPromise = new Promise<never>((_, reject) => {\n      timeoutHandle = setTimeout(() => {\n        reject(new Error(`Extraction timed out after ${timeout}ms`));\n      }, timeout);\n    });\n\n    const extractionPromise = async () => {\n      const context = await browserInstance.newContext({\n        viewport: {\n          width: viewport.width,\n          height: viewport.height,\n        },\n        reducedMotion: 'reduce',\n      });\n\n      const page = await context.newPage();\n\n      try {\n        // Navigate to URL\n        await page.goto(url, {\n          waitUntil: 'networkidle',\n          timeout: timeout,\n        });\n\n        // Wait for animations to settle\n        await page.waitForTimeout(500);\n\n        // Disable animations for screenshot\n        await page.addStyleTag({\n          content: `\n            *, *::before, *::after {\n              animation-duration: 0s !important;\n              animation-delay: 0s !important;\n              transition-duration: 0s !important;\n              transition-delay: 0s !important;\n            }\n          `,\n        });\n\n        // Extract HTML\n        const html = await page.content();\n\n        // Extract elements\n        const elements: ExtractedElement[] = [];\n        for (const selector of selectors) {\n          const extracted = await extractElementStyles(page, selector);\n          elements.push(...extracted);\n        }\n\n        // Extract CSS variables\n        const cssVariables = await extractCSSVariables(page);\n\n        // Take screenshot\n        const screenshotPath = join(sessionDir, 'reference.png');\n        await page.screenshot({\n          path: screenshotPath,\n          fullPage: true,\n          type: 'png',\n        });\n\n        const result: ExtractionResult = {\n          url,\n          timestamp: new Date().toISOString(),\n          viewport,\n          html,\n          elements,\n          cssVariables,\n          screenshotPath,\n        };\n\n        // Save extraction data\n        await writeFile(\n          join(sessionDir, 'reference.json'),\n          JSON.stringify(result, null, 2)\n        );\n\n        // Save HTML separately for easier access\n        await writeFile(join(sessionDir, 'reference.html'), html);\n\n        return result;\n      } finally {\n        await context.close();\n      }\n    };\n\n    // Race between extraction and timeout\n    const result = await Promise.race([extractionPromise(), timeoutPromise]);\n    return result;\n  } finally {\n    // Clear timeout\n    if (timeoutHandle) {\n      clearTimeout(timeoutHandle);\n    }\n\n    // Release lock\n    await releaseLock(outputDir);\n  }\n}\n\n/**\n * Get paths for a reference session\n */\nexport function getReferenceSessionPaths(outputDir: string, sessionId: string) {\n  const root = join(outputDir, 'sessions', sessionId);\n  return {\n    root,\n    sessionJson: join(root, 'session.json'),\n    reference: join(root, 'reference.png'),\n    referenceHtml: join(root, 'reference.html'),\n    referenceData: join(root, 'reference.json'),\n    current: join(root, 'current.png'),\n    diff: join(root, 'diff.png'),\n  };\n}\n","import { chromium, type BrowserServer, type Browser, type BrowserContext, type Page } from 'playwright';\nimport { writeFile, readFile, unlink, mkdir, rm } from 'fs/promises';\nimport { existsSync } from 'fs';\nimport { join } from 'path';\nimport { nanoid } from 'nanoid';\nimport { VIEWPORTS, type Viewport, type EnhancedElement, type AuditResult } from './schemas.js';\nimport { extractInteractiveElements, analyzeElements } from './extract.js';\n\n/**\n * Browser server state persisted to disk\n */\ninterface BrowserServerState {\n  wsEndpoint: string;\n  cdpUrl?: string;  // CDP URL for reconnection (shares contexts)\n  pid: number;\n  startedAt: string;\n  headless: boolean;\n  isolatedProfile: string;\n}\n\n/**\n * Session state stored in the session directory\n */\ninterface SessionState {\n  id: string;\n  url: string;\n  name: string;\n  viewport: Viewport;\n  createdAt: string;\n  pageIndex: number;  // Index in the browser context\n  actions: ActionRecord[];\n  // Element audit data (captured on each screenshot)\n  elements?: EnhancedElement[];\n  audit?: AuditResult;\n}\n\n/**\n * Action record for session history\n */\nexport interface ActionRecord {\n  type: 'navigate' | 'click' | 'type' | 'fill' | 'hover' | 'evaluate' | 'screenshot' | 'wait';\n  timestamp: string;\n  params: Record<string, unknown>;\n  success: boolean;\n  error?: string;\n  duration?: number;\n}\n\n/**\n * Options for creating a session\n */\nexport interface SessionOptions {\n  url: string;\n  name?: string;\n  viewport?: Viewport;\n  waitFor?: string;  // CSS selector to wait for before considering page ready\n  timeout?: number;\n}\n\n/**\n * Options for starting the browser server\n */\nexport interface BrowserServerOptions {\n  headless?: boolean;  // Default: true\n  debug?: boolean;     // Visible + slowMo + devtools\n  isolated?: boolean;  // Use isolated profile (default: true)\n}\n\nconst SERVER_STATE_FILE = 'browser-server.json';\nconst ISOLATED_PROFILE_DIR = 'browser-profile';\n\n/**\n * Get paths for browser server files\n */\nfunction getPaths(outputDir: string) {\n  return {\n    stateFile: join(outputDir, SERVER_STATE_FILE),\n    profileDir: join(outputDir, ISOLATED_PROFILE_DIR),\n    sessionsDir: join(outputDir, 'sessions'),\n  };\n}\n\n/**\n * Check if browser server is running\n */\nexport async function isServerRunning(outputDir: string): Promise<boolean> {\n  const { stateFile } = getPaths(outputDir);\n\n  if (!existsSync(stateFile)) {\n    return false;\n  }\n\n  try {\n    const content = await readFile(stateFile, 'utf-8');\n    const state: BrowserServerState = JSON.parse(content);\n\n    // Try to connect to verify it's actually running\n    const browser = await chromium.connect(state.wsEndpoint, { timeout: 2000 });\n    await browser.close();\n    return true;\n  } catch {\n    // Server not running or can't connect - clean up stale file\n    await cleanupServerState(outputDir);\n    return false;\n  }\n}\n\n/**\n * Clean up stale server state\n */\nasync function cleanupServerState(outputDir: string): Promise<void> {\n  const { stateFile } = getPaths(outputDir);\n  try {\n    await unlink(stateFile);\n  } catch {\n    // Ignore if file doesn't exist\n  }\n}\n\n/**\n * Start the browser server (long-running process)\n * This should be called from session:start and will keep the process alive\n */\nexport async function startBrowserServer(\n  outputDir: string,\n  options: BrowserServerOptions = {}\n): Promise<{ server: BrowserServer; wsEndpoint: string }> {\n  const { stateFile, profileDir } = getPaths(outputDir);\n  const headless = options.headless ?? !options.debug;\n  const isolated = options.isolated ?? true;\n\n  // Check if already running\n  if (await isServerRunning(outputDir)) {\n    throw new Error('Browser server already running. Use session:close all to stop it first.');\n  }\n\n  // Create directories\n  await mkdir(outputDir, { recursive: true });\n  if (isolated) {\n    await mkdir(profileDir, { recursive: true });\n  }\n\n  // Find an available port for CDP debugging\n  const debugPort = 9222 + Math.floor(Math.random() * 1000);\n\n  // Launch browser server with CDP debugging enabled\n  // This allows connectOverCDP to work and share contexts across reconnections\n  const server = await chromium.launchServer({\n    headless,\n    slowMo: options.debug ? 100 : 0,\n    args: [`--remote-debugging-port=${debugPort}`],\n  });\n\n  const wsEndpoint = server.wsEndpoint();\n  const cdpUrl = `http://127.0.0.1:${debugPort}`;\n\n  // Save server state\n  const state: BrowserServerState = {\n    wsEndpoint,\n    cdpUrl,\n    pid: process.pid,\n    startedAt: new Date().toISOString(),\n    headless,\n    isolatedProfile: isolated ? profileDir : '',\n  };\n\n  await writeFile(stateFile, JSON.stringify(state, null, 2));\n\n  return { server, wsEndpoint };\n}\n\n/**\n * Connect to existing browser server\n * Uses CDP connection which shares contexts across reconnections\n */\nexport async function connectToBrowserServer(outputDir: string): Promise<Browser | null> {\n  const { stateFile } = getPaths(outputDir);\n\n  if (!existsSync(stateFile)) {\n    return null;\n  }\n\n  try {\n    const content = await readFile(stateFile, 'utf-8');\n    const state: BrowserServerState = JSON.parse(content);\n\n    // Use connectOverCDP to share contexts across reconnections\n    // This is critical - chromium.connect() creates isolated contexts per connection\n    // but connectOverCDP shares the same browser instance and sees all contexts\n    if (state.cdpUrl) {\n      const browser = await chromium.connectOverCDP(state.cdpUrl, { timeout: 5000 });\n      return browser;\n    }\n\n    // Fallback to standard connect (older state files without cdpUrl)\n    const browser = await chromium.connect(state.wsEndpoint, { timeout: 5000 });\n    return browser;\n  } catch (error) {\n    // Server not running - clean up\n    await cleanupServerState(outputDir);\n    return null;\n  }\n}\n\n/**\n * Stop the browser server\n */\nexport async function stopBrowserServer(outputDir: string): Promise<boolean> {\n  const { stateFile, profileDir } = getPaths(outputDir);\n\n  if (!existsSync(stateFile)) {\n    return false;\n  }\n\n  try {\n    const content = await readFile(stateFile, 'utf-8');\n    const state: BrowserServerState = JSON.parse(content);\n\n    // Connect and close\n    const browser = await chromium.connect(state.wsEndpoint, { timeout: 5000 });\n    await browser.close();\n\n    // Clean up state file\n    await unlink(stateFile);\n\n    // Optionally clean up profile dir\n    // await rm(profileDir, { recursive: true, force: true });\n\n    return true;\n  } catch {\n    // Force cleanup of state file\n    await cleanupServerState(outputDir);\n    return false;\n  }\n}\n\n/**\n * Persistent session that connects to browser server\n */\nexport class PersistentSession {\n  private browser: Browser;\n  private context: BrowserContext;\n  private page: Page;\n  private state: SessionState;\n  private sessionDir: string;\n\n  private constructor(\n    browser: Browser,\n    context: BrowserContext,\n    page: Page,\n    state: SessionState,\n    sessionDir: string\n  ) {\n    this.browser = browser;\n    this.context = context;\n    this.page = page;\n    this.state = state;\n    this.sessionDir = sessionDir;\n  }\n\n  /**\n   * Create a new session using the browser server\n   */\n  static async create(\n    outputDir: string,\n    options: SessionOptions\n  ): Promise<PersistentSession> {\n    const { url, name, viewport = VIEWPORTS.desktop, waitFor, timeout = 30000 } = options;\n\n    // Connect to browser server\n    const browser = await connectToBrowserServer(outputDir);\n    if (!browser) {\n      throw new Error(\n        'No browser server running.\\n' +\n        'Start one with: npx ibr session:start <url>\\n' +\n        'The first session:start launches the server and keeps it alive.'\n      );\n    }\n\n    // Generate session ID\n    const sessionId = `live_${nanoid(10)}`;\n    const sessionsDir = join(outputDir, 'sessions');\n    const sessionDir = join(sessionsDir, sessionId);\n    await mkdir(sessionDir, { recursive: true });\n\n    // Create context with viewport\n    const context = await browser.newContext({\n      viewport: {\n        width: viewport.width,\n        height: viewport.height,\n      },\n      reducedMotion: 'reduce',\n    });\n\n    // Create page and navigate\n    const page = await context.newPage();\n\n    const navStart = Date.now();\n    await page.goto(url, {\n      waitUntil: 'networkidle',\n      timeout,\n    });\n\n    // Wait for specific selector if requested\n    if (waitFor) {\n      await page.waitForSelector(waitFor, { timeout });\n    }\n\n    const navDuration = Date.now() - navStart;\n\n    // Initialize state\n    const state: SessionState = {\n      id: sessionId,\n      url,\n      name: name || new URL(url).pathname,\n      viewport,\n      createdAt: new Date().toISOString(),\n      pageIndex: 0,\n      actions: [{\n        type: 'navigate',\n        timestamp: new Date().toISOString(),\n        params: { url, waitFor },\n        success: true,\n        duration: navDuration,\n      }],\n    };\n\n    // Save state\n    await writeFile(\n      join(sessionDir, 'live-session.json'),\n      JSON.stringify(state, null, 2)\n    );\n\n    // Capture initial screenshot as baseline\n    await page.screenshot({\n      path: join(sessionDir, 'baseline.png'),\n      fullPage: false,\n    });\n\n    return new PersistentSession(browser, context, page, state, sessionDir);\n  }\n\n  /**\n   * Get session from browser server by ID\n   */\n  static async get(outputDir: string, sessionId: string): Promise<PersistentSession | null> {\n    const sessionDir = join(outputDir, 'sessions', sessionId);\n    const statePath = join(sessionDir, 'live-session.json');\n\n    if (!existsSync(statePath)) {\n      return null;\n    }\n\n    // Connect to browser server\n    const browser = await connectToBrowserServer(outputDir);\n    if (!browser) {\n      return null;\n    }\n\n    // Load session state\n    const content = await readFile(statePath, 'utf-8');\n    const state: SessionState = JSON.parse(content);\n\n    // Find existing page or create new one\n    const contexts = browser.contexts();\n    let context: BrowserContext;\n    let page: Page;\n\n    const targetHost = new URL(state.url).host;\n\n    if (contexts.length > 0) {\n      // Try to find the page with matching URL\n      for (const ctx of contexts) {\n        const pages = ctx.pages();\n        for (const p of pages) {\n          if (p.url().includes(targetHost)) {\n            context = ctx;\n            page = p;\n            return new PersistentSession(browser, context, page, state, sessionDir);\n          }\n        }\n      }\n    }\n\n    // No matching page found - recreate\n    context = await browser.newContext({\n      viewport: {\n        width: state.viewport.width,\n        height: state.viewport.height,\n      },\n      reducedMotion: 'reduce',\n    });\n\n    page = await context.newPage();\n    await page.goto(state.url, { waitUntil: 'networkidle' });\n\n    return new PersistentSession(browser, context, page, state, sessionDir);\n  }\n\n  get id(): string {\n    return this.state.id;\n  }\n\n  get url(): string {\n    return this.page?.url() || this.state.url;\n  }\n\n  get actions(): ActionRecord[] {\n    return [...this.state.actions];\n  }\n\n  private async recordAction(action: ActionRecord): Promise<void> {\n    this.state.actions.push(action);\n    await this.saveState();\n  }\n\n  private async saveState(): Promise<void> {\n    await writeFile(\n      join(this.sessionDir, 'live-session.json'),\n      JSON.stringify(this.state, null, 2)\n    );\n  }\n\n  async navigate(url: string, options?: { timeout?: number; waitFor?: string }): Promise<void> {\n    const start = Date.now();\n\n    try {\n      await this.page.goto(url, {\n        waitUntil: 'networkidle',\n        timeout: options?.timeout || 30000,\n      });\n\n      if (options?.waitFor) {\n        await this.page.waitForSelector(options.waitFor, { timeout: options?.timeout || 30000 });\n      }\n\n      this.state.url = url;\n      await this.recordAction({\n        type: 'navigate',\n        timestamp: new Date().toISOString(),\n        params: { url, waitFor: options?.waitFor },\n        success: true,\n        duration: Date.now() - start,\n      });\n    } catch (error) {\n      await this.recordAction({\n        type: 'navigate',\n        timestamp: new Date().toISOString(),\n        params: { url },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  async click(selector: string, options?: { timeout?: number }): Promise<void> {\n    const start = Date.now();\n    const timeout = options?.timeout || 5000;\n\n    try {\n      // Use locator API with visible filter - targets only visible elements\n      // This is BETTER than waitForSelector which waits for first match to become visible\n      const locator = this.page.locator(selector).filter({ visible: true }).first();\n      await locator.click({ timeout });\n      await this.recordAction({\n        type: 'click',\n        timestamp: new Date().toISOString(),\n        params: { selector },\n        success: true,\n        duration: Date.now() - start,\n      });\n    } catch (error) {\n      await this.recordAction({\n        type: 'click',\n        timestamp: new Date().toISOString(),\n        params: { selector },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  async type(selector: string, text: string, options?: { delay?: number; timeout?: number; submit?: boolean; waitAfter?: number }): Promise<void> {\n    const start = Date.now();\n    const timeout = options?.timeout || 5000;\n\n    try {\n      // Use locator API with visible filter - auto-targets visible input\n      const locator = this.page.locator(selector).filter({ visible: true }).first();\n\n      // Clear existing content and fill with new text\n      await locator.fill('', { timeout });\n\n      if (options?.delay && options.delay > 0) {\n        // Type character by character with delay\n        await locator.pressSequentially(text, { delay: options.delay, timeout });\n      } else {\n        // Fast fill\n        await locator.fill(text, { timeout });\n      }\n\n      // Submit if requested (press Enter)\n      if (options?.submit) {\n        await locator.press('Enter', { timeout });\n        // Wait for navigation/network after submit\n        if (options?.waitAfter) {\n          await this.page.waitForTimeout(options.waitAfter);\n        } else {\n          // Default: wait for network idle after submit\n          await this.page.waitForLoadState('networkidle', { timeout: 10000 }).catch(() => {});\n        }\n      } else if (options?.waitAfter) {\n        await this.page.waitForTimeout(options.waitAfter);\n      }\n\n      await this.recordAction({\n        type: 'type',\n        timestamp: new Date().toISOString(),\n        params: { selector, text: text.length > 50 ? `${text.slice(0, 50)}...` : text, submit: options?.submit },\n        success: true,\n        duration: Date.now() - start,\n      });\n    } catch (error) {\n      await this.recordAction({\n        type: 'type',\n        timestamp: new Date().toISOString(),\n        params: { selector, text: text.length > 50 ? `${text.slice(0, 50)}...` : text },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  async waitFor(selectorOrTime: string | number, options?: { timeout?: number }): Promise<void> {\n    const start = Date.now();\n\n    try {\n      if (typeof selectorOrTime === 'number') {\n        await this.page.waitForTimeout(selectorOrTime);\n      } else {\n        // Use locator API with visible filter - waits for visible element only\n        const locator = this.page.locator(selectorOrTime).filter({ visible: true }).first();\n        await locator.waitFor({\n          state: 'visible',\n          timeout: options?.timeout || 30000\n        });\n      }\n      await this.recordAction({\n        type: 'wait',\n        timestamp: new Date().toISOString(),\n        params: { target: selectorOrTime },\n        success: true,\n        duration: Date.now() - start,\n      });\n    } catch (error) {\n      await this.recordAction({\n        type: 'wait',\n        timestamp: new Date().toISOString(),\n        params: { target: selectorOrTime },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  async screenshot(options?: { name?: string; fullPage?: boolean; selector?: string }): Promise<{ path: string; elements: EnhancedElement[]; audit: AuditResult }> {\n    const start = Date.now();\n    const screenshotName = options?.name || `screenshot-${Date.now()}`;\n    const outputPath = join(this.sessionDir, `${screenshotName}.png`);\n\n    try {\n      // Disable animations\n      await this.page.addStyleTag({\n        content: `\n          *, *::before, *::after {\n            animation-duration: 0s !important;\n            animation-delay: 0s !important;\n            transition-duration: 0s !important;\n            transition-delay: 0s !important;\n          }\n        `,\n      });\n\n      if (options?.selector) {\n        const element = await this.page.waitForSelector(options.selector, { timeout: 5000 });\n        if (!element) {\n          throw new Error(`Element not found: ${options.selector}`);\n        }\n        await element.screenshot({ path: outputPath, type: 'png' });\n      } else {\n        await this.page.screenshot({\n          path: outputPath,\n          fullPage: options?.fullPage ?? true,\n          type: 'png',\n        });\n      }\n\n      // Extract interactive elements for audit\n      const elements = await extractInteractiveElements(this.page);\n\n      // Analyze for issues (detect mobile by viewport width)\n      const isMobile = this.state.viewport.width < 768;\n      const audit = analyzeElements(elements, isMobile);\n\n      // Store in session state\n      this.state.elements = elements;\n      this.state.audit = audit;\n      await this.saveState();\n\n      await this.recordAction({\n        type: 'screenshot',\n        timestamp: new Date().toISOString(),\n        params: {\n          name: screenshotName,\n          path: outputPath,\n          selector: options?.selector,\n          elementsCount: elements.length,\n          issuesCount: audit.issues.length,\n        },\n        success: true,\n        duration: Date.now() - start,\n      });\n\n      return { path: outputPath, elements, audit };\n    } catch (error) {\n      await this.recordAction({\n        type: 'screenshot',\n        timestamp: new Date().toISOString(),\n        params: { name: screenshotName, selector: options?.selector },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  async press(key: string): Promise<void> {\n    await this.page.keyboard.press(key);\n  }\n\n  async evaluate<T>(script: string | (() => T)): Promise<T> {\n    return this.page.evaluate(script) as Promise<T>;\n  }\n\n  async content(): Promise<string> {\n    return this.page.content();\n  }\n\n  async title(): Promise<string> {\n    return this.page.title();\n  }\n\n  /**\n   * Get text content from a specific selector\n   */\n  async textContent(selector: string): Promise<string | null> {\n    return this.page.textContent(selector);\n  }\n\n  /**\n   * Get inner text from a specific selector (visible text only)\n   */\n  async innerText(selector: string): Promise<string> {\n    return this.page.innerText(selector);\n  }\n\n  /**\n   * Get all matching elements' text content\n   */\n  async allTextContent(selector: string): Promise<string[]> {\n    const elements = await this.page.$$(selector);\n    const texts: string[] = [];\n    for (const el of elements) {\n      const text = await el.textContent();\n      if (text) texts.push(text.trim());\n    }\n    return texts;\n  }\n\n  /**\n   * Close just this session (not the browser server)\n   */\n  async close(): Promise<void> {\n    await this.context.close();\n  }\n\n  /**\n   * Get raw Playwright page\n   */\n  getPage(): Page {\n    return this.page;\n  }\n}\n\n/**\n * List active sessions by checking session directories\n */\nexport async function listActiveSessions(outputDir: string): Promise<string[]> {\n  const { sessionsDir } = getPaths(outputDir);\n\n  if (!existsSync(sessionsDir)) {\n    return [];\n  }\n\n  const { readdir } = await import('fs/promises');\n  const entries = await readdir(sessionsDir, { withFileTypes: true });\n\n  const liveSessions: string[] = [];\n\n  for (const entry of entries) {\n    if (entry.isDirectory() && entry.name.startsWith('live_')) {\n      const statePath = join(sessionsDir, entry.name, 'live-session.json');\n      if (existsSync(statePath)) {\n        liveSessions.push(entry.name);\n      }\n    }\n  }\n\n  return liveSessions;\n}\n","import { chromium, type Browser, type BrowserContext, type Page } from 'playwright';\nimport { writeFile, readFile, unlink, mkdir } from 'fs/promises';\nimport { existsSync } from 'fs';\nimport { join } from 'path';\nimport { nanoid } from 'nanoid';\nimport { VIEWPORTS, type Viewport } from './schemas.js';\n\n/**\n * Live session state file structure\n */\ninterface LiveSessionState {\n  id: string;\n  url: string;\n  name: string;\n  viewport: Viewport;\n  sandbox: boolean;\n  createdAt: string;\n  actions: ActionRecord[];\n}\n\n/**\n * Recorded action for reproducibility\n */\nexport interface ActionRecord {\n  type: 'navigate' | 'click' | 'type' | 'fill' | 'hover' | 'evaluate' | 'screenshot' | 'wait';\n  timestamp: string;\n  params: Record<string, unknown>;\n  success: boolean;\n  error?: string;\n  duration?: number;\n}\n\n/**\n * Options for creating a live session\n */\nexport interface LiveSessionOptions {\n  url: string;\n  name?: string;\n  viewport?: Viewport;\n  sandbox?: boolean;  // visible browser (default: false = headless)\n  debug?: boolean;    // sandbox + slowMo + devtools\n  timeout?: number;\n}\n\n/**\n * Fill form field definition\n */\nexport interface FormField {\n  selector: string;\n  value: string;\n  type?: 'text' | 'checkbox' | 'radio' | 'select';\n}\n\n/**\n * Screenshot options for live sessions\n */\nexport interface LiveScreenshotOptions {\n  name?: string;\n  fullPage?: boolean;\n  selector?: string;\n}\n\n/**\n * Live interactive browser session\n * Keeps browser alive for sequential interactions\n */\nexport class LiveSession {\n  private browser: Browser | null = null;\n  private context: BrowserContext | null = null;\n  private page: Page | null = null;\n  private state: LiveSessionState;\n  private outputDir: string;\n  private sessionDir: string;\n\n  private constructor(\n    state: LiveSessionState,\n    outputDir: string,\n    browser: Browser,\n    context: BrowserContext,\n    page: Page\n  ) {\n    this.state = state;\n    this.outputDir = outputDir;\n    this.sessionDir = join(outputDir, 'sessions', state.id);\n    this.browser = browser;\n    this.context = context;\n    this.page = page;\n  }\n\n  /**\n   * Create a new live session\n   */\n  static async create(outputDir: string, options: LiveSessionOptions): Promise<LiveSession> {\n    const {\n      url,\n      name,\n      viewport = VIEWPORTS.desktop,\n      sandbox = false,\n      debug = false,\n      timeout = 30000,\n    } = options;\n\n    // Generate session ID\n    const sessionId = `live_${nanoid(10)}`;\n    const sessionDir = join(outputDir, 'sessions', sessionId);\n    await mkdir(sessionDir, { recursive: true });\n\n    // Launch browser with appropriate mode\n    const browser = await chromium.launch({\n      headless: !sandbox && !debug,\n      slowMo: debug ? 100 : 0,\n      devtools: debug,\n    });\n\n    // Create context with viewport\n    const context = await browser.newContext({\n      viewport: {\n        width: viewport.width,\n        height: viewport.height,\n      },\n      reducedMotion: 'reduce',\n    });\n\n    // Create page and navigate\n    const page = await context.newPage();\n\n    const navStart = Date.now();\n    await page.goto(url, {\n      waitUntil: 'networkidle',\n      timeout,\n    });\n    const navDuration = Date.now() - navStart;\n\n    // Initialize state\n    const state: LiveSessionState = {\n      id: sessionId,\n      url,\n      name: name || new URL(url).pathname,\n      viewport,\n      sandbox: sandbox || debug,\n      createdAt: new Date().toISOString(),\n      actions: [{\n        type: 'navigate',\n        timestamp: new Date().toISOString(),\n        params: { url },\n        success: true,\n        duration: navDuration,\n      }],\n    };\n\n    // Save initial state\n    await writeFile(\n      join(sessionDir, 'live-session.json'),\n      JSON.stringify(state, null, 2)\n    );\n\n    // Capture initial screenshot as baseline for UI display\n    await page.screenshot({\n      path: join(sessionDir, 'baseline.png'),\n      fullPage: false,\n    });\n\n    return new LiveSession(state, outputDir, browser, context, page);\n  }\n\n  /**\n   * Resume an existing live session (if browser still running)\n   * Note: This only works within the same process - browser state is not persisted\n   */\n  static async resume(outputDir: string, sessionId: string): Promise<LiveSession | null> {\n    const sessionDir = join(outputDir, 'sessions', sessionId);\n    const statePath = join(sessionDir, 'live-session.json');\n\n    if (!existsSync(statePath)) {\n      return null;\n    }\n\n    // Load state - but browser needs to be recreated\n    const content = await readFile(statePath, 'utf-8');\n    const state = JSON.parse(content) as LiveSessionState;\n\n    // Relaunch browser and navigate to last URL\n    const browser = await chromium.launch({\n      headless: !state.sandbox,\n    });\n\n    const context = await browser.newContext({\n      viewport: {\n        width: state.viewport.width,\n        height: state.viewport.height,\n      },\n      reducedMotion: 'reduce',\n    });\n\n    const page = await context.newPage();\n    await page.goto(state.url, { waitUntil: 'networkidle' });\n\n    return new LiveSession(state, outputDir, browser, context, page);\n  }\n\n  /**\n   * Get session ID\n   */\n  get id(): string {\n    return this.state.id;\n  }\n\n  /**\n   * Get current URL\n   */\n  get url(): string {\n    return this.page?.url() || this.state.url;\n  }\n\n  /**\n   * Get action history\n   */\n  get actions(): ActionRecord[] {\n    return [...this.state.actions];\n  }\n\n  /**\n   * Record an action\n   */\n  private async recordAction(action: ActionRecord): Promise<void> {\n    this.state.actions.push(action);\n    await this.saveState();\n  }\n\n  /**\n   * Save session state\n   */\n  private async saveState(): Promise<void> {\n    await writeFile(\n      join(this.sessionDir, 'live-session.json'),\n      JSON.stringify(this.state, null, 2)\n    );\n  }\n\n  /**\n   * Ensure page is available\n   */\n  private ensurePage(): Page {\n    if (!this.page) {\n      throw new Error('Session is closed. Create a new session.');\n    }\n    return this.page;\n  }\n\n  /**\n   * Navigate to a new URL\n   */\n  async navigate(url: string, options?: { timeout?: number }): Promise<void> {\n    const page = this.ensurePage();\n    const start = Date.now();\n\n    try {\n      await page.goto(url, {\n        waitUntil: 'networkidle',\n        timeout: options?.timeout || 30000,\n      });\n      this.state.url = url;\n      await this.recordAction({\n        type: 'navigate',\n        timestamp: new Date().toISOString(),\n        params: { url },\n        success: true,\n        duration: Date.now() - start,\n      });\n    } catch (error) {\n      await this.recordAction({\n        type: 'navigate',\n        timestamp: new Date().toISOString(),\n        params: { url },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Click an element\n   */\n  async click(selector: string, options?: { timeout?: number }): Promise<void> {\n    const page = this.ensurePage();\n    const start = Date.now();\n\n    try {\n      await page.click(selector, { timeout: options?.timeout || 5000 });\n      await this.recordAction({\n        type: 'click',\n        timestamp: new Date().toISOString(),\n        params: { selector },\n        success: true,\n        duration: Date.now() - start,\n      });\n    } catch (error) {\n      await this.recordAction({\n        type: 'click',\n        timestamp: new Date().toISOString(),\n        params: { selector },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Type text into an element (clears existing content first)\n   */\n  async type(selector: string, text: string, options?: { delay?: number; timeout?: number }): Promise<void> {\n    const page = this.ensurePage();\n    const start = Date.now();\n\n    try {\n      await page.fill(selector, ''); // Clear first\n      await page.type(selector, text, { delay: options?.delay || 0 });\n      await this.recordAction({\n        type: 'type',\n        timestamp: new Date().toISOString(),\n        params: { selector, text: text.length > 50 ? `${text.slice(0, 50)}...` : text },\n        success: true,\n        duration: Date.now() - start,\n      });\n    } catch (error) {\n      await this.recordAction({\n        type: 'type',\n        timestamp: new Date().toISOString(),\n        params: { selector, text: text.length > 50 ? `${text.slice(0, 50)}...` : text },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Fill a form with multiple fields\n   */\n  async fill(fields: FormField[]): Promise<void> {\n    const page = this.ensurePage();\n    const start = Date.now();\n    const results: { selector: string; success: boolean; error?: string }[] = [];\n\n    for (const field of fields) {\n      try {\n        if (field.type === 'checkbox') {\n          if (field.value === 'true' || field.value === '1') {\n            await page.check(field.selector);\n          } else {\n            await page.uncheck(field.selector);\n          }\n        } else if (field.type === 'select') {\n          await page.selectOption(field.selector, field.value);\n        } else {\n          await page.fill(field.selector, field.value);\n        }\n        results.push({ selector: field.selector, success: true });\n      } catch (error) {\n        results.push({\n          selector: field.selector,\n          success: false,\n          error: error instanceof Error ? error.message : String(error),\n        });\n      }\n    }\n\n    const allSuccess = results.every(r => r.success);\n    await this.recordAction({\n      type: 'fill',\n      timestamp: new Date().toISOString(),\n      params: { fields: fields.map(f => ({ selector: f.selector, type: f.type || 'text' })), results },\n      success: allSuccess,\n      error: allSuccess ? undefined : `Failed to fill ${results.filter(r => !r.success).length} field(s)`,\n      duration: Date.now() - start,\n    });\n\n    if (!allSuccess) {\n      const failed = results.filter(r => !r.success);\n      throw new Error(`Failed to fill fields: ${failed.map(f => f.selector).join(', ')}`);\n    }\n  }\n\n  /**\n   * Hover over an element\n   */\n  async hover(selector: string, options?: { timeout?: number }): Promise<void> {\n    const page = this.ensurePage();\n    const start = Date.now();\n\n    try {\n      await page.hover(selector, { timeout: options?.timeout || 5000 });\n      await this.recordAction({\n        type: 'hover',\n        timestamp: new Date().toISOString(),\n        params: { selector },\n        success: true,\n        duration: Date.now() - start,\n      });\n    } catch (error) {\n      await this.recordAction({\n        type: 'hover',\n        timestamp: new Date().toISOString(),\n        params: { selector },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Execute JavaScript in the page context\n   */\n  async evaluate<T>(script: string | (() => T)): Promise<T> {\n    const page = this.ensurePage();\n    const start = Date.now();\n\n    try {\n      const result = await page.evaluate(script);\n      await this.recordAction({\n        type: 'evaluate',\n        timestamp: new Date().toISOString(),\n        params: { script: typeof script === 'string' ? script.slice(0, 100) : '[function]' },\n        success: true,\n        duration: Date.now() - start,\n      });\n      return result as T;\n    } catch (error) {\n      await this.recordAction({\n        type: 'evaluate',\n        timestamp: new Date().toISOString(),\n        params: { script: typeof script === 'string' ? script.slice(0, 100) : '[function]' },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Wait for a selector or timeout\n   */\n  async waitFor(selectorOrTime: string | number, options?: { timeout?: number }): Promise<void> {\n    const page = this.ensurePage();\n    const start = Date.now();\n\n    try {\n      if (typeof selectorOrTime === 'number') {\n        await page.waitForTimeout(selectorOrTime);\n      } else {\n        await page.waitForSelector(selectorOrTime, { timeout: options?.timeout || 30000 });\n      }\n      await this.recordAction({\n        type: 'wait',\n        timestamp: new Date().toISOString(),\n        params: { target: selectorOrTime },\n        success: true,\n        duration: Date.now() - start,\n      });\n    } catch (error) {\n      await this.recordAction({\n        type: 'wait',\n        timestamp: new Date().toISOString(),\n        params: { target: selectorOrTime },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Take a screenshot\n   */\n  async screenshot(options?: LiveScreenshotOptions): Promise<string> {\n    const page = this.ensurePage();\n    const start = Date.now();\n\n    const screenshotName = options?.name || `screenshot-${Date.now()}`;\n    const outputPath = join(this.sessionDir, `${screenshotName}.png`);\n\n    try {\n      // Disable animations\n      await page.addStyleTag({\n        content: `\n          *, *::before, *::after {\n            animation-duration: 0s !important;\n            animation-delay: 0s !important;\n            transition-duration: 0s !important;\n            transition-delay: 0s !important;\n          }\n        `,\n      });\n\n      if (options?.selector) {\n        const element = await page.waitForSelector(options.selector, { timeout: 5000 });\n        if (!element) {\n          throw new Error(`Element not found: ${options.selector}`);\n        }\n        await element.screenshot({ path: outputPath, type: 'png' });\n      } else {\n        await page.screenshot({\n          path: outputPath,\n          fullPage: options?.fullPage ?? true,\n          type: 'png',\n        });\n      }\n\n      await this.recordAction({\n        type: 'screenshot',\n        timestamp: new Date().toISOString(),\n        params: { name: screenshotName, path: outputPath, selector: options?.selector },\n        success: true,\n        duration: Date.now() - start,\n      });\n\n      return outputPath;\n    } catch (error) {\n      await this.recordAction({\n        type: 'screenshot',\n        timestamp: new Date().toISOString(),\n        params: { name: screenshotName, selector: options?.selector },\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        duration: Date.now() - start,\n      });\n      throw error;\n    }\n  }\n\n  /**\n   * Get page content (HTML)\n   */\n  async content(): Promise<string> {\n    const page = this.ensurePage();\n    return page.content();\n  }\n\n  /**\n   * Get page title\n   */\n  async title(): Promise<string> {\n    const page = this.ensurePage();\n    return page.title();\n  }\n\n  /**\n   * Check if an element exists\n   */\n  async exists(selector: string): Promise<boolean> {\n    const page = this.ensurePage();\n    const element = await page.$(selector);\n    return element !== null;\n  }\n\n  /**\n   * Get text content of an element\n   */\n  async textContent(selector: string): Promise<string | null> {\n    const page = this.ensurePage();\n    return page.textContent(selector);\n  }\n\n  /**\n   * Get attribute of an element\n   */\n  async getAttribute(selector: string, attribute: string): Promise<string | null> {\n    const page = this.ensurePage();\n    return page.getAttribute(selector, attribute);\n  }\n\n  /**\n   * Press a keyboard key\n   */\n  async press(key: string): Promise<void> {\n    const page = this.ensurePage();\n    await page.keyboard.press(key);\n  }\n\n  /**\n   * Select option(s) from a dropdown\n   */\n  async select(selector: string, values: string | string[]): Promise<void> {\n    const page = this.ensurePage();\n    await page.selectOption(selector, values);\n  }\n\n  /**\n   * Close the session and browser\n   */\n  async close(): Promise<void> {\n    if (this.context) {\n      await this.context.close();\n      this.context = null;\n    }\n    if (this.browser) {\n      await this.browser.close();\n      this.browser = null;\n    }\n    this.page = null;\n\n    // Mark session as closed in state\n    await this.saveState();\n  }\n\n  /**\n   * Check if session is still active\n   */\n  get isActive(): boolean {\n    return this.browser !== null && this.page !== null;\n  }\n\n  /**\n   * Get underlying Playwright page (for advanced use)\n   */\n  getPage(): Page {\n    return this.ensurePage();\n  }\n}\n\n/**\n * Singleton manager for live sessions\n */\nclass LiveSessionManager {\n  private sessions: Map<string, LiveSession> = new Map();\n\n  /**\n   * Create a new live session\n   */\n  async create(outputDir: string, options: LiveSessionOptions): Promise<LiveSession> {\n    const session = await LiveSession.create(outputDir, options);\n    this.sessions.set(session.id, session);\n    return session;\n  }\n\n  /**\n   * Get an active session by ID\n   */\n  get(sessionId: string): LiveSession | undefined {\n    return this.sessions.get(sessionId);\n  }\n\n  /**\n   * Close a session\n   */\n  async close(sessionId: string): Promise<boolean> {\n    const session = this.sessions.get(sessionId);\n    if (session) {\n      await session.close();\n      this.sessions.delete(sessionId);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Close all sessions\n   */\n  async closeAll(): Promise<void> {\n    for (const session of this.sessions.values()) {\n      await session.close();\n    }\n    this.sessions.clear();\n  }\n\n  /**\n   * List active session IDs\n   */\n  list(): string[] {\n    return Array.from(this.sessions.keys());\n  }\n}\n\n// Export singleton manager\nexport const liveSessionManager = new LiveSessionManager();\n","import { Command } from 'commander';\nimport { readFile } from 'fs/promises';\nimport { join } from 'path';\nimport { existsSync } from 'fs';\nimport {\n  InterfaceBuiltRight,\n  formatReportText,\n  formatReportJson,\n  formatReportMinimal,\n  formatSessionSummary,\n  VIEWPORTS,\n  type Config,\n} from '../index.js';\n\nconst program = new Command();\n\n// Load config from .ibrrc.json if it exists\nasync function loadConfig(): Promise<Partial<Config>> {\n  const configPath = join(process.cwd(), '.ibrrc.json');\n  if (existsSync(configPath)) {\n    try {\n      const content = await readFile(configPath, 'utf-8');\n      return JSON.parse(content);\n    } catch {\n      // Ignore config errors\n    }\n  }\n  return {};\n}\n\n// Default IBR UI port\nconst IBR_DEFAULT_PORT = 4200;\n\n// Check if a port is available\nasync function isPortAvailable(port: number): Promise<boolean> {\n  return new Promise((resolve) => {\n    import('net').then(({ createServer }) => {\n      const server = createServer();\n      server.once('error', () => resolve(false));\n      server.once('listening', () => {\n        server.close();\n        resolve(true);\n      });\n      server.listen(port, '127.0.0.1');\n    });\n  });\n}\n\n// Find an available port starting from the given port\nasync function findAvailablePort(startPort: number, maxAttempts = 10): Promise<number> {\n  for (let i = 0; i < maxAttempts; i++) {\n    const port = startPort + i;\n    if (await isPortAvailable(port)) {\n      return port;\n    }\n  }\n  throw new Error(`No available ports found in range ${startPort}-${startPort + maxAttempts - 1}`);\n}\n\n// Create IBR instance with config\nasync function createIBR(options: Record<string, unknown> = {}): Promise<InterfaceBuiltRight> {\n  const config = await loadConfig();\n\n  // Merge CLI options with config\n  const merged: Partial<Config> = {\n    ...config,\n    ...(options.baseUrl ? { baseUrl: String(options.baseUrl) } : {}),\n    ...(options.output ? { outputDir: String(options.output) } : {}),\n    ...(options.viewport ? { viewport: VIEWPORTS[options.viewport as keyof typeof VIEWPORTS] } : {}),\n    ...(options.threshold ? { threshold: Number(options.threshold) } : {}),\n    ...(options.fullPage !== undefined ? { fullPage: Boolean(options.fullPage) } : {}),\n  };\n\n  return new InterfaceBuiltRight(merged);\n}\n\nprogram\n  .name('ibr')\n  .description('Visual regression testing for Claude Code')\n  .version('0.2.4');\n\n// Global options\nprogram\n  .option('-b, --base-url <url>', 'Base URL for the application')\n  .option('-o, --output <dir>', 'Output directory', './.ibr')\n  .option('-v, --viewport <name>', 'Viewport: desktop, mobile, tablet', 'desktop')\n  .option('-t, --threshold <percent>', 'Diff threshold percentage', '1.0');\n\n// Start command\nprogram\n  .command('start [url]')\n  .description('Capture a baseline screenshot (auto-detects dev server if no URL)')\n  .option('-n, --name <name>', 'Session name')\n  .option('-s, --selector <css>', 'CSS selector to capture specific element')\n  .option('-w, --wait-for <selector>', 'Wait for selector before screenshot')\n  .option('--no-full-page', 'Capture only the viewport, not full page')\n  .option('--sandbox', 'Show visible browser window (default: headless)')\n  .option('--debug', 'Visible browser + slow motion + devtools')\n  .action(async (url: string | undefined, options: { name?: string; fullPage?: boolean; selector?: string; waitFor?: string; sandbox?: boolean; debug?: boolean }) => {\n    try {\n      const resolvedUrl = await resolveBaseUrl(url);\n      const ibr = await createIBR(program.opts());\n      const result = await ibr.startSession(resolvedUrl, {\n        name: options.name,\n        fullPage: options.fullPage,\n        selector: options.selector,\n        waitFor: options.waitFor,\n      });\n\n      console.log(`Session started: ${result.sessionId}`);\n      console.log(`Baseline: ${result.baseline}`);\n      console.log(`URL: ${result.session.url}`);\n      console.log('');\n      console.log('Next: Make your changes, then run:');\n      console.log(`  npx ibr check ${result.sessionId}`);\n\n      await ibr.close();\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Auto command - zero-config workflow\nprogram\n  .command('auto')\n  .description('Zero-config: detect server, scan pages, open viewer')\n  .option('-n, --max-pages <count>', 'Maximum pages to scan', '5')\n  .option('--nav-only', 'Only scan navigation links (faster)')\n  .option('--no-open', 'Do not open browser automatically')\n  .action(async (options: { maxPages: string; navOnly?: boolean; open?: boolean }) => {\n    try {\n      // 1. Detect dev server\n      const baseUrl = await detectDevServer();\n      if (!baseUrl) {\n        console.log('No dev server detected.');\n        console.log('');\n        console.log('Start your dev server, then run:');\n        console.log('  npx ibr auto');\n        console.log('');\n        console.log('Or specify a URL:');\n        console.log('  npx ibr scan-start http://localhost:3000');\n        return;\n      }\n\n      console.log(`Detected: ${baseUrl}`);\n      console.log('');\n\n      // 2. Discover and capture pages\n      const { discoverPages, getNavigationLinks } = await import('../crawl.js');\n      const ibr = await createIBR(program.opts());\n\n      let pages;\n      if (options.navOnly) {\n        pages = await getNavigationLinks(baseUrl);\n        console.log(`Found ${pages.length} navigation links.`);\n      } else {\n        const result = await discoverPages({\n          url: baseUrl,\n          maxPages: parseInt(options.maxPages, 10),\n        });\n        pages = result.pages;\n        console.log(`Discovered ${pages.length} pages.`);\n      }\n\n      if (pages.length === 0) {\n        console.log('No pages found to capture.');\n        await ibr.close();\n        return;\n      }\n\n      console.log('Capturing baselines...');\n      console.log('');\n\n      let captured = 0;\n      for (const page of pages) {\n        try {\n          const result = await ibr.startSession(page.url, {\n            name: page.title.replace(/[^a-zA-Z0-9-_]/g, '-').toLowerCase().slice(0, 50),\n          });\n          captured++;\n          console.log(`  ${page.path} -> ${result.sessionId}`);\n        } catch {\n          console.log(`  ${page.path} -> failed`);\n        }\n      }\n\n      await ibr.close();\n\n      console.log('');\n      console.log(`Captured ${captured}/${pages.length} pages.`);\n      console.log('');\n      console.log('Next steps:');\n      console.log('  1. Make your UI changes');\n      console.log('  2. Run: npx ibr scan-check');\n      console.log('  3. View: npx ibr serve');\n\n      // 3. Optionally open viewer\n      if (options.open !== false && captured > 0) {\n        console.log('');\n        console.log('Opening viewer...');\n        const { spawn } = await import('child_process');\n        spawn('npx', ['ibr', 'serve'], {\n          stdio: 'inherit',\n          shell: true,\n          detached: true,\n        }).unref();\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Check command\nprogram\n  .command('check [sessionId]')\n  .description('Compare current state against baseline')\n  .option('-f, --format <format>', 'Output format: json, text, minimal', 'text')\n  .action(async (sessionId: string | undefined, options: { format: string }) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const report = await ibr.check(sessionId);\n\n      switch (options.format) {\n        case 'json':\n          console.log(formatReportJson(report));\n          break;\n        case 'minimal':\n          console.log(formatReportMinimal(report));\n          break;\n        default:\n          console.log(formatReportText(report));\n      }\n\n      // Contextual tips based on verdict\n      if (options.format === 'text') {\n        console.log('');\n        if (report.analysis.verdict === 'MATCH') {\n          console.log('All good! To capture more pages: npx ibr scan');\n        } else if (report.analysis.verdict === 'EXPECTED_CHANGE') {\n          console.log('To accept as new baseline: npx ibr update');\n        } else if (report.analysis.verdict === 'UNEXPECTED_CHANGE' || report.analysis.verdict === 'LAYOUT_BROKEN') {\n          console.log('View diff in browser: npx ibr serve');\n        }\n      }\n\n      await ibr.close();\n\n      // Exit with error code if not matching and not expected\n      if (!report.comparison.match &&\n          (report.analysis.verdict === 'UNEXPECTED_CHANGE' ||\n           report.analysis.verdict === 'LAYOUT_BROKEN')) {\n        process.exit(1);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Audit command - full UI audit with configurable rules\nprogram\n  .command('audit [url]')\n  .description('Audit a page for UI issues (handlers, accessibility, touch targets)')\n  .option('-r, --rules <preset>', 'Rule preset: minimal (default)', 'minimal')\n  .option('--json', 'Output as JSON')\n  .option('--fail-on <level>', 'Exit non-zero on errors/warnings', 'error')\n  .action(async (url: string | undefined, options: { rules: string; json?: boolean; failOn: string }) => {\n    try {\n      const resolvedUrl = await resolveBaseUrl(url);\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n\n      // Import rule engine and browser server\n      const { loadRulesConfig, runRules, createAuditResult, formatAuditResult } = await import('../rules/engine.js');\n      const { register } = await import('../rules/presets/minimal.js');\n      const { startBrowserServer, connectToBrowserServer, stopBrowserServer, isServerRunning } = await import('../browser-server.js');\n      const { extractInteractiveElements } = await import('../extract.js');\n      const { chromium } = await import('playwright');\n\n      // Register presets\n      register();\n\n      // Load rules config\n      const rulesConfig = await loadRulesConfig(process.cwd());\n      if (options.rules && options.rules !== 'minimal') {\n        rulesConfig.extends = [options.rules];\n      }\n\n      console.log(`Auditing ${resolvedUrl}...`);\n      console.log('');\n\n      // Launch browser for audit\n      const browser = await chromium.launch({ headless: true });\n      const viewport = VIEWPORTS[globalOpts.viewport as keyof typeof VIEWPORTS] || VIEWPORTS.desktop;\n\n      const context = await browser.newContext({\n        viewport: { width: viewport.width, height: viewport.height },\n        reducedMotion: 'reduce',\n      });\n\n      const page = await context.newPage();\n      await page.goto(resolvedUrl, { waitUntil: 'networkidle', timeout: 30000 });\n\n      // Extract elements\n      const elements = await extractInteractiveElements(page);\n\n      // Run rules\n      const isMobile = viewport.width < 768;\n      const violations = runRules(elements, {\n        isMobile,\n        viewportWidth: viewport.width,\n        viewportHeight: viewport.height,\n        url: resolvedUrl,\n        allElements: elements,\n      }, rulesConfig);\n\n      // Create result\n      const result = createAuditResult(resolvedUrl, elements, violations);\n\n      await context.close();\n      await browser.close();\n\n      // Output\n      if (options.json) {\n        console.log(JSON.stringify(result, null, 2));\n      } else {\n        console.log(formatAuditResult(result));\n      }\n\n      // Exit code based on --fail-on\n      if (options.failOn === 'error' && result.summary.errors > 0) {\n        process.exit(1);\n      } else if (options.failOn === 'warning' && (result.summary.errors > 0 || result.summary.warnings > 0)) {\n        process.exit(1);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Status command - show pending baselines\nprogram\n  .command('status')\n  .description('Show sessions awaiting comparison (baselines without checks)')\n  .action(async () => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const sessions = await ibr.listSessions();\n\n      // Filter to baseline-only sessions (not yet compared)\n      const pending = sessions.filter(s => s.status === 'baseline');\n\n      if (pending.length === 0) {\n        console.log('No pending visual checks.');\n        console.log('');\n        console.log('To capture a baseline:');\n        console.log('  npx ibr start <url> --name \"feature-name\"');\n        return;\n      }\n\n      console.log('Pending visual checks:');\n      console.log('');\n\n      for (const session of pending) {\n        const age = Date.now() - new Date(session.createdAt).getTime();\n        const ageStr = age < 60000 ? 'just now' :\n                       age < 3600000 ? `${Math.floor(age / 60000)}m ago` :\n                       age < 86400000 ? `${Math.floor(age / 3600000)}h ago` :\n                       `${Math.floor(age / 86400000)}d ago`;\n\n        const urlPath = new URL(session.url).pathname;\n        console.log(`  ${session.id}  ${urlPath.padEnd(20)}  ${ageStr.padEnd(10)}  ${session.name || ''}`);\n      }\n\n      console.log('');\n      console.log('Run comparison:');\n      console.log('  npx ibr check              # checks most recent');\n      console.log('  npx ibr check <session-id> # checks specific session');\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// List command\nprogram\n  .command('list')\n  .description('List all sessions')\n  .option('-f, --format <format>', 'Output format: json, text', 'text')\n  .action(async (options: { format: string }) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const sessions = await ibr.listSessions();\n\n      if (sessions.length === 0) {\n        console.log('No sessions found.');\n        return;\n      }\n\n      if (options.format === 'json') {\n        console.log(JSON.stringify(sessions, null, 2));\n      } else {\n        console.log('Sessions:');\n        console.log('');\n        console.log('ID              STATUS    VIEWPORT  DATE        NAME');\n        console.log('-'.repeat(70));\n        for (const session of sessions) {\n          console.log(formatSessionSummary(session));\n        }\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Update command\nprogram\n  .command('update [sessionId]')\n  .alias('approve')\n  .description('Update baseline with current screenshot (alias: approve)')\n  .action(async (sessionId: string | undefined) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const session = await ibr.updateBaseline(sessionId);\n\n      console.log(`Baseline updated for session: ${session.id}`);\n      console.log(`URL: ${session.url}`);\n\n      await ibr.close();\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Clean command\nprogram\n  .command('clean')\n  .description('Clean old sessions')\n  .option('--older-than <duration>', 'Delete sessions older than duration (e.g., 7d, 24h)')\n  .option('--keep-last <count>', 'Keep the last N sessions', '0')\n  .option('--dry-run', 'Show what would be deleted without deleting')\n  .action(async (options: { olderThan?: string; keepLast: string; dryRun?: boolean }) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const result = await ibr.clean({\n        olderThan: options.olderThan,\n        keepLast: parseInt(options.keepLast, 10),\n        dryRun: options.dryRun,\n      });\n\n      if (options.dryRun) {\n        console.log('Dry run - would delete:');\n      } else {\n        console.log('Cleaned:');\n      }\n\n      if (result.deleted.length === 0) {\n        console.log('  No sessions to delete.');\n      } else {\n        for (const id of result.deleted) {\n          console.log(`  - ${id}`);\n        }\n      }\n\n      console.log(`\\nKept: ${result.kept.length} sessions`);\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Delete command\nprogram\n  .command('delete <sessionId>')\n  .description('Delete a specific session')\n  .action(async (sessionId: string) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const deleted = await ibr.deleteSession(sessionId);\n\n      if (deleted) {\n        console.log(`Deleted session: ${sessionId}`);\n      } else {\n        console.log(`Session not found: ${sessionId}`);\n        process.exit(1);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Serve command (placeholder - will be implemented with web-ui)\nprogram\n  .command('serve')\n  .description('Start the comparison viewer web UI')\n  .option('-p, --port <port>', `Port number (default: ${IBR_DEFAULT_PORT}, auto-scans for available)`)\n  .option('--no-open', 'Do not open browser automatically')\n  .action(async (options: { port?: string; open?: boolean }) => {\n    const { spawn } = await import('child_process');\n    const { resolve } = await import('path');\n\n    // Find web-ui directory relative to package root\n    // In CJS build, use process.cwd() or resolve from known location\n    const packageRoot = resolve(process.cwd());\n    let webUiDir = join(packageRoot, 'web-ui');\n\n    // If not found in cwd, try relative to node_modules install\n    if (!existsSync(webUiDir)) {\n      // Try finding it relative to this package when installed as dependency\n      const possiblePaths = [\n        join(packageRoot, 'node_modules', 'interface-built-right', 'web-ui'),\n        join(packageRoot, '..', 'interface-built-right', 'web-ui'),\n      ];\n      for (const p of possiblePaths) {\n        if (existsSync(p)) {\n          webUiDir = p;\n          break;\n        }\n      }\n    }\n\n    // Check if web-ui exists\n    if (!existsSync(webUiDir)) {\n      console.log('Web UI not found. Please ensure web-ui directory exists.');\n      console.log('');\n      console.log('For now, you can view the comparison images directly:');\n\n      try {\n        const ibr = await createIBR(program.opts());\n        const session = await ibr.getMostRecentSession();\n\n        if (session) {\n          const config = ibr.getConfig();\n          console.log(`  Baseline: ${config.outputDir}/sessions/${session.id}/baseline.png`);\n          console.log(`  Current:  ${config.outputDir}/sessions/${session.id}/current.png`);\n          console.log(`  Diff:     ${config.outputDir}/sessions/${session.id}/diff.png`);\n        }\n      } catch {\n        // Ignore errors\n      }\n      return;\n    }\n\n    // Determine port: use specified, or find available starting from default\n    let port: number;\n    if (options.port) {\n      port = parseInt(options.port, 10);\n      // Check if specified port is available\n      if (!(await isPortAvailable(port))) {\n        console.log(`Port ${port} is already in use.`);\n        try {\n          port = await findAvailablePort(port + 1);\n          console.log(`Using next available port: ${port}`);\n        } catch (e) {\n          console.error(e instanceof Error ? e.message : 'Failed to find available port');\n          process.exit(1);\n        }\n      }\n    } else {\n      // Auto-find available port starting from default\n      try {\n        port = await findAvailablePort(IBR_DEFAULT_PORT);\n        if (port !== IBR_DEFAULT_PORT) {\n          console.log(`Default port ${IBR_DEFAULT_PORT} in use, using port ${port}`);\n        }\n      } catch (e) {\n        console.error(e instanceof Error ? e.message : 'Failed to find available port');\n        process.exit(1);\n      }\n    }\n\n    console.log(`Starting web UI on http://localhost:${port}`);\n    console.log('Press Ctrl+C to stop the server.');\n    console.log('');\n\n    // Start Next.js dev server\n    const server = spawn('npm', ['run', 'dev', '--', '-p', String(port)], {\n      cwd: webUiDir,\n      stdio: 'inherit',\n      shell: true,\n    });\n\n    // Open browser after a short delay (if --no-open not specified)\n    if (options.open !== false) {\n      setTimeout(async () => {\n        const open = (await import('child_process')).exec;\n        const url = `http://localhost:${port}`;\n        // Cross-platform open command\n        const cmd = process.platform === 'darwin' ? 'open' :\n                    process.platform === 'win32' ? 'start' : 'xdg-open';\n        open(`${cmd} ${url}`);\n      }, 3000);\n    }\n\n    // Handle server exit\n    server.on('close', (code) => {\n      if (code !== 0) {\n        console.log(`Web UI server exited with code ${code}`);\n      }\n    });\n  });\n\n// Login command - save auth state for authenticated captures\nprogram\n  .command('login <url>')\n  .description('Open browser for manual login, then save auth state for future captures')\n  .option('--timeout <ms>', 'Timeout in milliseconds (default: 5 minutes)', '300000')\n  .action(async (url: string, options: { timeout: string }) => {\n    try {\n      const { performLogin } = await import('../auth.js');\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n\n      await performLogin({\n        url,\n        outputDir,\n        timeout: parseInt(options.timeout, 10),\n      });\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Logout command - clear saved auth state\nprogram\n  .command('logout')\n  .description('Clear saved authentication state')\n  .action(async () => {\n    try {\n      const { clearAuthState } = await import('../auth.js');\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n\n      await clearAuthState(outputDir);\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// ============================================================\n// LIVE SESSION COMMANDS - Interactive browser sessions\n// ============================================================\n// Uses Browser Server mode for persistent sessions across CLI invocations.\n// The first session:start launches a headless browser server that persists\n// until session:close all is called.\n\n// Session start command - create interactive session with persistent browser\nprogram\n  .command('session:start [url]')\n  .description('Start an interactive browser session (browser persists across commands)')\n  .option('-n, --name <name>', 'Session name')\n  .option('-w, --wait-for <selector>', 'Wait for selector before considering page ready')\n  .option('--sandbox', 'Show visible browser window (default: headless)')\n  .option('--debug', 'Visible browser + slow motion + devtools')\n  .action(async (url: string | undefined, options: { name?: string; waitFor?: string; sandbox?: boolean; debug?: boolean }) => {\n    try {\n      const {\n        startBrowserServer,\n        isServerRunning,\n        PersistentSession,\n      } = await import('../browser-server.js');\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n      const resolvedUrl = await resolveBaseUrl(url);\n      const headless = !options.sandbox && !options.debug;\n\n      // Check if browser server is already running\n      const serverRunning = await isServerRunning(outputDir);\n\n      if (!serverRunning) {\n        // First session - launch browser server and keep process alive\n        console.log(headless ? 'Starting headless browser server...' : 'Starting visible browser server...');\n\n        const { server } = await startBrowserServer(outputDir, {\n          headless,\n          debug: options.debug,\n          isolated: true,  // Prevents conflicts with Playwright MCP\n        });\n\n        // Create the session\n        const session = await PersistentSession.create(outputDir, {\n          url: resolvedUrl,\n          name: options.name,\n          waitFor: options.waitFor,\n          viewport: VIEWPORTS[globalOpts.viewport as keyof typeof VIEWPORTS] || VIEWPORTS.desktop,\n        });\n\n        console.log('');\n        console.log(`Session started: ${session.id}`);\n        console.log(`URL: ${session.url}`);\n        console.log('');\n        console.log('Available commands (run in another terminal):');\n        console.log(`  npx ibr session:click ${session.id} \"<selector>\"`);\n        console.log(`  npx ibr session:type ${session.id} \"<selector>\" \"<text>\"`);\n        console.log(`  npx ibr session:screenshot ${session.id}`);\n        console.log(`  npx ibr session:wait ${session.id} \"<selector>\"`);\n        console.log('');\n        console.log('To close: npx ibr session:close all');\n        console.log('');\n        console.log('Browser server running. Press Ctrl+C to stop.');\n\n        // Keep process alive until SIGINT\n        await new Promise<void>((resolve) => {\n          const cleanup = async () => {\n            console.log('\\nShutting down browser server...');\n            server.close();\n            resolve();\n          };\n          process.on('SIGINT', cleanup);\n          process.on('SIGTERM', cleanup);\n        });\n      } else {\n        // Browser server already running - just create new session\n        console.log('Connecting to existing browser server...');\n\n        const session = await PersistentSession.create(outputDir, {\n          url: resolvedUrl,\n          name: options.name,\n          waitFor: options.waitFor,\n          viewport: VIEWPORTS[globalOpts.viewport as keyof typeof VIEWPORTS] || VIEWPORTS.desktop,\n        });\n\n        console.log('');\n        console.log(`Session started: ${session.id}`);\n        console.log(`URL: ${session.url}`);\n        console.log('');\n        console.log('Use session commands to interact:');\n        console.log(`  npx ibr session:type ${session.id} \"<selector>\" \"<text>\"`);\n        console.log(`  npx ibr session:click ${session.id} \"<selector>\"`);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Helper for session commands that need to connect\nasync function getSession(outputDir: string, sessionId: string) {\n  const { PersistentSession, isServerRunning } = await import('../browser-server.js');\n\n  if (!(await isServerRunning(outputDir))) {\n    console.error('No browser server running.');\n    console.log('');\n    console.log('Start one with:');\n    console.log('  npx ibr session:start <url>');\n    console.log('');\n    console.log('The first session:start launches the server and keeps it alive.');\n    console.log('Run session commands in a separate terminal.');\n    process.exit(1);\n  }\n\n  const session = await PersistentSession.get(outputDir, sessionId);\n  if (!session) {\n    console.error(`Session not found: ${sessionId}`);\n    console.log('');\n    console.log('This can happen if:');\n    console.log('  1. The session ID is incorrect');\n    console.log('  2. The session was created with a different browser server');\n    console.log('');\n    console.log('List sessions with: npx ibr session:list');\n    process.exit(1);\n  }\n\n  return session;\n}\n\n// Session click command\nprogram\n  .command('session:click <sessionId> <selector>')\n  .description('Click an element in an active session (auto-targets visible elements)')\n  .action(async (sessionId: string, selector: string) => {\n    try {\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n      const session = await getSession(outputDir, sessionId);\n\n      await session.click(selector);\n      console.log(`Clicked: ${selector}`);\n    } catch (error) {\n      const msg = error instanceof Error ? error.message : String(error);\n      console.error('Error:', msg);\n      console.log('');\n      if (msg.includes('not visible') || msg.includes('Timeout')) {\n        console.log('Tip: IBR auto-filters to visible elements. Element may be:');\n        console.log('     - Hidden by CSS (display:none, visibility:hidden)');\n        console.log('     - Off-screen or zero-sized');\n        console.log('     Use session:html --selector \"' + selector + '\" to inspect');\n      } else {\n        console.log('Tip: Session is still active. Use session:html to inspect the DOM.');\n      }\n    }\n  });\n\n// Session type command\nprogram\n  .command('session:type <sessionId> <selector> <text>')\n  .description('Type text into an element in an active session')\n  .option('--delay <ms>', 'Delay between keystrokes', '0')\n  .option('--submit', 'Press Enter after typing (waits for network idle)')\n  .option('--wait-after <ms>', 'Wait this long after typing/submitting before next command')\n  .action(async (sessionId: string, selector: string, text: string, options: { delay: string; submit?: boolean; waitAfter?: string }) => {\n    try {\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n      const session = await getSession(outputDir, sessionId);\n\n      await session.type(selector, text, {\n        delay: parseInt(options.delay, 10),\n        submit: options.submit,\n        waitAfter: options.waitAfter ? parseInt(options.waitAfter, 10) : undefined,\n      });\n\n      const action = options.submit ? 'Typed and submitted' : 'Typed';\n      console.log(`${action}: \"${text.length > 20 ? text.slice(0, 20) + '...' : text}\" into: ${selector}`);\n      if (options.submit) {\n        console.log('Waited for network idle after submit');\n      }\n    } catch (error) {\n      const msg = error instanceof Error ? error.message : String(error);\n      console.error('Error:', msg);\n      console.log('');\n      // Smart error suggestions\n      if (msg.includes('not visible') || msg.includes('multiple elements')) {\n        console.log('Tip: IBR auto-filters to visible elements. If still failing:');\n        console.log('     - Use session:html to inspect the DOM');\n        console.log('     - Try a more specific selector (add class, id, or attribute)');\n      } else {\n        console.log('Tip: Session is still active. Use session:html to inspect the page.');\n      }\n    }\n  });\n\n// Session screenshot command\nprogram\n  .command('session:screenshot <sessionId>')\n  .description('Take a screenshot and audit interactive elements')\n  .option('-n, --name <name>', 'Screenshot name')\n  .option('-s, --selector <css>', 'CSS selector to capture specific element')\n  .option('--no-full-page', 'Capture only the viewport')\n  .option('--json', 'Output audit results as JSON')\n  .action(async (sessionId: string, options: { name?: string; selector?: string; fullPage?: boolean; json?: boolean }) => {\n    try {\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n      const session = await getSession(outputDir, sessionId);\n\n      const { path, elements, audit } = await session.screenshot({\n        name: options.name,\n        selector: options.selector,\n        fullPage: options.fullPage,\n      });\n\n      if (options.json) {\n        console.log(JSON.stringify({ path, elements, audit }, null, 2));\n      } else {\n        console.log(`Screenshot saved: ${path}`);\n        console.log('');\n        console.log('Element Audit:');\n        console.log(`  Total elements: ${audit.totalElements}`);\n        console.log(`  Interactive: ${audit.interactiveCount}`);\n        console.log(`  With handlers: ${audit.withHandlers}`);\n        console.log(`  Without handlers: ${audit.withoutHandlers}`);\n\n        if (audit.issues.length > 0) {\n          console.log('');\n          console.log('Issues detected:');\n          for (const issue of audit.issues) {\n            const icon = issue.severity === 'error' ? '‚úó' : issue.severity === 'warning' ? '!' : 'i';\n            console.log(`  ${icon} [${issue.type}] ${issue.message}`);\n          }\n        } else {\n          console.log('');\n          console.log('No issues detected.');\n        }\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      console.log('');\n      console.log('Tip: Session is still active. Try without --selector for full page.');\n    }\n  });\n\n// Session wait command\nprogram\n  .command('session:wait <sessionId> <selectorOrMs>')\n  .description('Wait for a selector to appear or a duration (in ms)')\n  .action(async (sessionId: string, selectorOrMs: string) => {\n    try {\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n      const session = await getSession(outputDir, sessionId);\n\n      const isNumber = /^\\d+$/.test(selectorOrMs);\n      if (isNumber) {\n        await session.waitFor(parseInt(selectorOrMs, 10));\n        console.log(`Waited ${selectorOrMs}ms`);\n      } else {\n        await session.waitFor(selectorOrMs);\n        console.log(`Found: ${selectorOrMs}`);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      console.log('');\n      console.log('Tip: Session is still active. Element may not exist yet or selector is wrong.');\n    }\n  });\n\n// Session navigate command\nprogram\n  .command('session:navigate <sessionId> <url>')\n  .description('Navigate to a new URL in an active session')\n  .option('-w, --wait-for <selector>', 'Wait for selector after navigation')\n  .action(async (sessionId: string, url: string, options: { waitFor?: string }) => {\n    try {\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n      const session = await getSession(outputDir, sessionId);\n\n      await session.navigate(url, { waitFor: options.waitFor });\n      console.log(`Navigated to: ${url}`);\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      console.log('');\n      console.log('Tip: Session is still active. Check URL or try without --wait-for.');\n    }\n  });\n\n// Session list command\nprogram\n  .command('session:list')\n  .description('List all active interactive sessions')\n  .action(async () => {\n    try {\n      const { isServerRunning, listActiveSessions } = await import('../browser-server.js');\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n\n      const serverRunning = await isServerRunning(outputDir);\n      const sessions = await listActiveSessions(outputDir);\n\n      console.log(`Browser server: ${serverRunning ? 'running' : 'not running'}`);\n      console.log('');\n\n      if (sessions.length === 0) {\n        console.log('No sessions found.');\n        console.log('');\n        console.log('Start one with:');\n        console.log('  npx ibr session:start <url>');\n        return;\n      }\n\n      console.log('Sessions:');\n      for (const id of sessions) {\n        console.log(`  ${id}`);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Session close command\nprogram\n  .command('session:close <sessionId>')\n  .description('Close a session (use \"all\" to stop browser server)')\n  .action(async (sessionId: string) => {\n    try {\n      const { stopBrowserServer, PersistentSession, isServerRunning } = await import('../browser-server.js');\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n\n      if (sessionId === 'all') {\n        const stopped = await stopBrowserServer(outputDir);\n        if (stopped) {\n          console.log('Browser server stopped. All sessions closed.');\n        } else {\n          console.log('No browser server running.');\n        }\n        return;\n      }\n\n      // Close individual session\n      if (!(await isServerRunning(outputDir))) {\n        console.log('No browser server running.');\n        return;\n      }\n\n      const session = await PersistentSession.get(outputDir, sessionId);\n      if (session) {\n        await session.close();\n        console.log(`Session closed: ${sessionId}`);\n      } else {\n        console.log(`Session not found: ${sessionId}`);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Session HTML command - get page DOM\nprogram\n  .command('session:html <sessionId>')\n  .description('Get the full page HTML/DOM structure')\n  .option('-s, --selector <css>', 'Get HTML of specific element only')\n  .action(async (sessionId: string, options: { selector?: string }) => {\n    try {\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n      const session = await getSession(outputDir, sessionId);\n\n      if (options.selector) {\n        // Get outer HTML of specific element\n        const html = await session.evaluate((sel: string) => {\n          const el = document.querySelector(sel);\n          return el ? el.outerHTML : null;\n        });\n        if (html) {\n          console.log(html);\n        } else {\n          console.error(`Element not found: ${options.selector}`);\n          process.exit(1);\n        }\n      } else {\n        const html = await session.content();\n        console.log(html);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Session text command - get text content\nprogram\n  .command('session:text <sessionId> <selector>')\n  .description('Get text content from a specific element')\n  .option('-a, --all', 'Get text from all matching elements')\n  .action(async (sessionId: string, selector: string, options: { all?: boolean }) => {\n    try {\n      const globalOpts = program.opts();\n      const outputDir = globalOpts.output || './.ibr';\n      const session = await getSession(outputDir, sessionId);\n\n      if (options.all) {\n        const texts = await session.allTextContent(selector);\n        if (texts.length === 0) {\n          console.error(`No elements found: ${selector}`);\n          process.exit(1);\n        }\n        texts.forEach((text, i) => {\n          console.log(`[${i + 1}] ${text}`);\n        });\n      } else {\n        const text = await session.textContent(selector);\n        if (text === null) {\n          console.error(`Element not found: ${selector}`);\n          process.exit(1);\n        }\n        console.log(text.trim());\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Session actions command - show action history\nprogram\n  .command('session:actions <sessionId>')\n  .description('Show action history for a session')\n  .action(async (sessionId: string) => {\n    try {\n      const { liveSessionManager } = await import('../live-session.js');\n      const session = liveSessionManager.get(sessionId);\n\n      if (!session) {\n        console.error(`Session not found or not active: ${sessionId}`);\n        process.exit(1);\n      }\n\n      const actions = session.actions;\n      console.log(`Actions for ${sessionId}:`);\n      console.log('');\n\n      for (const action of actions) {\n        const icon = action.success ? '‚úì' : '‚úó';\n        const duration = action.duration ? `(${action.duration}ms)` : '';\n        console.log(`  ${icon} ${action.type} ${duration}`);\n        if (action.params) {\n          const params = Object.entries(action.params)\n            .map(([k, v]) => `${k}=${typeof v === 'string' ? v : JSON.stringify(v)}`)\n            .join(', ');\n          console.log(`      ${params}`);\n        }\n        if (!action.success && action.error) {\n          console.log(`      Error: ${action.error}`);\n        }\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Scan command - discover and test multiple pages\nprogram\n  .command('scan [url]')\n  .description('Discover pages (auto-detects dev server if no URL)')\n  .option('-n, --max-pages <count>', 'Maximum pages to discover', '5')\n  .option('-p, --prefix <path>', 'Only scan pages under this path prefix')\n  .option('--nav-only', 'Only scan navigation links (faster)')\n  .option('-f, --format <format>', 'Output format: json, text', 'text')\n  .action(async (url: string | undefined, options: { maxPages: string; prefix?: string; navOnly?: boolean; format: string }) => {\n    try {\n      const resolvedUrl = await resolveBaseUrl(url);\n      const { discoverPages, getNavigationLinks } = await import('../crawl.js');\n\n      console.log(`Scanning ${resolvedUrl}...`);\n      console.log('');\n\n      let pages;\n\n      if (options.navOnly) {\n        // Quick nav-only scan\n        pages = await getNavigationLinks(resolvedUrl);\n        console.log(`Found ${pages.length} navigation links:`);\n      } else {\n        // Full crawl\n        const result = await discoverPages({\n          url: resolvedUrl,\n          maxPages: parseInt(options.maxPages, 10),\n          pathPrefix: options.prefix,\n        });\n        pages = result.pages;\n        console.log(`Discovered ${pages.length} pages (${result.crawlTime}ms):`);\n      }\n\n      console.log('');\n\n      if (options.format === 'json') {\n        console.log(JSON.stringify(pages, null, 2));\n      } else {\n        for (const page of pages) {\n          console.log(`  ${page.path}`);\n          console.log(`    Title: ${page.title}`);\n          if (page.linkText && page.linkText !== page.title) {\n            console.log(`    Link: ${page.linkText}`);\n          }\n          console.log('');\n        }\n      }\n\n      // Contextual tip\n      console.log('To capture baselines for these pages:');\n      console.log(`  npx ibr scan-start`);\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Scan-start command - discover and capture baselines for multiple pages\nprogram\n  .command('scan-start [url]')\n  .description('Discover pages and capture baselines (auto-detects dev server if no URL)')\n  .option('-n, --max-pages <count>', 'Maximum pages to discover', '5')\n  .option('-p, --prefix <path>', 'Only scan pages under this path prefix')\n  .option('--nav-only', 'Only scan navigation links (faster)')\n  .action(async (url: string | undefined, options: { maxPages: string; prefix?: string; navOnly?: boolean }) => {\n    try {\n      const resolvedUrl = await resolveBaseUrl(url);\n      const { discoverPages, getNavigationLinks } = await import('../crawl.js');\n      const ibr = await createIBR(program.opts());\n\n      console.log(`Scanning ${resolvedUrl}...`);\n\n      let pages;\n\n      if (options.navOnly) {\n        pages = await getNavigationLinks(resolvedUrl);\n      } else {\n        const result = await discoverPages({\n          url: resolvedUrl,\n          maxPages: parseInt(options.maxPages, 10),\n          pathPrefix: options.prefix,\n        });\n        pages = result.pages;\n      }\n\n      console.log(`Found ${pages.length} pages. Capturing baselines...`);\n      console.log('');\n\n      const sessions = [];\n\n      for (const page of pages) {\n        try {\n          console.log(`Capturing: ${page.path}`);\n          const result = await ibr.startSession(page.url, {\n            name: page.title.replace(/[^a-zA-Z0-9-_]/g, '-').toLowerCase().slice(0, 50),\n          });\n          sessions.push({ page, sessionId: result.sessionId });\n          console.log(`  Done: ${result.sessionId}`);\n        } catch (error) {\n          console.log(`  Failed: ${error instanceof Error ? error.message : error}`);\n        }\n      }\n\n      console.log('');\n      console.log(`Captured ${sessions.length}/${pages.length} pages.`);\n      console.log('');\n      console.log('Next: Make your changes, then run:');\n      console.log('  npx ibr scan-check');\n\n      await ibr.close();\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Scan-check command - compare all recent sessions\nprogram\n  .command('scan-check')\n  .description('Compare all sessions from the last scan-start')\n  .option('-f, --format <format>', 'Output format: json, text, minimal', 'text')\n  .action(async (options: { format: string }) => {\n    try {\n      const ibr = await createIBR(program.opts());\n      const sessions = await ibr.listSessions();\n\n      // Get sessions from the last hour (likely from same scan)\n      const recentSessions = sessions.filter(s => {\n        const age = Date.now() - new Date(s.createdAt).getTime();\n        return age < 60 * 60 * 1000 && s.status === 'baseline';\n      });\n\n      if (recentSessions.length === 0) {\n        console.log('No recent baseline sessions found. Run scan-start first.');\n        return;\n      }\n\n      console.log(`Checking ${recentSessions.length} sessions...`);\n      console.log('');\n\n      const results = [];\n\n      for (const session of recentSessions) {\n        try {\n          console.log(`Checking: ${session.name}`);\n          const report = await ibr.check(session.id);\n          results.push({ session, report });\n\n          const icon = report.analysis.verdict === 'MATCH' ? '‚úì' :\n                       report.analysis.verdict === 'EXPECTED_CHANGE' ? '~' :\n                       report.analysis.verdict === 'UNEXPECTED_CHANGE' ? '!' : '‚úó';\n          console.log(`  ${icon} ${report.analysis.verdict}: ${report.analysis.summary}`);\n        } catch (error) {\n          console.log(`  ‚úó Failed: ${error instanceof Error ? error.message : error}`);\n        }\n      }\n\n      console.log('');\n\n      // Summary\n      const matches = results.filter(r => r.report.analysis.verdict === 'MATCH').length;\n      const expected = results.filter(r => r.report.analysis.verdict === 'EXPECTED_CHANGE').length;\n      const unexpected = results.filter(r => r.report.analysis.verdict === 'UNEXPECTED_CHANGE').length;\n      const broken = results.filter(r => r.report.analysis.verdict === 'LAYOUT_BROKEN').length;\n\n      console.log('Summary:');\n      console.log(`  ‚úì Match: ${matches}`);\n      console.log(`  ~ Expected: ${expected}`);\n      console.log(`  ! Unexpected: ${unexpected}`);\n      console.log(`  ‚úó Broken: ${broken}`);\n\n      if (unexpected > 0 || broken > 0) {\n        console.log('');\n        console.log('Issues detected. View in UI:');\n        console.log('  npx ibr serve');\n      }\n\n      await ibr.close();\n\n      // Exit with error if issues\n      if (broken > 0) process.exit(1);\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Consistency check command - compare UI consistency across pages\nprogram\n  .command('consistency <url>')\n  .description('Check UI consistency across multiple pages (opt-in)')\n  .option('-n, --max-pages <count>', 'Maximum pages to check', '5')\n  .option('--nav-only', 'Only check navigation links (faster)')\n  .option('--ignore <types>', 'Ignore certain checks (layout,typography,color,spacing)', '')\n  .option('-f, --format <format>', 'Output format: json, text', 'text')\n  .option('--confirm', 'Skip confirmation prompt (for automation/Claude Code)')\n  .action(async (url: string, options: {\n    maxPages: string;\n    navOnly?: boolean;\n    ignore: string;\n    format: string;\n    confirm?: boolean;\n  }) => {\n    try {\n      // Permission check - require explicit confirmation unless --confirm flag\n      if (!options.confirm) {\n        console.log('');\n        console.log('‚ö†Ô∏è  Consistency Check');\n        console.log('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ');\n        console.log('This will analyze UI styles across multiple pages to');\n        console.log('detect potential inconsistencies (fonts, colors, spacing).');\n        console.log('');\n        console.log('Note: Some style differences may be intentional.');\n        console.log('');\n        console.log('To proceed, run with --confirm flag:');\n        console.log(`  npx ibr consistency ${url} --confirm`);\n        console.log('');\n        console.log('Or for Claude Code automation:');\n        console.log(`  npx ibr consistency ${url} --confirm --format json`);\n        return;\n      }\n\n      const { discoverPages, getNavigationLinks } = await import('../crawl.js');\n      const { checkConsistency, formatConsistencyReport } = await import('../consistency.js');\n\n      console.log(`Discovering pages from ${url}...`);\n\n      let pages;\n      if (options.navOnly) {\n        pages = await getNavigationLinks(url);\n      } else {\n        const result = await discoverPages({\n          url,\n          maxPages: parseInt(options.maxPages, 10),\n        });\n        pages = result.pages;\n      }\n\n      if (pages.length < 2) {\n        console.log('Need at least 2 pages to check consistency.');\n        return;\n      }\n\n      console.log(`Found ${pages.length} pages. Analyzing styles...`);\n      console.log('');\n\n      const urls = pages.map(p => p.url);\n      const ignore = options.ignore ? options.ignore.split(',') as Array<'layout' | 'typography' | 'color' | 'spacing'> : [];\n\n      const result = await checkConsistency({\n        urls,\n        ignore,\n      });\n\n      if (options.format === 'json') {\n        console.log(JSON.stringify(result, null, 2));\n      } else {\n        console.log(formatConsistencyReport(result));\n      }\n\n      // Exit with error if score is low\n      if (result.score < 50) {\n        process.exit(1);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Diagnose command - enhanced error diagnostics for a URL\nprogram\n  .command('diagnose [url]')\n  .description('Diagnose page load issues (auto-detects dev server if no URL)')\n  .option('--timeout <ms>', 'Timeout in milliseconds', '30000')\n  .action(async (url: string | undefined, options: { timeout: string }) => {\n    try {\n      const resolvedUrl = await resolveBaseUrl(url);\n      const { captureWithDiagnostics, closeBrowser } = await import('../capture.js');\n      const { join } = await import('path');\n      const outputDir = program.opts().output || './.ibr';\n\n      console.log(`Diagnosing ${resolvedUrl}...`);\n      console.log('');\n\n      const result = await captureWithDiagnostics({\n        url: resolvedUrl,\n        outputPath: join(outputDir, 'diagnose', 'test.png'),\n        timeout: parseInt(options.timeout, 10),\n        outputDir,\n      });\n\n      await closeBrowser();\n\n      console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\n      console.log('  PAGE DIAGNOSTICS');\n      console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\n      console.log('');\n\n      if (result.success) {\n        console.log('‚úì Page loaded successfully');\n        console.log('');\n      } else {\n        console.log('‚úó Page failed to load');\n        console.log(`  Error: ${result.error?.message}`);\n        console.log(`  Suggestion: ${result.error?.suggestion}`);\n        console.log('');\n      }\n\n      console.log('Timing:');\n      console.log(`  Navigation: ${result.timing.navigationMs}ms`);\n      console.log(`  Render: ${result.timing.renderMs}ms`);\n      console.log(`  Total: ${result.timing.totalMs}ms`);\n      console.log('');\n\n      if (result.diagnostics.httpStatus) {\n        console.log(`HTTP Status: ${result.diagnostics.httpStatus}`);\n      }\n\n      if (result.diagnostics.consoleErrors.length > 0) {\n        console.log('');\n        console.log('Console Errors:');\n        for (const err of result.diagnostics.consoleErrors.slice(0, 5)) {\n          console.log(`  ‚Ä¢ ${err.substring(0, 100)}${err.length > 100 ? '...' : ''}`);\n        }\n        if (result.diagnostics.consoleErrors.length > 5) {\n          console.log(`  ... and ${result.diagnostics.consoleErrors.length - 5} more`);\n        }\n      }\n\n      if (result.diagnostics.networkErrors.length > 0) {\n        console.log('');\n        console.log('Network Errors:');\n        for (const err of result.diagnostics.networkErrors.slice(0, 5)) {\n          console.log(`  ‚Ä¢ ${err.substring(0, 100)}${err.length > 100 ? '...' : ''}`);\n        }\n        if (result.diagnostics.networkErrors.length > 5) {\n          console.log(`  ... and ${result.diagnostics.networkErrors.length - 5} more`);\n        }\n      }\n\n      if (result.diagnostics.suggestions.length > 0) {\n        console.log('');\n        console.log('Suggestions:');\n        for (const suggestion of result.diagnostics.suggestions) {\n          console.log(`  ‚Üí ${suggestion}`);\n        }\n      }\n\n      if (!result.success) {\n        process.exit(1);\n      }\n    } catch (error) {\n      console.error('Error:', error instanceof Error ? error.message : error);\n      process.exit(1);\n    }\n  });\n\n// Helper to check if port is in use\nasync function isPortInUse(port: number): Promise<boolean> {\n  return new Promise((resolve) => {\n    const net = require('net');\n    const server = net.createServer();\n    server.once('error', () => resolve(true));\n    server.once('listening', () => {\n      server.close();\n      resolve(false);\n    });\n    server.listen(port, '127.0.0.1');\n  });\n}\n\n// Find available port from list\nasync function findAvailablePortFromList(ports: number[]): Promise<number | null> {\n  for (const port of ports) {\n    if (!(await isPortInUse(port))) {\n      return port;\n    }\n  }\n  return null;\n}\n\n// Common dev server ports (ordered by likelihood)\nconst DEV_SERVER_PORTS = [3000, 3001, 5173, 5174, 4200, 8080, 8000, 5000, 3100, 4321];\n\n// Detect running dev server by checking common ports\nasync function detectDevServer(): Promise<string | null> {\n  for (const port of DEV_SERVER_PORTS) {\n    if (await isPortInUse(port)) {\n      // Verify it responds to HTTP\n      try {\n        const controller = new AbortController();\n        const timeout = setTimeout(() => controller.abort(), 1000);\n        await fetch(`http://localhost:${port}`, {\n          signal: controller.signal,\n          method: 'HEAD'\n        });\n        clearTimeout(timeout);\n        return `http://localhost:${port}`;\n      } catch {\n        // Port in use but not HTTP, try next\n        continue;\n      }\n    }\n  }\n  return null;\n}\n\n// Resolve URL: use provided, or from config, or auto-detect\nasync function resolveBaseUrl(providedUrl?: string): Promise<string> {\n  if (providedUrl) {\n    return providedUrl;\n  }\n\n  const config = await loadConfig();\n  if (config.baseUrl) {\n    return config.baseUrl;\n  }\n\n  const detected = await detectDevServer();\n  if (detected) {\n    console.log(`Auto-detected dev server: ${detected}`);\n    return detected;\n  }\n\n  throw new Error('No URL provided and no dev server detected. Start your dev server or specify a URL.');\n}\n\n// Init command\nprogram\n  .command('init')\n  .description('Initialize .ibrrc.json configuration file')\n  .option('-p, --port <port>', 'Port for baseUrl (auto-detects available port if not specified)')\n  .option('-u, --url <url>', 'Full base URL (overrides port)')\n  .action(async (options: { port?: string; url?: string }) => {\n    const configPath = join(process.cwd(), '.ibrrc.json');\n\n    if (existsSync(configPath)) {\n      console.log('.ibrrc.json already exists.');\n      console.log('Edit it directly or delete and run init again.');\n      return;\n    }\n\n    let baseUrl: string;\n\n    if (options.url) {\n      // User specified full URL\n      baseUrl = options.url;\n    } else if (options.port) {\n      // User specified port\n      baseUrl = `http://localhost:${options.port}`;\n    } else {\n      // Try port 5000 first, then auto-detect from alternatives\n      const preferredPort = 5000;\n      const fallbackPorts = [5050, 5555, 4200, 4321, 6789, 7777];\n\n      if (!(await isPortInUse(preferredPort))) {\n        baseUrl = `http://localhost:${preferredPort}`;\n        console.log(`Using default port ${preferredPort}`);\n      } else {\n        console.log(`Port ${preferredPort} in use, finding alternative...`);\n        const availablePort = await findAvailablePortFromList(fallbackPorts);\n\n        if (availablePort) {\n          baseUrl = `http://localhost:${availablePort}`;\n          console.log(`Auto-selected port ${availablePort}`);\n        } else {\n          baseUrl = 'http://localhost:YOUR_PORT';\n          console.log('All candidate ports in use. Please edit baseUrl in .ibrrc.json');\n        }\n      }\n    }\n\n    const config = {\n      baseUrl,\n      outputDir: './.ibr',\n      viewport: 'desktop',\n      threshold: 1.0,\n      fullPage: true,\n    };\n\n    const { writeFile } = await import('fs/promises');\n    await writeFile(configPath, JSON.stringify(config, null, 2));\n\n    console.log('');\n    console.log('Created .ibrrc.json');\n    console.log('');\n    console.log('Configuration:');\n    console.log(JSON.stringify(config, null, 2));\n    console.log('');\n    console.log('Edit baseUrl to match your dev server.');\n  });\n\nprogram.parse();\n","import { ConfigSchema, VIEWPORTS, type Config, type Session, type SessionQuery, type ComparisonReport } from './schemas.js';\nimport { captureScreenshot, closeBrowser } from './capture.js';\nimport { compareImages, analyzeComparison } from './compare.js';\nimport {\n  createSession,\n  getSession,\n  updateSession,\n  markSessionCompared,\n  listSessions,\n  getMostRecentSession,\n  deleteSession,\n  cleanSessions,\n  getSessionPaths,\n  findSessions,\n  getTimeline,\n  getSessionsByRoute,\n  getSessionStats,\n} from './session.js';\nimport { generateReport } from './report.js';\nimport type { StartSessionOptions, StartSessionResult, CleanOptions } from './types.js';\n\nexport class InterfaceBuiltRight {\n  private config: Config;\n\n  constructor(options: Partial<Config> = {}) {\n    // Validate and merge with defaults\n    this.config = ConfigSchema.parse(options);\n  }\n\n  /**\n   * Start a visual session by capturing a baseline screenshot\n   */\n  async startSession(path: string, options: StartSessionOptions = {}): Promise<StartSessionResult> {\n    const {\n      name = this.generateSessionName(path),\n      viewport = this.config.viewport,\n      fullPage = this.config.fullPage,\n      selector,\n      waitFor,\n    } = options;\n\n    const url = this.resolveUrl(path);\n\n    // Create session\n    const session = await createSession(this.config.outputDir, url, name, viewport);\n    const paths = getSessionPaths(this.config.outputDir, session.id);\n\n    // Capture baseline (outputDir enables auth state loading)\n    await captureScreenshot({\n      url,\n      outputPath: paths.baseline,\n      viewport,\n      fullPage,\n      waitForNetworkIdle: this.config.waitForNetworkIdle,\n      timeout: this.config.timeout,\n      outputDir: this.config.outputDir,\n      selector,\n      waitFor,\n    });\n\n    return {\n      sessionId: session.id,\n      baseline: paths.baseline,\n      session,\n    };\n  }\n\n  /**\n   * Check current state against baseline\n   */\n  async check(sessionId?: string): Promise<ComparisonReport> {\n    // Get session\n    const session = sessionId\n      ? await getSession(this.config.outputDir, sessionId)\n      : await getMostRecentSession(this.config.outputDir);\n\n    if (!session) {\n      throw new Error(sessionId\n        ? `Session not found: ${sessionId}`\n        : 'No sessions found. Run startSession first.');\n    }\n\n    const paths = getSessionPaths(this.config.outputDir, session.id);\n\n    // Capture current screenshot (outputDir enables auth state loading)\n    await captureScreenshot({\n      url: session.url,\n      outputPath: paths.current,\n      viewport: session.viewport,\n      fullPage: this.config.fullPage,\n      waitForNetworkIdle: this.config.waitForNetworkIdle,\n      timeout: this.config.timeout,\n      outputDir: this.config.outputDir,\n    });\n\n    // Compare images\n    const comparison = await compareImages({\n      baselinePath: paths.baseline,\n      currentPath: paths.current,\n      diffPath: paths.diff,\n      threshold: this.config.threshold / 100, // Convert percentage to 0-1 range for pixelmatch\n    });\n\n    // Analyze results\n    const analysis = analyzeComparison(comparison, this.config.threshold);\n\n    // Update session\n    await markSessionCompared(this.config.outputDir, session.id, comparison, analysis);\n\n    // Generate report\n    return generateReport(session, comparison, analysis, this.config.outputDir);\n  }\n\n  /**\n   * Get a session by ID\n   */\n  async getSession(sessionId: string): Promise<Session | null> {\n    return getSession(this.config.outputDir, sessionId);\n  }\n\n  /**\n   * Get the most recent session\n   */\n  async getMostRecentSession(): Promise<Session | null> {\n    return getMostRecentSession(this.config.outputDir);\n  }\n\n  /**\n   * List all sessions\n   */\n  async listSessions(): Promise<Session[]> {\n    return listSessions(this.config.outputDir);\n  }\n\n  /**\n   * Delete a session\n   */\n  async deleteSession(sessionId: string): Promise<boolean> {\n    return deleteSession(this.config.outputDir, sessionId);\n  }\n\n  /**\n   * Clean old sessions\n   */\n  async clean(options: CleanOptions = {}): Promise<{ deleted: string[]; kept: string[] }> {\n    return cleanSessions(this.config.outputDir, options);\n  }\n\n  /**\n   * Find sessions matching query criteria\n   */\n  async find(query: Partial<SessionQuery> = {}): Promise<Session[]> {\n    return findSessions(this.config.outputDir, query);\n  }\n\n  /**\n   * Get timeline of sessions for a specific route\n   * Returns sessions in chronological order (oldest first)\n   */\n  async getTimeline(route: string, limit: number = 10): Promise<Session[]> {\n    return getTimeline(this.config.outputDir, route, limit);\n  }\n\n  /**\n   * Get sessions grouped by route\n   */\n  async getSessionsByRoute(): Promise<Record<string, Session[]>> {\n    return getSessionsByRoute(this.config.outputDir);\n  }\n\n  /**\n   * Get session statistics\n   */\n  async getStats(): Promise<{\n    total: number;\n    byStatus: Record<string, number>;\n    byViewport: Record<string, number>;\n    byVerdict: Record<string, number>;\n  }> {\n    return getSessionStats(this.config.outputDir);\n  }\n\n  /**\n   * Update baseline with current screenshot\n   */\n  async updateBaseline(sessionId?: string): Promise<Session> {\n    const session = sessionId\n      ? await getSession(this.config.outputDir, sessionId)\n      : await getMostRecentSession(this.config.outputDir);\n\n    if (!session) {\n      throw new Error(sessionId\n        ? `Session not found: ${sessionId}`\n        : 'No sessions found.');\n    }\n\n    const paths = getSessionPaths(this.config.outputDir, session.id);\n\n    // Capture new baseline (outputDir enables auth state loading)\n    await captureScreenshot({\n      url: session.url,\n      outputPath: paths.baseline,\n      viewport: session.viewport,\n      fullPage: this.config.fullPage,\n      waitForNetworkIdle: this.config.waitForNetworkIdle,\n      timeout: this.config.timeout,\n      outputDir: this.config.outputDir,\n    });\n\n    // Reset session status\n    return updateSession(this.config.outputDir, session.id, {\n      status: 'baseline',\n      comparison: undefined,\n      analysis: undefined,\n    });\n  }\n\n  /**\n   * Close the browser instance\n   */\n  async close(): Promise<void> {\n    await closeBrowser();\n  }\n\n  /**\n   * Get configuration\n   */\n  getConfig(): Config {\n    return { ...this.config };\n  }\n\n  /**\n   * Resolve a path to full URL\n   */\n  private resolveUrl(path: string): string {\n    if (path.startsWith('http://') || path.startsWith('https://')) {\n      return path;\n    }\n    return `${this.config.baseUrl}${path.startsWith('/') ? path : `/${path}`}`;\n  }\n\n  /**\n   * Generate a session name from path\n   */\n  private generateSessionName(path: string): string {\n    // Remove leading slash and replace remaining slashes with dashes\n    return path\n      .replace(/^\\/+/, '')\n      .replace(/\\//g, '-')\n      .replace(/[^a-zA-Z0-9-_]/g, '')\n      || 'homepage';\n  }\n}\n\n// Export everything for programmatic use\nexport * from './schemas.js';\nexport * from './types.js';\nexport { captureScreenshot, closeBrowser, getViewport, captureWithDiagnostics } from './capture.js';\nexport type { CaptureResult } from './capture.js';\nexport { checkConsistency, formatConsistencyReport } from './consistency.js';\nexport type { ConsistencyOptions, ConsistencyResult, PageMetrics, Inconsistency } from './consistency.js';\nexport { compareImages, analyzeComparison, getVerdictDescription, detectChangedRegions } from './compare.js';\nexport { discoverPages, getNavigationLinks } from './crawl.js';\nexport type { CrawlOptions, CrawlResult, DiscoveredPage } from './crawl.js';\nexport {\n  createSession,\n  getSession,\n  updateSession,\n  markSessionCompared,\n  listSessions,\n  getMostRecentSession,\n  deleteSession,\n  cleanSessions,\n  getSessionPaths,\n  generateSessionId,\n  findSessions,\n  getTimeline,\n  getSessionsByRoute,\n  getSessionStats,\n} from './session.js';\nexport { generateReport, formatReportText, formatReportJson, formatReportMinimal, formatSessionSummary } from './report.js';\nexport {\n  extractApiCalls,\n  scanDirectoryForApiCalls,\n  discoverApiRoutes,\n  filePathToRoute,\n  findOrphanEndpoints,\n  groupByEndpoint,\n  groupByFile,\n  filterByMethod,\n  filterByEndpoint,\n} from './integration.js';\nexport type { ApiCall, ApiRoute } from './integration.js';\nexport { VIEWPORTS };\n","import pixelmatch from 'pixelmatch';\nimport { PNG } from 'pngjs';\nimport { readFile, writeFile, mkdir } from 'fs/promises';\nimport { dirname } from 'path';\nimport type { CompareOptions } from './types.js';\nimport type { ComparisonResult, Analysis, ChangedRegion, Verdict } from './schemas.js';\n\n/**\n * Region detection configuration\n * Divides page into semantic regions based on common layout patterns\n */\ninterface RegionConfig {\n  name: string;\n  location: 'top' | 'bottom' | 'left' | 'right' | 'center' | 'full';\n  // Percentages of page dimensions\n  xStart: number;  // 0-1\n  xEnd: number;    // 0-1\n  yStart: number;  // 0-1\n  yEnd: number;    // 0-1\n}\n\n/**\n * Default regions based on common web layouts\n * Header (top 10%), Footer (bottom 10%), Left sidebar (left 20%), Content (center)\n */\nconst DEFAULT_REGIONS: RegionConfig[] = [\n  { name: 'header', location: 'top', xStart: 0, xEnd: 1, yStart: 0, yEnd: 0.1 },\n  { name: 'navigation', location: 'left', xStart: 0, xEnd: 0.2, yStart: 0.1, yEnd: 0.9 },\n  { name: 'content', location: 'center', xStart: 0.2, xEnd: 1, yStart: 0.1, yEnd: 0.9 },\n  { name: 'footer', location: 'bottom', xStart: 0, xEnd: 1, yStart: 0.9, yEnd: 1 },\n];\n\n/**\n * Analyze diff image to detect which regions have changes\n */\nexport function detectChangedRegions(\n  diffData: Uint8Array,\n  width: number,\n  height: number,\n  regions: RegionConfig[] = DEFAULT_REGIONS\n): ChangedRegion[] {\n  const changedRegions: ChangedRegion[] = [];\n\n  for (const region of regions) {\n    // Calculate pixel bounds\n    const xStart = Math.floor(region.xStart * width);\n    const xEnd = Math.floor(region.xEnd * width);\n    const yStart = Math.floor(region.yStart * height);\n    const yEnd = Math.floor(region.yEnd * height);\n\n    const regionWidth = xEnd - xStart;\n    const regionHeight = yEnd - yStart;\n    const regionPixels = regionWidth * regionHeight;\n\n    if (regionPixels === 0) continue;\n\n    // Count red pixels (diff color) in this region\n    let diffPixels = 0;\n\n    for (let y = yStart; y < yEnd; y++) {\n      for (let x = xStart; x < xEnd; x++) {\n        const idx = (y * width + x) * 4;\n        // Check if pixel is red (diff marker from pixelmatch)\n        // pixelmatch uses [255, 0, 0] for differences\n        if (diffData[idx] === 255 && diffData[idx + 1] === 0 && diffData[idx + 2] === 0) {\n          diffPixels++;\n        }\n      }\n    }\n\n    const diffPercent = (diffPixels / regionPixels) * 100;\n\n    // Only report regions with >0.1% changes\n    if (diffPercent > 0.1) {\n      const severity = diffPercent > 30 ? 'critical' :\n                       diffPercent > 10 ? 'unexpected' : 'expected';\n\n      changedRegions.push({\n        location: region.location,\n        bounds: {\n          x: xStart,\n          y: yStart,\n          width: regionWidth,\n          height: regionHeight,\n        },\n        description: `${region.name}: ${diffPercent.toFixed(1)}% changed`,\n        severity,\n      });\n    }\n  }\n\n  // Sort by severity (critical first) then by diff percentage\n  return changedRegions.sort((a, b) => {\n    const severityOrder = { critical: 0, unexpected: 1, expected: 2 };\n    const aSev = severityOrder[a.severity];\n    const bSev = severityOrder[b.severity];\n    if (aSev !== bSev) return aSev - bSev;\n\n    // Parse percentage from description for secondary sort\n    const aPercent = parseFloat(a.description.match(/(\\d+\\.?\\d*)%/)?.[1] || '0');\n    const bPercent = parseFloat(b.description.match(/(\\d+\\.?\\d*)%/)?.[1] || '0');\n    return bPercent - aPercent;\n  });\n}\n\n/**\n * Extended comparison result with diff image data for regional analysis\n */\nexport interface ExtendedComparisonResult extends ComparisonResult {\n  diffData?: Uint8Array;\n  width?: number;\n  height?: number;\n}\n\n/**\n * Compare two images using pixelmatch\n */\nexport async function compareImages(options: CompareOptions): Promise<ExtendedComparisonResult> {\n  const {\n    baselinePath,\n    currentPath,\n    diffPath,\n    threshold = 0.1, // pixelmatch threshold (0-1), lower = stricter\n  } = options;\n\n  // Read images\n  const [baselineBuffer, currentBuffer] = await Promise.all([\n    readFile(baselinePath),\n    readFile(currentPath),\n  ]);\n\n  const baseline = PNG.sync.read(baselineBuffer);\n  const current = PNG.sync.read(currentBuffer);\n\n  // Ensure images have same dimensions\n  if (baseline.width !== current.width || baseline.height !== current.height) {\n    throw new Error(\n      `Image dimensions mismatch: baseline (${baseline.width}x${baseline.height}) vs current (${current.width}x${current.height})`\n    );\n  }\n\n  const { width, height } = baseline;\n  const diff = new PNG({ width, height });\n  const totalPixels = width * height;\n\n  // Run pixelmatch\n  const diffPixels = pixelmatch(\n    baseline.data,\n    current.data,\n    diff.data,\n    width,\n    height,\n    {\n      threshold,\n      includeAA: false, // Ignore anti-aliasing differences\n      alpha: 0.1,\n      diffColor: [255, 0, 0], // Red for differences\n      diffColorAlt: [0, 255, 0], // Green for anti-aliased differences\n    }\n  );\n\n  // Ensure output directory exists\n  await mkdir(dirname(diffPath), { recursive: true });\n\n  // Write diff image\n  await writeFile(diffPath, PNG.sync.write(diff));\n\n  const diffPercent = (diffPixels / totalPixels) * 100;\n\n  return {\n    match: diffPixels === 0,\n    diffPercent: Math.round(diffPercent * 100) / 100, // Round to 2 decimal places\n    diffPixels,\n    totalPixels,\n    threshold,\n    // Include diff data for regional analysis\n    diffData: diff.data,\n    width,\n    height,\n  };\n}\n\n/**\n * Analyze comparison result and generate verdict with regional analysis\n */\nexport function analyzeComparison(\n  result: ExtendedComparisonResult,\n  thresholdPercent: number = 1.0\n): Analysis {\n  const { match, diffPercent, diffData, width, height } = result;\n\n  // Detect changed regions if diff data is available\n  let detectedRegions: ChangedRegion[] = [];\n  if (diffData && width && height && !match) {\n    detectedRegions = detectChangedRegions(diffData, width, height);\n  }\n\n  // Analyze regions for verdict determination\n  const criticalRegions = detectedRegions.filter(r => r.severity === 'critical');\n  const unexpectedRegions = detectedRegions.filter(r => r.severity === 'unexpected');\n  const hasNavigationChanges = detectedRegions.some(r =>\n    r.description.toLowerCase().includes('navigation') ||\n    r.description.toLowerCase().includes('header')\n  );\n\n  // Determine verdict based on regions and overall diff\n  let verdict: Verdict;\n  let summary: string;\n  let recommendation: string | null = null;\n\n  if (match || diffPercent === 0) {\n    verdict = 'MATCH';\n    summary = 'No visual changes detected. Screenshots are identical.';\n  } else if (criticalRegions.length > 0) {\n    verdict = 'LAYOUT_BROKEN';\n    const regionNames = criticalRegions.map(r =>\n      r.description.split(':')[0]\n    ).join(', ');\n    summary = `Critical changes in: ${regionNames}. Layout may be broken.`;\n    recommendation = `Major changes detected in ${regionNames}. Check for missing elements, broken layout, or loading errors.`;\n  } else if (unexpectedRegions.length > 0 || diffPercent > 20) {\n    verdict = 'UNEXPECTED_CHANGE';\n    const regionNames = unexpectedRegions.length > 0\n      ? unexpectedRegions.map(r => r.description.split(':')[0]).join(', ')\n      : 'multiple areas';\n    summary = `Significant changes in: ${regionNames} (${diffPercent}% overall).`;\n    recommendation = hasNavigationChanges\n      ? 'Navigation area changed - verify menu items and links are correct.'\n      : 'Review changes carefully - some may be unintentional.';\n  } else if (diffPercent <= thresholdPercent) {\n    verdict = 'EXPECTED_CHANGE';\n    summary = `Minor changes detected (${diffPercent}%). Within acceptable threshold.`;\n  } else {\n    verdict = 'EXPECTED_CHANGE';\n    const regionNames = detectedRegions.length > 0\n      ? detectedRegions.map(r => r.description.split(':')[0]).join(', ')\n      : 'content area';\n    summary = `Changes in: ${regionNames} (${diffPercent}% overall). Changes appear intentional.`;\n  }\n\n  // Separate expected vs unexpected changes\n  const changedRegions = detectedRegions.filter(r => r.severity === 'expected');\n  const unexpectedChanges = detectedRegions.filter(r =>\n    r.severity === 'unexpected' || r.severity === 'critical'\n  );\n\n  // If no regions detected but there are changes, create a fallback region\n  if (detectedRegions.length === 0 && !match) {\n    const fallbackRegion: ChangedRegion = {\n      location: diffPercent > 50 ? 'full' : 'center',\n      bounds: { x: 0, y: 0, width: width || 0, height: height || 0 },\n      description: `overall: ${diffPercent}% changed`,\n      severity: verdict === 'LAYOUT_BROKEN' ? 'critical' :\n                verdict === 'UNEXPECTED_CHANGE' ? 'unexpected' : 'expected',\n    };\n\n    if (verdict === 'UNEXPECTED_CHANGE' || verdict === 'LAYOUT_BROKEN') {\n      unexpectedChanges.push(fallbackRegion);\n    } else {\n      changedRegions.push(fallbackRegion);\n    }\n  }\n\n  return {\n    verdict,\n    summary,\n    changedRegions,\n    unexpectedChanges,\n    recommendation,\n  };\n}\n\n/**\n * Get a human-readable verdict description\n */\nexport function getVerdictDescription(verdict: Verdict): string {\n  switch (verdict) {\n    case 'MATCH':\n      return 'No changes - screenshots match';\n    case 'EXPECTED_CHANGE':\n      return 'Changes detected - appear intentional';\n    case 'UNEXPECTED_CHANGE':\n      return 'Unexpected changes - review required';\n    case 'LAYOUT_BROKEN':\n      return 'Layout broken - significant issues detected';\n    default:\n      return 'Unknown verdict';\n  }\n}\n","import { nanoid } from 'nanoid';\nimport { mkdir, readFile, writeFile, readdir, rm } from 'fs/promises';\nimport { join } from 'path';\nimport { SessionSchema, SessionQuerySchema, type Session, type SessionQuery, type Viewport, type ComparisonResult, type Analysis } from './schemas.js';\nimport type { SessionPaths, CleanOptions } from './types.js';\n\nconst SESSION_PREFIX = 'sess_';\n\n/**\n * Generate a unique session ID\n */\nexport function generateSessionId(): string {\n  return `${SESSION_PREFIX}${nanoid(10)}`;\n}\n\n/**\n * Get paths for a session\n */\nexport function getSessionPaths(outputDir: string, sessionId: string): SessionPaths {\n  const root = join(outputDir, 'sessions', sessionId);\n  return {\n    root,\n    sessionJson: join(root, 'session.json'),\n    baseline: join(root, 'baseline.png'),\n    current: join(root, 'current.png'),\n    diff: join(root, 'diff.png'),\n  };\n}\n\n/**\n * Create a new session\n */\nexport async function createSession(\n  outputDir: string,\n  url: string,\n  name: string,\n  viewport: Viewport\n): Promise<Session> {\n  const sessionId = generateSessionId();\n  const paths = getSessionPaths(outputDir, sessionId);\n  const now = new Date().toISOString();\n\n  const session: Session = {\n    id: sessionId,\n    name,\n    url,\n    viewport,\n    status: 'baseline',\n    createdAt: now,\n    updatedAt: now,\n  };\n\n  // Create session directory\n  await mkdir(paths.root, { recursive: true });\n\n  // Write session file\n  await writeFile(paths.sessionJson, JSON.stringify(session, null, 2));\n\n  return session;\n}\n\n/**\n * Get a session by ID\n */\nexport async function getSession(outputDir: string, sessionId: string): Promise<Session | null> {\n  const paths = getSessionPaths(outputDir, sessionId);\n\n  try {\n    const content = await readFile(paths.sessionJson, 'utf-8');\n    const data = JSON.parse(content);\n    return SessionSchema.parse(data);\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Update a session\n */\nexport async function updateSession(\n  outputDir: string,\n  sessionId: string,\n  updates: Partial<Omit<Session, 'id' | 'createdAt'>>\n): Promise<Session> {\n  const session = await getSession(outputDir, sessionId);\n  if (!session) {\n    throw new Error(`Session not found: ${sessionId}`);\n  }\n\n  const updated: Session = {\n    ...session,\n    ...updates,\n    updatedAt: new Date().toISOString(),\n  };\n\n  const paths = getSessionPaths(outputDir, sessionId);\n  await writeFile(paths.sessionJson, JSON.stringify(updated, null, 2));\n\n  return updated;\n}\n\n/**\n * Mark session as compared with results\n */\nexport async function markSessionCompared(\n  outputDir: string,\n  sessionId: string,\n  comparison: ComparisonResult,\n  analysis: Analysis\n): Promise<Session> {\n  return updateSession(outputDir, sessionId, {\n    status: 'compared',\n    comparison,\n    analysis,\n  });\n}\n\n/**\n * List all sessions\n */\nexport async function listSessions(outputDir: string): Promise<Session[]> {\n  const sessionsDir = join(outputDir, 'sessions');\n\n  try {\n    const entries = await readdir(sessionsDir, { withFileTypes: true });\n    const sessions: Session[] = [];\n\n    for (const entry of entries) {\n      if (entry.isDirectory() && entry.name.startsWith(SESSION_PREFIX)) {\n        const session = await getSession(outputDir, entry.name);\n        if (session) {\n          sessions.push(session);\n        }\n      }\n    }\n\n    // Sort by creation date, newest first\n    return sessions.sort((a, b) =>\n      new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n    );\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get the most recent session\n */\nexport async function getMostRecentSession(outputDir: string): Promise<Session | null> {\n  const sessions = await listSessions(outputDir);\n  return sessions[0] || null;\n}\n\n/**\n * Delete a session\n */\nexport async function deleteSession(outputDir: string, sessionId: string): Promise<boolean> {\n  const paths = getSessionPaths(outputDir, sessionId);\n\n  try {\n    await rm(paths.root, { recursive: true, force: true });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Parse duration string to milliseconds\n */\nfunction parseDuration(duration: string): number {\n  const match = duration.match(/^(\\d+)(d|h|m|s)$/);\n  if (!match) {\n    throw new Error(`Invalid duration format: ${duration}. Use format like '7d', '24h', '30m', '60s'`);\n  }\n\n  const value = parseInt(match[1], 10);\n  const unit = match[2];\n\n  switch (unit) {\n    case 'd': return value * 24 * 60 * 60 * 1000;\n    case 'h': return value * 60 * 60 * 1000;\n    case 'm': return value * 60 * 1000;\n    case 's': return value * 1000;\n    default: return value * 1000;\n  }\n}\n\n/**\n * Clean old sessions\n */\nexport async function cleanSessions(\n  outputDir: string,\n  options: CleanOptions = {}\n): Promise<{ deleted: string[]; kept: string[] }> {\n  const { olderThan, keepLast = 0, dryRun = false } = options;\n  const sessions = await listSessions(outputDir);\n\n  const deleted: string[] = [];\n  const kept: string[] = [];\n\n  // Sessions to keep based on keepLast\n  const keepIds = new Set(sessions.slice(0, keepLast).map(s => s.id));\n\n  // Calculate cutoff time if olderThan is specified\n  const cutoffTime = olderThan\n    ? Date.now() - parseDuration(olderThan)\n    : 0;\n\n  for (const session of sessions) {\n    const sessionTime = new Date(session.createdAt).getTime();\n    const shouldDelete = !keepIds.has(session.id) &&\n      (olderThan ? sessionTime < cutoffTime : true);\n\n    if (shouldDelete && !keepIds.has(session.id)) {\n      if (!dryRun) {\n        await deleteSession(outputDir, session.id);\n      }\n      deleted.push(session.id);\n    } else {\n      kept.push(session.id);\n    }\n  }\n\n  return { deleted, kept };\n}\n\n/**\n * Find sessions matching query criteria\n */\nexport async function findSessions(\n  outputDir: string,\n  query: Partial<SessionQuery> = {}\n): Promise<Session[]> {\n  // Validate query with defaults\n  const validatedQuery = SessionQuerySchema.parse({\n    limit: 50,\n    ...query,\n  });\n\n  const allSessions = await listSessions(outputDir);\n  let filtered = allSessions;\n\n  // Filter by route (extract path from URL)\n  if (validatedQuery.route) {\n    const routePattern = validatedQuery.route.toLowerCase();\n    filtered = filtered.filter(s => {\n      try {\n        const urlPath = new URL(s.url).pathname.toLowerCase();\n        return urlPath.includes(routePattern) || urlPath === routePattern;\n      } catch {\n        return s.url.toLowerCase().includes(routePattern);\n      }\n    });\n  }\n\n  // Filter by URL (exact or partial match)\n  if (validatedQuery.url) {\n    const urlPattern = validatedQuery.url.toLowerCase();\n    filtered = filtered.filter(s => s.url.toLowerCase().includes(urlPattern));\n  }\n\n  // Filter by status\n  if (validatedQuery.status) {\n    filtered = filtered.filter(s => s.status === validatedQuery.status);\n  }\n\n  // Filter by name\n  if (validatedQuery.name) {\n    const namePattern = validatedQuery.name.toLowerCase();\n    filtered = filtered.filter(s => s.name.toLowerCase().includes(namePattern));\n  }\n\n  // Filter by viewport\n  if (validatedQuery.viewport) {\n    const viewportPattern = validatedQuery.viewport.toLowerCase();\n    filtered = filtered.filter(s => s.viewport.name.toLowerCase() === viewportPattern);\n  }\n\n  // Filter by date range\n  if (validatedQuery.createdAfter) {\n    const afterTime = validatedQuery.createdAfter.getTime();\n    filtered = filtered.filter(s => new Date(s.createdAt).getTime() >= afterTime);\n  }\n\n  if (validatedQuery.createdBefore) {\n    const beforeTime = validatedQuery.createdBefore.getTime();\n    filtered = filtered.filter(s => new Date(s.createdAt).getTime() <= beforeTime);\n  }\n\n  // Apply limit\n  return filtered.slice(0, validatedQuery.limit);\n}\n\n/**\n * Get timeline of sessions for a specific route/URL\n * Returns sessions in chronological order (oldest first) for tracking changes over time\n */\nexport async function getTimeline(\n  outputDir: string,\n  route: string,\n  limit: number = 10\n): Promise<Session[]> {\n  const sessions = await findSessions(outputDir, { route, limit });\n  // Reverse to get chronological order (oldest first)\n  return sessions.reverse();\n}\n\n/**\n * Get sessions grouped by route\n */\nexport async function getSessionsByRoute(\n  outputDir: string\n): Promise<Record<string, Session[]>> {\n  const allSessions = await listSessions(outputDir);\n  const byRoute: Record<string, Session[]> = {};\n\n  for (const session of allSessions) {\n    let route: string;\n    try {\n      route = new URL(session.url).pathname;\n    } catch {\n      route = session.url;\n    }\n\n    if (!byRoute[route]) {\n      byRoute[route] = [];\n    }\n    byRoute[route].push(session);\n  }\n\n  return byRoute;\n}\n\n/**\n * Get session statistics\n */\nexport async function getSessionStats(outputDir: string): Promise<{\n  total: number;\n  byStatus: Record<string, number>;\n  byViewport: Record<string, number>;\n  byVerdict: Record<string, number>;\n}> {\n  const sessions = await listSessions(outputDir);\n\n  const byStatus: Record<string, number> = {};\n  const byViewport: Record<string, number> = {};\n  const byVerdict: Record<string, number> = {};\n\n  for (const session of sessions) {\n    // Count by status\n    byStatus[session.status] = (byStatus[session.status] || 0) + 1;\n\n    // Count by viewport\n    const viewportName = session.viewport.name;\n    byViewport[viewportName] = (byViewport[viewportName] || 0) + 1;\n\n    // Count by verdict\n    if (session.analysis?.verdict) {\n      byVerdict[session.analysis.verdict] = (byVerdict[session.analysis.verdict] || 0) + 1;\n    }\n  }\n\n  return {\n    total: sessions.length,\n    byStatus,\n    byViewport,\n    byVerdict,\n  };\n}\n","import type { Session, ComparisonResult, Analysis, ComparisonReport } from './schemas.js';\nimport { getSessionPaths } from './session.js';\n\n/**\n * Generate a full comparison report\n */\nexport function generateReport(\n  session: Session,\n  comparison: ComparisonResult,\n  analysis: Analysis,\n  outputDir: string,\n  webViewPort?: number\n): ComparisonReport {\n  const paths = getSessionPaths(outputDir, session.id);\n\n  const report: ComparisonReport = {\n    sessionId: session.id,\n    sessionName: session.name,\n    url: session.url,\n    timestamp: new Date().toISOString(),\n    viewport: session.viewport,\n    comparison,\n    analysis,\n    files: {\n      baseline: paths.baseline,\n      current: paths.current,\n      diff: paths.diff,\n    },\n  };\n\n  if (webViewPort) {\n    report.webViewUrl = `http://localhost:${webViewPort}/sessions/${session.id}`;\n  }\n\n  return report;\n}\n\n/**\n * Get verdict indicator (text-based, no emojis)\n */\nfunction getVerdictIndicator(verdict: string): { symbol: string; label: string } {\n  switch (verdict) {\n    case 'MATCH':\n      return { symbol: '[PASS]', label: 'No visual changes detected' };\n    case 'EXPECTED_CHANGE':\n      return { symbol: '[OK]  ', label: 'Changes detected, appear intentional' };\n    case 'UNEXPECTED_CHANGE':\n      return { symbol: '[WARN]', label: 'Unexpected changes - investigate' };\n    case 'LAYOUT_BROKEN':\n      return { symbol: '[FAIL]', label: 'Layout broken - fix required' };\n    default:\n      return { symbol: '[????]', label: 'Unknown verdict' };\n  }\n}\n\n/**\n * Format report as human-readable text\n */\nexport function formatReportText(report: ComparisonReport): string {\n  const lines: string[] = [];\n  const { symbol, label } = getVerdictIndicator(report.analysis.verdict);\n\n  // Verdict first - most important info\n  lines.push('');\n  lines.push(`${symbol} ${report.analysis.verdict} - ${label}`);\n  lines.push('');\n  lines.push(`Diff: ${report.comparison.diffPercent}% (${report.comparison.diffPixels.toLocaleString()} pixels)`);\n  lines.push('');\n  lines.push('---');\n  lines.push('');\n  lines.push(`Session: ${report.sessionName} (${report.sessionId})`);\n  lines.push(`URL: ${report.url}`);\n  lines.push(`Viewport: ${report.viewport.name} (${report.viewport.width}x${report.viewport.height})`);\n  lines.push('');\n  lines.push(`Summary: ${report.analysis.summary}`);\n\n  if (report.analysis.recommendation) {\n    lines.push('');\n    lines.push(`Recommendation: ${report.analysis.recommendation}`);\n  }\n\n  if (report.analysis.unexpectedChanges.length > 0) {\n    lines.push('');\n    lines.push('Unexpected Changes:');\n    for (const change of report.analysis.unexpectedChanges) {\n      lines.push(`  - ${change.location}: ${change.description}`);\n    }\n  }\n\n  lines.push('');\n  lines.push('Files:');\n  lines.push(`  Baseline: ${report.files.baseline}`);\n  lines.push(`  Current: ${report.files.current}`);\n  lines.push(`  Diff: ${report.files.diff}`);\n\n  if (report.webViewUrl) {\n    lines.push('');\n    lines.push(`View in browser: ${report.webViewUrl}`);\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * Format report as minimal output (for scripts)\n */\nexport function formatReportMinimal(report: ComparisonReport): string {\n  const status = report.comparison.match ? 'PASS' : 'FAIL';\n  return `${status} ${report.sessionId} ${report.analysis.verdict} ${report.comparison.diffPercent}%`;\n}\n\n/**\n * Format report as JSON\n */\nexport function formatReportJson(report: ComparisonReport): string {\n  return JSON.stringify(report, null, 2);\n}\n\n/**\n * Generate a summary line for session listing\n */\nexport function formatSessionSummary(session: Session): string {\n  const status = session.status.padEnd(8);\n  const viewport = `${session.viewport.name}`.padEnd(8);\n  const date = new Date(session.createdAt).toLocaleDateString();\n\n  let diffInfo = '';\n  if (session.comparison) {\n    diffInfo = session.comparison.match\n      ? ' (no diff)'\n      : ` (${session.comparison.diffPercent}% diff)`;\n  }\n\n  return `${session.id}  ${status}  ${viewport}  ${date}  ${session.name}${diffInfo}`;\n}\n"],"mappings":"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","names":["browser","resolve","import_playwright","import_promises","import_path","browser","import_playwright","browser","page","import_playwright","rules","import_promises","import_fs","import_path","closeBrowser","getBrowser","browser","rules","result","import_playwright","import_promises","import_fs","import_path","browser","readdir","import_playwright","import_promises","import_fs","import_path","import_nanoid","import_playwright","import_promises","import_fs","import_path","import_nanoid","browser","import_promises","import_path","import_fs","import_promises","import_path","pixelmatch","import_promises","import_path","resolve","discoverPages","getNavigationLinks","loadRulesConfig","runRules","createAuditResult","formatAuditResult","register","startBrowserServer","connectToBrowserServer","stopBrowserServer","isServerRunning","extractInteractiveElements","chromium","browser","performLogin","clearAuthState","PersistentSession","getSession","listActiveSessions","liveSessionManager","checkConsistency","formatConsistencyReport","result","captureWithDiagnostics","closeBrowser","join","writeFile"]}